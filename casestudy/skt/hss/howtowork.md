# HSS 관리 경로 운영 방법 (howtowork)

**버전**: v1.0
**범위**: HSS의 **관리 경로(EMS Web UI / NBI API / 북향 인터페이스)** 운영 절차 및 보안 가드레일.
※ 서비스 신호 경로(Diameter 등)는 본 문서 범위에 포함하지 않음. 다이어그램은 `README.md` 참고.

---

## 1) 목적·원칙

* HSS는 코어 신호 장비이지만 **운영·프로비저닝 면은 웹/API 시스템**이다.
* 따라서 **전통적 웹 공격면(웹셸, 인증·세션, 권한, 입력 검증, 파일 업로드)** 에 동일하게 노출된다.
* 본 문서는 “**어떻게 운영할 것인가**”를 절차 중심으로 명확히 제시한다.

---

## 2) 역할·권한 (RACI 요약)

| 역할                 | 책임(Responsible)              | 승인(Approver) | 지원(Consulted) | 통보(Informed) |
| ------------------ | ---------------------------- | ------------ | ------------- | ------------ |
| 운영자(Ops)           | 일상 모니터링, 가입자/정책 변경, 1차 장애 대응 | 보안관리자        | SysAdmin, Dev | 관련 부서        |
| 보안관리자(SecOps)      | 접근권한 승인, WAF·로그 정책, 사고 대응 지휘 | CISO/보안책임자   | Ops, Dev      | 경영진          |
| 시스템관리자(SysAdmin)   | 서버/OS 패치, Bastion, 백업·복구     | SecOps       | Ops           | 관련 부서        |
| 개발/연동(Dev/OSS·BSS) | NBI 연동, 스키마 변경, 테스트          | SecOps       | Ops           | 관련 부서        |

**최소권한 원칙**

* 운영/배치/API 계정 분리, 관리자 승인은 2인 규칙.
* 권한 만료·회수 주기 지정(기본 90일, 고권한 30일).

---

## 3) 사전 준비(공통)

* **네트워크**: 관리망 전용 VLAN, 인터넷 직접 통신 금지, 소스 IP 화이트리스트.
* **인증**: VPN+MFA 필수, EMS는 **SSO/LDAPS**, NBI는 **mTLS**.
* **비밀관리**: 인증서·키·비밀번호는 Vault/HSM, 주기적 회전.
* **감사**: Bastion **세션 녹화/명령기록**, 웹 **POST-Body** 및 **API 호출 이력** 저장.
* **변경관리(MOC)**: 모든 변경은 티켓 생성 → 승인 → 실행 → 검증 → 종료.

---

## 4) 접근 절차

### 4.1 EMS Web UI

1. **VPN(MFA)** 연결 → **Bastion** 로그인(세션 녹화 활성).
2. Bastion에서 **EMS Web** 접속(HTTPS).
3. **SSO/LDAPS**로 인증, 역할 기반 메뉴만 사용.
4. **MOC 티켓** 확인 후 작업 진행.
5. 작업 완료 후 **검증 체크리스트** 수행 → 티켓 종료.

### 4.2 NBI API

1. **mTLS 인증서/키**는 전용 Vault에서 주입(파일 배포 금지).
2. **소스 IP 화이트리스트**·**레이트리밋** 적용.
3. 합의된 **API 스키마/버전**만 사용(변경 시 MOC 필수).
4. 모든 호출에 **Correlation-ID** 부여.
5. 실패 시 **지수 백오프**로 최대 N회 재시도(운영 환경 기본 3회).

### 4.3 기타 북향 인터페이스

* **SNMP**: 트랩 대상/심각도 매핑, 오프시간 억제 룰 정의.
* **SFTP**: 키 기반 인증만 허용, 읽기/쓰기 계정 분리, 전송 무결성 검증(SHA-256).

---

## 5) 표준 운영 절차(SOP)

### A. 가입자 프로비저닝(EMS)

1. EMS 로그인 → 2) 템플릿 선택 → 3) 필수 필드 입력 → 4) **2인 검수** → 5) 커밋/적용
2. **검증 쿼리** 실행(표본 ≥3건) → 7) 티켓 종료

* **필수 로그**: 요청 본문(POST-Body), 결과 코드, 승인자 ID, 변경 전/후 스냅샷 해시.

### B. 요금제/정책 변경(NBI)

1. MOC 승인 → 2) 스테이징에서 샘플 N건 테스트 → 3) 생산 반영
2. 모니터링(오류율/지연/레이트리밋) → 5) 필요 시 롤백

* **필수 로그**: 요청·응답 페이로드 해시, 호출자 mTLS DN, Correlation-ID.

### C. 정기 점검(주간·월간)

* **주간**: 권한 드리프트 검사, Bastion 세션 표본 리뷰(≥5건), EMS/WAF 이벤트 튜닝.
* **월간**: 패치 현황, 인증서·키 만료 30일 전 교체, 백업·복구 리허설.

---

## 6) 보안 가드레일(필수·점검표)

* [ ] 관리망/업무망/서비스망 L3 분리, 라우팅·ACL 검증
* [ ] EMS 앞단 **내부 WAF** 적용(파일 업로드·명령 주입·디렉터리 탐색 룰)
* [ ] **mTLS**(TLS1.2+) 강제, 취약 스위트 차단, HSTS
* [ ] **SSO/LDAPS**·비인가 단말 차단, 세션 타임아웃(≤15분)
* [ ] **레이트리밋**(IP·계정·엔드포인트별), API 스키마 검증
* [ ] **로그**: 웹 POST-Body, API 호출 요약/해시, OS 감사, DB 감사, Bastion TTY 녹화
* [ ] **비밀관리**: Vault/HSM, 정기 회전, 사용 내역 감시
* [ ] **MOC** 전 과정 기록, 롤백 플랜 사전 검증

---

## 7) 사고 대응 플레이북(웹셸/비정상 API 징후)

**트리거 예시**

* EMS 관리자 페이지 **POST 급증**, 비정상 파일 업로드 접근
* NBI **4xx/5xx** 급증, 스키마 불일치, 비정상 mTLS DN
* HSS DB **대량 조회/덤프** 패턴, 비업무시간 접근

**즉시 조치(0~30분)**

1. **격리**: EMS 프런트/의심 노드 서비스에서 분리, WAF 차단 룰 즉시 적용
2. **자격증명 회수**: 관련 계정·토큰·인증서 폐기/재발급
3. **증거보전**: 웹셸 파일/해시, 프로세스 리스트, 네트워크 연결, 메모리 스냅샷

**조사·스코핑(30분~4시간)**
4. Bastion 세션·EMS **POST-Body**·웹서버 접근 로그 상관분석
5. **HSS_OAM/HSS_FE** 호출 흔적 추적(시간·계정·요청 본문 해시 일치 여부)
6. DB 감사로그로 조회/추출/압축·전송 흔적 확인

**복구(4~24시간)**
7. 클린 노드로 전환(이미지 신뢰성 검증), IaC로 재배포
8. 서명/무결성 검사 통과 후 트래픽 점진 복귀(50%→100%)
9. IOC 기반 전체 스윕, 재발 방지 설정 반영

**사후(24~72시간)**
10. **RCA** 작성, 정책/룰 보완, 교육·리허설 업데이트
11. 규제기관/고객 통지 요건 검토 및 이행(해당 시)

---

## 8) 모니터링·알림 기준(요약)

| 영역  | 주요 지표                          | 임계치 예시(초기값)      | 알림        |
| --- | ------------------------------ | ---------------- | --------- |
| EMS | 관리자 POST/분, 파일 업로드 시도, 로그인 실패율 | 평시+3σ, 5분간 3회 초과 | SecOps P1 |
| NBI | 4xx/5xx 비율, 지연 p95, 스키마 불일치    | 오류율 >1%, p95>1s  | Ops P2    |
| WAF | 룰 히트율, 우회 시그니처                 | 룰 히트 급증          | SecOps P2 |
| DB  | 대량 SELECT/EXPORT, 비업무시간 접근     | 평시+3σ            | DBA P1    |
| 시스템 | 무결성 실패, 신규 프로세스(웹셸 지표)         | 즉시               | SecOps P1 |

---

## 9) 로그·증적 보존

| 항목                 | 보존 기간(최소) | 비고                |
| ------------------ | --------: | ----------------- |
| 웹 요청 본문(POST-Body) |        1년 | 민감정보 마스킹 정책 적용    |
| API 호출 이력/해시       |        1년 | Correlation-ID 포함 |
| OS 감사(Audit)       |        1년 | sudo/tty 포함       |
| DB 감사              |        2년 | 조회·추출·계정 변경       |
| Bastion 세션 녹화      |        1년 | 무작위 표본 리뷰 주간 수행   |

열람은 **사유 기록 + 2인 승인** 원칙.

---

## 10) 변경관리(MOC) 필수 항목

* 변경 목적/영향 범위, 위험도, 롤백 플랜
* 테스트 증빙(스테이징 결과, 샘플 로그)
* 윈도우/담당자/연락망, 비상 중단 기준
* 완료 후 검증 체크리스트 및 로그 위치

---

## 11) 템플릿/부록

### 11.1 검증 체크리스트(예시)

* [ ] 작업 티켓 번호 __________
* [ ] EMS/NBI 접근 성공 및 응답 코드 2xx
* [ ] 샘플 N건 프로비저닝/정책 반영 확인
* [ ] 관련 로그(POST-Body/API 해시) 수집·보관
* [ ] 권한·세션 누수 없음
* [ ] 모니터링 지표 정상화

### 11.2 API 호출 로깅 스키마(요약)

```
timestamp, source_ip, mTLS_DN, user|client_id, method, endpoint,
correlation_id, req_hash, resp_code, resp_time_ms, rate_limit_hit(bool)
```

---

## 12) 참조

* `README.md` — 관리 경로 다이어그램·요약
* `configuration.md` — WAF·mTLS·계정·레이트리밋 파라미터 표
* `about.md` — 배경/사건 개요/교훈

---

## 13) 변경 이력

* **v1.0 (YYYY-MM-DD)**: 초기 운영 절차·가드레일 정리, 사고 대응 포함

---
