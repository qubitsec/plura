# 쿠팡 내부 의사결정 메모(1~2p)

## 퇴사자 키 반출(서명키/인증키) 전제를 고려한 Brute Force(대량 인증 시도) 2차 방어선 구축 제안 – PLURA‑XDR

---

## 1) 결론(의사결정 요청)

**의사결정 요청:**  
쿠팡의 인증/로그인/토큰 발급 구간에 대해 **“키가 이미 외부로 반출되었을 수 있다”**는 전제 하에, **요청 본문(POST Body) + 응답 본문 기반**의 행위 탐지(Brute Force/자동화 인증 시도) 체계를 **PLURA‑XDR로 구축**하여 **키 교체(1차 방어)만으로 생기는 공백을 메우는 2차 방어선**을 추가 도입합니다. 

**승인 필요 항목(요약):**

* (A) **복호화 지점(웹 서버/WAF/API Gateway)** 에서 **요청 본문(POST Body) 전체 수집** 및 **응답 본문(최소 결과/사유) 수집**을 허용/정책화 
* (B) PLURA‑XDR 연동 및 **행위 기반 탐지/자동 대응 정책** 적용(계정·키·엔드포인트 단위) 
* (C) 기존 보안 솔루션(SIEM/EDR/WAF 등)과 **병행 운영(중복이 아니라 기반 가시성 강화)** 원칙 승인 

---

## 2) 배경 및 문제 정의

### 배경: “퇴사”는 인사 이벤트가 아니라 보안 이벤트

키(서명키/인증키/API Key 등)를 다루던 개발자의 퇴사 이후에는, 의도와 무관하게 **키가 통제 밖으로 나갔을 가능성 자체가 리스크**가 됩니다. 따라서 대응 출발점은 “반출되지 않았을 것”이 아니라 **“이미 반출되었을 수 있다”**로 전환되어야 합니다.  

### 문제: 키 교체만으로는 공백이 생김

키 교체(폐기/회전)는 필수지만, 현실적으로 다음이 남습니다.

* 교체 전까지의 **공백 시간**
* 교체의 **지연 가능성**
* 이미 키를 확보한 공격자의 **자동화 공격 지속**

즉, 쿠팡에는 **“키를 가진 공격자”를 전제로 한 2차 방어선**이 필요합니다.  

### 문제: Access Log 중심 탐지의 구조적 한계

일반 Access Log에는 보통 IP/시간/URL/응답코드 정도만 남습니다. 그래서 `POST /login 200`처럼 보이면 정상처럼 오판할 수 있습니다. 그러나 실제 공격의 핵심 페이로드/시도 값은 대부분 **URL이 아니라 POST Body(요청 본문) 안에 존재**하며, **응답이 200이어도 실패 사유는 응답 본문에만 남는 구조**가 흔합니다.
→ 결론: **본문이 없으면 “공격이 없었다”로 결론 날 위험**이 큽니다.  

---

## 3) 제안: PLURA‑XDR 기반 “요청 본문 + 응답 본문” 행위 탐지/차단(2차 방어선)

### 핵심 제안 1) 복호화 지점에서 “요청 본문(POST Body) 전체 수집”을 보안 인프라로 격상

HTTPS 환경에서는 네트워크 구간에서 본문이 보이지 않으며 **복호화 지점에서만** 본문 분석/수집이 가능합니다. 따라서 웹 서버 또는 WAF/API Gateway에서 **요청 Body를 수집하지 않으면 사후 복구가 불가능**합니다. 또한 부분 수집(예: 8KB 제한)은 공격자에게 악용될 수 있어 **원본 그대로 전체 수집**이 권장됩니다. 

### 핵심 제안 2) “응답 본문”까지 결합해 탐지 정확도와 자동 차단의 실효성 확보

Brute Force는 단순히 “요청이 많다”가 아니라,

* 로그인/인증 **성공·실패**
* 실패 사유(비밀번호 오류/잠금/추가 인증 필요 등)
* 토큰 발급 여부/권한 부여 여부
  같은 **결과 신호**로 정상 트래픽 폭증(프로모션/장애)과 구분됩니다.

따라서 **요청 본문(시도 내용) + 응답 본문(결과/사유)** 결합이 되어야,
탐지가 실제 “차단(자동 대응)”으로 이어질 때 **오탐을 줄이면서 강하게 막는 운영**이 가능합니다.  

### 핵심 제안 3) 키가 유출되어도 “행위”는 숨기기 어렵다

서명키/인증키가 반출되면 요청 서명/헤더는 정상처럼 보일 수 있습니다. 그러나 공격자가 수행하는 Brute Force/자동화 인증 시도는 다음 특성을 가집니다.

* 단위 시간 대비 요청 증가율(시간 밀도)
* 동일 인증/토큰 리소스 반복 호출
* 정상 대비 편차(성공률 급락/실패 반복)
* 자동화 패턴 지속성

PLURA‑XDR은 **IP 블랙리스트가 아니라 행위 기반**으로 이를 탐지·차단합니다. IP가 분산되어도 **행위 패턴은 동일**하면 잡힙니다.  

---

## 4) 적용 범위(권장)

**우선 적용(High Priority)**

* 로그인/인증 엔드포인트(예: `/login`, `/auth`, `/token`, `/oauth/token`)
* 비밀번호 재설정/계정 복구
* 관리자/파트너/내부 API 중 “권한/토큰/계정”과 직결된 구간

**수집 항목(최소 세트)**

* 요청: endpoint, method, timestamp, client identifier(API Key ID/Client ID 등), **POST Body(원본)**
* 응답: status code + **응답 본문 기반 결과(성공/실패, 실패 사유 코드/문구, 토큰 발급 여부 등)**

※ 개인정보/민감정보는 **필드 단위 마스킹/해싱/토큰화**, 열람 권한 분리, 보관기간(리텐션) 정책으로 통제합니다(수집 “불가”가 아니라 “통제”로 해결). 

---

## 5) 운영 정책(자동 대응) 제안

탐지 후 대응은 “무조건 차단”이 아니라 **단계적 완화**로 설계합니다.

* 1단계: 경보 + Rate Limit(엔드포인트/키/계정 기준)
* 2단계: Step-up 인증(추가 인증, 챌린지/CAPTCHA 등) 또는 계정 보호 락
* 3단계: 키/클라이언트/계정 단위 자동 차단, SOC 즉시 통보
* 병행: 키 교체/폐기 프로세스(1차 방어)와 연동하여 공백 최소화 

---

## 6) 기존 솔루션과의 관계(병행 원칙)

본 제안은 “기존 솔루션 대체”가 아니라, **기존 솔루션이 제대로 판단할 수 있는 근거(가시성)를 확장**하는 방식입니다.
기존 솔루션이 OS 이벤트를 소비하듯, 웹/인증 보안에서도 **‘본문 가시성’이 기반 인프라**가 되어야 상위 탐지/분석/포렌식이 정확해집니다.  

---

## 7) 기대 효과(정량/정성)

* **키 유출 전제에서도 작동하는 방어선 확보**: “정상 서명”을 통과해도 행위로 탐지
* **탐지 → 차단까지 연결**: 응답 본문 기반 결과 신호로 오탐 감소, 자동 대응 실효성 강화
* **분산 IP 우회에 강함**: IP 개수보다 반복성/시간 밀도/편차로 판단
* **사후 대응력 상승**: 사고 재현/피해 범위 산정/근거 확보(포렌식) 

---

## 8) 리스크 및 대응

* **개인정보/민감정보 수집 우려** → 필드 마스킹/해싱, 접근 통제, 리텐션 최소화(정책으로 해결) 
* **성능/저장 비용 증가** → 우선순위 엔드포인트부터 단계 적용, 압축/샘플링(정책), 이벤트 기반 저장 최적화
* **중복 로깅/운영 복잡도** → “기반(본문) → 분석(PLURA‑XDR) → 연동(SIEM 등)” 역할 분리로 정리 

---

## 9) 결정 필요 사항(체크리스트)

1. **본문 수집 정책 승인**: 복호화 지점에서 요청/응답 본문 수집 허용(마스킹/권한/리텐션 포함) 
2. **적용 범위 승인**: 우선 적용 엔드포인트(로그인/토큰/복구/관리자 API) 확정
3. **자동 대응 승인**: 단계적 차단 정책(키/계정/엔드포인트 단위) 운영 기준 확정 
4. **병행 운영 승인**: 기존 솔루션과 연동/중복 최소화 원칙 확정 

---

### 참고(데모 링크)

아래는 “탈취된 인증 토큰(JWT)로 정상 사용자처럼 위장해 대량 요청” 시나리오 대응 데모입니다. (문서 내 참고용) 

```text
https://youtu.be/l6JeCeWeVSo
```

---
