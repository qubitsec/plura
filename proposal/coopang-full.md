## 0️⃣ 제안 요약

쿠팡이 마주한 핵심 과제는 “키가 반출되지 않았을 것”이 아니라 “**이미 반출되었을 수 있다**”를 전제로 한 2차 방어선입니다.

PLURA‑XDR 제안 포인트는 다음 3가지입니다.

1. **키 교체**(1차)만으로는 공백/지연/자동화 공격을 커버할 수 없으므로, **행위 기반 Brute Force 탐지·차단**(2차)이 필요합니다.

2. Brute Force의 “증거”는 **Access Log 표면**(URL/코드/IP)가 아니라, 대부분 **요청 본문**(POST Body) 안에 있습니다. 응답이 200이어도 본문이 없으면 정상으로 오판할 수 있습니다.

3. IP가 2,000개로 분산돼도, 공격 본질은 IP 숫자가 아니라 **반복성/시간 밀도/자동화 패턴/정상 대비 편차**이므로 “행위 기반”으로 충분히 탐지·차단 가능합니다.

---

## 1️⃣ 전제 전환: “퇴사”는 인사 이벤트가 아니라 보안 이벤트입니다

키를 다루던 개발자가 퇴사하면, 로컬/개인 클라우드/백업 등 다양한 경로로 **키가 통제 밖으로 나갔을 가능성 자체가 리스크**가 됩니다.

따라서 출발점은 다음이어야 합니다.

> “반출되지 않았을 것”이 아니라,  
> “**이미 반출되었을 수 있다**”에서 출발한다.

---

## 2️⃣ 왜 ‘키 교체’만으로는 방어가 완성되지 않나요

키 교체는 반드시 필요하지만, 현실적으로 다음 문제가 남습니다.

* 교체 전 **공백 시간**
* 교체 **지연 가능성**
* 이미 키를 확보한 공격자의 **자동화 공격 지속**

즉, 쿠팡에는 아래가 추가로 필요합니다.

> “이미 키를 가진 공격자”를 전제로 한 **2차 방어선**  
> = **행위 기반 Brute Force 탐지·차단**

---

## 3️⃣ 왜 Access Log 중심 탐지는 실패하기 쉬운가

웹 서버 Access Log는 보통 다음만 남깁니다: IP, 시간, 메서드, URL, 응답코드 등.

예를 들어 Access Log에는 아래처럼 보일 수 있습니다.

* `POST /login ... 200`

이 경우 **정상 로그인처럼 보이지만**, 실제 공격은 URL이 아니라 **Body(요청 본문) 안에서 발생**합니다.

또한 “응답이 200 OK니까 정상”으로 오판하기 쉽습니다(실패 사유가 응답 본문에만 남는 구조가 흔함). 본문이 없다면 “공격은 없었다”로 결론 날 위험이 커집니다.

---

## 4️⃣ 핵심 제안: 쿠팡의 2차 방어선은 “요청 본문 + 응답 본문” 분석이어야 합니다

### 4-1) 왜 ‘요청 본문(POST Body)’가 필수 인프라인가

웹 공격을 판단할 수 있는 근거가 **POST Body 안에 존재하는 경우가 대부분**이며, Access Log만으로는 식별이 불가능합니다.

특히 HTTPS 환경에서는 네트워크 구간에서 본문이 보이지 않고, **복호화 지점에서만** 본문 분석이 가능합니다. 따라서 **웹 서버 또는 WAF에서 본문을 수집하지 않으면 이후 복구가 불가**합니다.

또한 부분 수집(예: 8KB 제한, 일부 파라미터만)은 공격자가 악용할 수 있어 **원본 그대로 전체 수집**이 권장됩니다.

### 4-2) 왜 ‘응답 본문’까지 봐야 탐지가 “차단”으로 이어지는가 (제안 논리)

쿠팡의 브루트포스는 단순히 “요청이 많다”가 아니라,

* **로그인 성공/실패**
* **실패 사유(비밀번호 오류/계정 잠금/추가 인증 필요 등)**
* **토큰 발급 여부/권한 부여 여부**

같은 **결과 신호**가 있어야 “정상 폭증(프로모션/장애)”과 “공격”을 분리하고, 차단 시 오탐을 줄일 수 있습니다.

즉,

> **요청 본문(시도 내용) + 응답 본문**(결과/사유)를 결합해야  
> “정확한 Brute Force 탐지”가 “실제 차단”으로 이어집니다.  

---

## 5️⃣ “키가 유출돼도 탐지 가능”한 이유: 키는 통과해도 ‘행위’는 숨기기 어렵습니다

퇴사자가 **서명키/인증키**를 반출하면, 요청 서명/인증 헤더 자체는 정상처럼 보일 수 있습니다. 하지만 공격자가 하려는 행위(대량 인증 시도)는 다음 특징을 가집니다.

* 단위 시간 대비 요청 증가율
* 동일 리소스(로그인/토큰) 반복 호출
* 정상 사용자 대비 편차
* 자동화 패턴 지속성

PLURA‑XDR이 제안하는 핵심은 **IP 블랙리스트가 아니라 행위 기반**입니다.

따라서 “키를 가진 정상 서명 요청”처럼 위장해도, 아래 중 하나가 성립하면 탐지·차단 조건이 됩니다(쿠팡 적용 관점의 설계 포인트).

* 동일 인증키/서명키 식별자(예: API Key ID, Client ID)로 **로그인 실패가 일정 임계 이상** 발생
* 요청 본문에서 **계정 스프레이(다수 계정에 동일 패스워드/패턴 시도)**, 또는 **패스워드 스프레이(단일 계정에 다수 후보)** 패턴이 확인
* 응답 본문에서 “실패”가 다수를 차지하며, 성공률이 정상 대비 급락(credential stuffing/Brute Force 전형)
* 정상 사용자군과 비교해 요청 간격이 일정(봇)하고, 연속성이 높음(시간 밀도)

---

## 6️⃣ IP 2,000개 분산도 “불가능”이 아니라, 오히려 행위 기반 탐지 영역입니다

문서에 인용된 케이스 기준으로, IP가 약 2,000개이고 전체 시도가 3,367만 규모여도 **IP 1개당 약 1.68만 건** 수준이며, 이는 행위 기반 Brute Force 시스템이 이상 징후로 인식 가능한 범위로 제시됩니다.

핵심은 다음입니다.

> IP를 2,000개로 분산했다고 해서 탐지가 불가능해지는 것이 아니라,  
> 공격의 본질은 **반복성/시간 밀도/자동화 패턴/정상 대비 편차**다.

---

## 7️⃣ 쿠팡 적용 아키텍처 제안: “본문 수집”을 필수 인프라로 올리고, 그 위에 탐지·차단을 얹습니다

q4-complements 문서가 말하듯, 기존 솔루션은 결국 “기반 이벤트/로그”를 소비하며, 기반 설계가 부실하면 상위 솔루션도 정확히 동작하기 어렵습니다.

쿠팡의 웹/인증 보안에서도 구조는 유사합니다.

1. **복호화 지점(웹 서버/WAF/API Gateway)** 에서

   * 요청 본문(POST Body) 전체 수집
   * 응답 본문(최소: 결과 코드/실패 사유/토큰 발급 여부) 수집

2. PLURA‑XDR에서

   * “키가 정상이어도” **행위 기반 Brute Force 탐지** 수행(반복성/시간밀도/편차)

3. 차단/완화 액션(운영 정책)

   * 자동 차단(인증키/계정/엔드포인트 단위), 단계적 제한(rate limit)
   * 추가 인증(step-up), CAPTCHA/챌린지, 계정 보호 락
   * 키 교체와 병행(공백 최소화)

---

## 8️⃣ 한 문장 정리

> **키가 반출되어 “정상 서명”이 가능해져도, 공격은 요청/응답 본문에 남는 반복·자동화 ‘행위’로 드러납니다.  
> PLURA‑XDR은 그 행위를 기준으로 Brute Force를 탐지·차단하는 2차 방어선이 될 수 있습니다.**

---

## 🔟 최종 정리: 쿠팡에 제안하는 운영 원칙 4가지

* **전제 변경:** “이미 키가 유출되었을 수 있다”에서 설계 시작
* **다층 방어:** 키 교체(1차) + 행위 기반 Brute Force 탐지·차단(2차) 병행
* **가시성 인프라:** Access Log가 아닌 **요청 본문(필수) + 응답 본문(차단 정확도 향상)** 기반 분석
* **분산 IP에 흔들리지 않기:** IP가 아니라 **반복성/시간 밀도/자동화/편차**로 본질을 잡는다

---
