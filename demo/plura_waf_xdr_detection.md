# PLURA-WAFとPLURA-XDRによる **Webシェル攻撃およびファイルレス攻撃** の検知方法

PLURA-WAFとPLURA-XDRは、Webシェル攻撃やファイルレス攻撃を検知するために多様なセキュリティ技術と検知メカニズムを活用しています。以下は、それぞれのシステムにおける攻撃検知方法の詳細です。

---

## **PLURA-WAFによる検知方法**

PLURA-WAFは、Webトラフィックをリアルタイムでモニタリングし、Webシェルやファイルレス攻撃を検知するために次の機能を提供します：

### **1. Webリクエストパターン分析**
- **異常なHTTPリクエストの検知**:
  - HTTPメソッド（POST、GET）と異常なURLパターンを分析。
  - Webシェルアップロード時に使用されるマルチパートリクエスト（`Content-Type: multipart/form-data`）を識別。
  - 例: アップロードされたファイル名が`.php`、`.asp`、`.jsp`などのスクリプトファイルの場合に警告を表示。
- **特定文字列のフィルタリング**:
  - 攻撃で頻繁に使用されるPHPコード（例: `<?php system(...) ?>`、`eval()`、`base64_decode()`）を検知。

### **2. ファイルアップロードポリシーの適用**
- ファイルサイズ、拡張子、アップロードパスなどを基準にしてブロック。
- アップロードされたファイルが実行可能スクリプトの場合、アップロードをブロックまたは警告。

### **3. Webトラフィック相関分析**
- 特定のIPまたはユーザーセッションで繰り返されるリクエスト（ファイルアップロード、コマンド実行など）を識別。
- 例: 同じクライアントIPが短時間に複数のファイルアップロードやコマンド実行リクエストを行った場合、不審な活動として判断。

### **4. シグネチャベースの検知**
- OWASP Top 10攻撃タイプ（例: ファイルアップロード脆弱性、XSS、SQLi）に対応したシグネチャを使用してWebシェルのアップロードと実行をブロック。

### **5. 動的動作ベースの検知**
- アップロードされたファイルの動作を分析し、Webシェルの実行有無を確認。
  - アップロードされたファイルが実行される場合、不審なコマンド実行（例: `cmd.exe`、`ls`）をモニタリング。

---

## **PLURA-XDRによる検知方法**

PLURA-XDRは、Webサーバーおよびネットワーク全体で発生するセキュリティイベントを総合的に分析し、ファイルレス攻撃やWebシェル実行を検知します：

### **1. ログ収集と相関分析**
- **サーバーログの収集**:
  - Apache、NGINX、IISなどのWebサーバーのアクセスログやエラーログをリアルタイムで収集。
  - Webシェルに関連する異常なURLリクエスト（例: `webshell.php?cmd=`など）を検知。
- **SIEMとの連携**:
  - 収集されたログをSIEMと連携し、不審な活動パターンを分析。
  - 例: 同一クライアントから繰り返されるコマンド実行リクエストを検知。

### **2. ファイルレス攻撃の検知**
- **プロセス動作のモニタリング**:
  - PowerShell、WMIC、mshtaなどの異常な実行を検知。
  - ファイルレス攻撃で使用されるコマンド（`IEX`、`DownloadString`、`Remove-Item`）が実行されると警告。
- **メモリ分析**:
  - ファイルを使用せずに実行される悪意のあるスクリプトをメモリ内で検知。
  - コマンド実行時に生成されるプロセス情報を分析し、異常な動作を識別。

### **3. MITRE ATT&CKベースの検知**
- T1059（コマンドおよびスクリプトインタープリタ）、T1218（署名付きバイナリプロキシ実行）など、MITRE ATT&CKに基づく攻撃シナリオを検知。
- 例: 攻撃者が`mshta`を使用してHTAファイルを実行し、さらに悪意のあるコードをダウンロードする場合、それをリアルタイムで検知。

### **4. 脅威インテリジェンスとの連携**
- PLURA-XDRは、既知の悪意あるWebシェルパターン、攻撃IP、ドメイン情報を脅威インテリジェンス（Threat Intelligence: TI）データと比較し、リアルタイムで検知。
- 例: `malicious.com`のような悪意あるURLリクエストが発生した場合、自動的にブロック。

### **5. カスタムルール**
- 管理者が特定のファイルパス、コマンド、HTTPリクエストパターンを基に検知ルールを設定可能。
- 例: 特定のURLパターン（例: `/upload.php`、`/cmd.php`）が検知されると即座に通知およびブロック。

---

## **検知後の対応**

1. **PLURA-WAF**:
   - 異常なリクエストをブロックし、管理者に通知。
   - 不審なファイルアップロードを確認し、自動削除。

2. **PLURA-XDR**:
   - リアルタイムで警告を発し、セキュリティチームに通知。
   - 不審なプロセスやネットワーク接続を即時ブロック。
   - 検知されたイベントを基に攻撃シナリオを再構成し、詳細なレポートを提供。

---

この2つのシステムを統合運用することで、ファイルレス攻撃やWebシェル攻撃に対して高い検知率と迅速な対応が可能となります。
