# 필상 시스템 — Day 28 변경관리(Change Mgmt) · 릴리스 노트 · RFC/ADR 거버넌스

1. **날짜**

* 2024-09-12

2. **목표**

* **변경 제안→검토→승인→배포→커뮤니케이션** 전 과정을 표준화
* **RFC/ADR 원장**, **릴리스 노트 자동화**, **리스크 등급/승인 체계** 확정

---

3. **내용**

### A. 원칙(Design Guardrails)

* **작은 단위·가역성 우선**: 플래그/카나리로 폭발 반경 최소화
* **증거 중심**: 변경 전/후 **SLO·지표·리플레이 결과** 필수 첨부
* **단일 출처**: 변경 근거는 **RFC/ADR 리포지토리**에 기록(코드와 나란히)
* **감사 100%**: `who/what/why/when/trace_id` 해시체인으로 영구 보관

### B. 변경 유형 & 등급

| 등급          | 예시                                  | 승인             | 배포 창        |
| ----------- | ----------------------------------- | -------------- | ----------- |
| **L3(고위험)** | 스키마 파괴적 변경, 보안 정책 완화, 데이터 보존/키 조정   | **CAB 2인+IC**  | 점검 창(야간)    |
| **L2(중위험)** | 룰/모델 가중치, 인덱스 샤드/캐시 조정, 게이트웨이 레이트리밋 | **서비스 오너+리뷰어** | 근무시간 내, 카나리 |
| **L1(저위험)** | UI 문구, 대시보드 타일, 로그 레벨/라벨            | **리뷰 1인**      | 상시          |

> **긴급 변경(Hotfix)**: T0/T1 대응만 허용, 사후 24h 내 **RCA+ADR** 보강 의무.

### C. 프로세스(End-to-End)

1. **RFC 제안** → `rfcs/2025-09-012-short-title.md` (문제·대안·영향·롤백·실험계획)
2. **ADR 확정** → `adrs/ADR-00X-title.md` (결정/근거/대안/결정일)
3. **PR/이슈 연결** → 라벨(`risk:L1~L3`, `flag:required`, `db:migrate`) + 체크리스트 자동 주입
4. **검증** → CI 게이트(계약·리플레이·보안·퍼프 스모크) 통과
5. **승인** → 등급별 승인자 충족, **변경 티켓**에 근거 링크
6. **배포** → 플래그/카나리 → SLO 게이트 모니터 → 자동 롤백 규칙 활성
7. **커뮤니케이션** → 릴리스 노트/상태페이지/고객 통지(필요 시)
8. **사후** → 포스트모템/RCA, ADR에 결과 갱신

### D. 산출물 템플릿(요약)

**RFC 헤더**

```yaml
rfc: 2025-09-012
title: Search 캐시 TTL 상향(30s→90s)
owner: sre@pil
risk: L2
experiment: canary 5→25→100%, 15m 관찰
rollback: flag off + TTL 원복
metrics: search_p95, cache_hit, error_rate
```

**ADR 필수 항목**: 결정·근거(지표/리플레이 링크)·대안·보안/주권 영향·되돌리기 절차

### E. 릴리스 노트 자동화

* **Conventional Commits** 기반 카테고리: `feat`, `fix`, `perf`, `security`, `refactor`, `docs`
* `release-notes.yml` 규칙:

  * **요약(하이라이트)**, **변경 상세(서비스별)**, **마이그 가이드**, **플래그/롤백 키**
  * **증거 링크**: 대시보드 스냅샷, EPKG(라이트), 리플레이 리포트
* 출력: **콘솔 배너 + HTML/PDF + 웹훅(서명)**, 언어 `ko/ja/en` 자동 번역

### F. 도구/자동화

* PR 템플릿에 **체크리스트** 삽입:

  * [ ] RFC/ADR 링크 · [ ] SLO 영향 분석 · [ ] 롤백 스크립트/플래그 준비
  * [ ] 데이터 주권 영향 없음 · [ ] 보안/비밀 변경 없음/있음(세부)
* **봇 연계**: `/change risk L2` `/change window 22:00-23:00` → CAB 캘린더·온콜 알림
* **릴리스 봇**: 태그 생성 → 노트 렌더 → 상태페이지 초안 → 고객 통지 초안 PR

### G. 커뮤니케이션 규칙

* 고객 영향 있는 변경은 **최소 3영업일 전** 안내(ko/ja/en), 대체 경로/되돌리기 포함
* 상태페이지는 **지표 중심**(ETA 금지), 변경 창 시작/종료 자동 게시
* 내부 슬랙: `#change-announce` 채널에 하이라이트/위험/되돌리기 키 공유

### H. KPI/감사

* **Change Failure Rate ≤ 10%**, 평균 롤백 시간 ≤ **5분**
* 릴리스 노트 누락 0건, RFC→ADR 전환 비율 ≥ **95%**
* **감사 지표**: 승인자·근거 링크·롤백 실행 내역이 해시체인 검증 통과

---

4. **예시 설명 (L2 변경—검색 캐시 TTL 상향 안전 적용)**

1) RFC 발행: 캐시 히트 42%→60% 목표, 리스크 L2, 되돌리기 플래그 `search.cache.ttl` 정의
2) CI에서 **상위 5 쿼리 p95** 회귀 ≤ +10% 확인, 보안/주권 영향 **없음**
3) CAB 승인 후 **KR 5% 카나리** → p95 0.82s→0.74s, 오류율 정상 → 25%→100% 승격
4) JP는 다음 날 동일 절차, 릴리스 노트에 “성능 개선(−11%)·플래그 키·되돌리기 방법” 표기
5) 일주일 후 ADR에 “목표 달성, 부작용 없음” 업데이트, Change Failure Rate 0%로 종료

> 결과: **RFC→ADR→배포→노트**까지 일관된 체계로 위험을 통제하고, 증거·되돌리기·고객 안내가 내장된 **예측 가능한 변경관리**를 정착.
