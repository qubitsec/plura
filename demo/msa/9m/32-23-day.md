# 필상 시스템 — Day 32 내부 개발자 플랫폼(IDP) · 서비스 카탈로그 · 골든 패스

1. **날짜**

* 2024-09-23

2. **목표**

* **개발자 셀프서비스**(서비스 생성·배포·운영) 표준화로 **리드타임 50%↓**
* **서비스 카탈로그/골든 패스/점수표** 도입으로 **일관성·보안·SLO** 자동 준수

---

3. **내용**

### A. IDP 개요(Backstage/포털)

* 단일 포털에서 **서비스 생성·런북·대시보드·배포·권한**을 한 화면 제공
* **카탈로그 원장**: `catalog-info.yaml`(오너·SLO·런북·레포 링크)

```
/catalog
  /apps/ingestor/catalog-info.yaml
  /apps/incident-svc/catalog-info.yaml
  /platform/solr-ops/catalog-info.yaml
```

### B. 골든 패스 템플릿(Software Templates)

* **svc-http-go**: gRPC/HTTP, OTel, 헬스체크, CI/CD, SAST/Trivy, OPA 훅
* **svc-worker-py**: 스트림 컨슈머, 멱등/재시도/DLQ, Perf 스모크
* **web-console-next**: i18n, auth guard, e2e, 시각 회귀
* **infra-job-terraform**: 네임스페이스/쿼터/모니터링 IaC

> 생성 시 자동 포함: `Makefile`, `Dockerfile`, `helm/`, `.pre-commit`, `runbook.md`, `SLO.yaml`, `security.md`.

### C. 서비스 메타(SLO/Owner/Runbook)

```yaml
# catalog-info.yaml (발췌)
metadata: { name: incident-svc, owner: team-csirt }
spec:
  type: service
  lifecycle: production
  links:
    - { title: Runbook, url: /docs/runbooks/incident-svc.md }
    - { title: Dashboard, url: grafana://d/incident }
  slo:
    availability: 99.9
    ingest_to_incident_p95: 15s
```

### D. 점수표(Scorecards)

* **기본**: SLO 정의, OTel 계측, 보안 스캔 통과, SBOM, OPA 준수, 런북 링크
* **확장**: 성능 예산, FinOps 라벨, 테스트 커버리지
* 등급: **Gold(90+) / Silver(75+) / Bronze(60+)** — 릴리스 게이트 연동

### E. 셀프서비스(플로우)

1. **Create**: 템플릿 선택 → 파라미터 입력(팀·도메인·리전)
2. **Provision**: 레포/레지스트리/네임스페이스/시크릿 자동 생성(IaC)
3. **Pipelines**: 기본 CI 스테이지(테스트·보안·컨테이너 빌드) 연결
4. **Publish**: 카탈로그 등록 → 대시/알람/런북 자동 링크
5. **Operate**: 배포/플래그/롤백 버튼, SLO/알람 상태 실시간 표시

### F. 거버넌스(가드레일)

* 템플릿에 **Egress 화이트리스트·웹훅 서명**·RLS 필수 포함
* `score < Silver` 서비스는 **프로덕션 배포 금지**(스테이징만 허용)
* 고위험 변경(L3) 시 **CAB 워크플로우** 자동 붙음(RFC/ADR 링크 필수)

### G. 관측·지표(포털)

* **Deploy Lead Time**, **Change Failure Rate**, **Mean Time to Restore**
* 서비스별 **score trend**·SLO 준수율·알람 노이즈 비율·FinOps 단위비용
* 팀 간 **벤치마크** 대시(골든 패스 채택률)

### H. 보안/권한

* 포털 액션은 OIDC/RBAC: `template:use`, `catalog:publish`, `deploy:prod`, `flag:edit`
* 템플릿 변경은 **2인 승인** + 회귀 템플릿 테스트 필수
* 생성 시 **레포 보호 규칙**(필수 리뷰, 서명 커밋, 비밀 스캔)

### I. API/자동화 훅

* `POST /v1/idp/templates/{key}:instantiate` — 서비스 생성
* `POST /v1/catalog/{svc}:score` — 점수 재계산(근거 포함)
* `POST /v1/deploy` — 환경/전략(canary|bluegreen) 파라미터화
* `GET /v1/idp/guardrails` — 미충족 항목 리포트(자동 티켓 연동)

### J. 운영 체크리스트

* [ ] 템플릿 분기별 리뷰(보안/성능/관측 최신 반영)
* [ ] Bronze 서비스 0건(프로덕션) 유지 — 리미디에이션 플랜 관리
* [ ] 신규 서비스는 **골든 패스 외 생성 금지** 플래그 ON
* [ ] 카탈로그 메타(SLO/오너/런북) 누락 경보 처리 24h 내

---

4. **예시 설명 (신규 `ti-enricher` 서비스 40분 셀프온보딩)**

1) 개발자가 포털에서 **`svc-worker-py`** 골든 패스 선택 → `owner=team-detection`, `region=kr` 입력
2) 레포·네임스페이스·CI가 자동 생성되고 **카탈로그 등록**(대시/런북 링크 포함)
3) 기본 파이프라인 통과 후 **stg 카나리 배포**(5%→25%→100%), 점수 **82(Silver)**
4) Scorecard 경고: “FinOps 라벨 누락” → 라벨 추가 후 **88(Gold)**로 상승
5) 포털에서 **SLO 카드**와 런북 버튼이 활성화, 운영 기준 충족 확인 → **prod 배포 승인**
   → 결과: 템플릿·가드레일·점수표로 일관된 셀프서비스가 구현되어, 신규 서비스가 규정·보안·SLO를 **처음부터 내장**한 상태로 신속하게 운영에 편입된다.
