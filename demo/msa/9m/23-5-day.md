# 필상 시스템 — Day 23 국제화(i18n) · 현지화(l10n) · 다국어 운영

1. **날짜**

* 2024-09-05

2. **목표**

* **ko/ja/en** 3개 언어 기준의 **일관된 다국어 UX** 확정
* 콘솔·정적 웹·알림 템플릿·리포트까지 **번역 파이프라인/검증/배포** 표준화

---

3. **내용**

### A. 설계 원칙

* **단일 소스·다중 출력**: 문구는 코드에서 분리(리소스 번들), 빌드 시 언어팩 주입
* **지역성 분리**: 언어(`lang`)와 규정/가격 등 지역(`region`)은 독립 관리
* **보안/감사**: 번역 파일 변경은 PR·리뷰 2인 승인, **감사 로그** 기록
* **성능**: 기본 번들 **지연 로딩**(언어별 청크), FCP 영향 최소화

### B. 아키텍처(개요)

```
/i18n
  /console             # 웹 콘솔 메시지
    /ko/*.json
    /ja/*.json
    /en/*.json
  /emails              # 이메일 템플릿 번역
  /sms                 # SMS 단문 템플릿
  /reports             # PDF/CSV 라벨·머리글
  schema.json          # 키/플레이스홀더 스키마
```

* 포맷: **ICU MessageFormat**(복수형/성 구문/서식)
* 로더: 콘솔은 **dynamic import**, 서버 템플릿(이메일/리포트)은 **서버 렌더**

### C. 언어/지역 결정 규칙

1. **URL 우선**: `/ko`, `/ja`, 그 외 `/en`
2. 없으면 **쿠키**: `px_lang=ko|ja|en`, 만료 180일
3. 최초 진입 시 **브라우저 locale** 힌트(ko→ko, ja→ja, 기타→en)
4. **지역 쿠키**: `px_region=kr|jp` (언어와 기본 맵핑: ko→kr, ja→jp, en→유지/선택)
5. 콘솔/웹 공통 헤더 스니펫(예시):

```javascript
// header-lang.js
(function(){
  const q = new URLSearchParams(location.search);
  const lang = q.get('px_lang') || (document.cookie.match(/px_lang=(\w+)/)||[])[1];
  const to = lang || (navigator.language||'en').slice(0,2);
  const dest = (to==='ko')?'/ko':(to==='ja')?'/ja':'/en';
  if(!location.pathname.startsWith(dest)) location.replace(dest + location.pathname + location.search);
})();
```

### D. 형식 규칙(표준 라이브러리)

* 시간/날짜: **Intl.DateTimeFormat**(사용자 타임존 표기), ISO/RFC3339는 원문 유지
* 숫자/통화: **Intl.NumberFormat**(KR ₩, JP ¥, EN $/€ 설정 가능)
* 복수형: ICU 규칙 사용 `{count, plural, one {...} other {...}}`
* 보안 텍스트: 코드/로그 키/URI는 **번역 금지**, 사람 문장만 번역

### E. 번역 워크플로우

1. **카탈로그 추출**: `yarn i18n:extract` → 신규/변경 키 **PO(JSON)** 생성
2. **번역**: ko 기준 → ja/en 번역(가이드: 丁寧だが 과도히 딱딱하지 않게)
3. **검증**: 스키마 검사(플레이스홀더·HTML 보존), 용어집/스타일 가드 체크
4. **시각 회귀**: Storybook i18n 스토리·Chromatic 스냅샷 비교
5. **배포**: 언어팩 버전 태깅 `i18n-2025.09.0` → CDN 캐시 무효화

### F. 템플릿(이메일/SMS/웹훅)

* 이메일: 마크다운/HTML 템플릿에 **문구 키만 삽입**, 링크는 **서명 URL**
* SMS: 140byte 제한 고려하여 **축약 번역** 별도 유지(ja는 전각 바이트 주의)
* 웹훅: 필드명은 고정, **설명 문자열만** 언어화 가능

### G. 접근성(a11y)·타이포

* 폰트: 콘솔 기본 **Noto Sans KR/JP + system-ui**, 영문은 Inter/Roboto
* 고정폭 숫자 UI는 **tabular-nums** 적용(표·대시보드 정렬)
* ARIA 라벨 번역 유지, 대비 4.5:1 이상

### H. 운영/테스트 지표

* **번역 커버리지**: 100% (미번역 키 콘솔 경고)
* **런타임 전환 지연**: 번들 로드 p95 ≤ 150ms
* **현지화 품질**: 고객 피드백/오류율(오역) 추적, 분기별 용어집 업데이트

### I. 에지 케이스 가이드

* 법/규정 문구는 **리전 정책 파일**에서 주입(`region.kr.yaml`, `region.jp.yaml`)
* 날짜 줄임/포맷(예: 2025-09-05 vs 2025年9月5日) **페이지 컨텍스트별** 지정
* 길이 차이 대응: 버튼/배지 **오토 레이아웃**(truncate·tooltip), 다국어 테스트 확대

---

4. **예시 설명 (JP 엔터프라이즈 테넌트 온보딩 화면)**

1) 고객이 `https://www.example.com/ja`로 진입 → `px_lang=ja`, `px_region=jp` 쿠키 설정
2) 콘솔 상단의 **Usage & Billing** 페이지에서 금액은 `Intl`로 **¥** 표기, 날짜는 `YYYY年M月D日`
3) **Incident Evidence** 카드의 “증거 패키지 다운로드”는 일본어 문구·법적 고지(※ 리전 외 반출 금지) 자동 주입
4) 이메일 알림은 **ja 템플릿** 사용, SMS는 **축약 번역**으로 전송(링크는 서명 URL)
   → 결과: URL·쿠키·리소스 번들이 일관되게 작동해 **무중단 언어 전환**과 **지역 규정 준수**를 동시에 달성.
