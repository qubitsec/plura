# 필상 시스템 — Day 92 운영 이벤트 스트림(EventHub) · 팀 알림·승인 워크플로우 · 변경 캘린더

1. **날짜**

* 2024-12-18

2. **목표**

* **운영 이벤트**(릴리스/플래그/경보/합성/쿼터/비용/PIA/주권/투명성 로그 등)를 **단일 EventHub**로 집결
* **팀별 구독·알림 라우팅·승인 워크플로우·변경 캘린더**를 통합 운영해 **MTTA↓/가시성↑/감사 연계** 달성

---

3. **내용**

### A. 이벤트 표준 & 소스

* 표준 스키마: `{event_id, ts, region, tenant?, source, type, severity, actor?, payload{}, links[]}`
* 소스: CI/CD(릴리스) · Feature Flags · OPA(정책 결정) · Notifier(알림) · Quota/FinOps · Synth/SLO · PIA/RoPA · TLog · SDG

### B. EventHub(수집/버스)

* 수집: HTTP/Kafka Ingest → 검증(JSON Schema) → 토픽 분기(`ops.change.v1`, `ops.alert.v1`, `ops.approval.v1`, `ops.calendar.v1`)
* 보존: 30일(실시간), 1년(요약집계), TLog 링크( Day 88 )

### C. 팀 구독/라우팅

* **구독 규칙**: `team:sre`는 `ops.alert.*`, `team:csirt`는 `security.*|ops.alert.*`, `team:finops`는 `quota|cost.*`
* 라우팅: Slack/Email/Webhook/Console Inbox(우선순위 큐), **근무시간/휴일 캘린더** 반영(대체 알림)

### D. 승인 워크플로우(고위험)

* 유형: `ops.approval.v1` — Flag 25%↑/Kill-Switch Off/Quota Override/Export Legal 예외/BYOK Revoke 등
* **2인 승인 + 타임락(15m)**, SoD( Day 81 ) 검사 → 승인/거부 이벤트가 **TLog**에 고정
* 콘솔: “Approve/Reject” 버튼(근거 입력 필수), 목적/기간/되돌리기 키 자동 표시

### E. 변경 캘린더

* 이벤트에서 **Change Window**·`freeze`( Day 77 )·유지보수(MW, Day 56) 태그 추출 → 캘린더 자동 갱신
* 고객 가시성(옵션): 주요 릴리스/점검·캠페인 일정 공유(ko/ja/en)

### F. 상관/자동화

* EventHub가 **릴리스/플래그/경보**를 상관 → 콘솔에 **타임라인** 오버레이( Day 80 )
* 자동 조치: `ops.alert` + `quota/finops` 급증 → **Anomaly Mitigation**( Day 73 ) 트리거

### G. 지표·SLO

* `event_latency_p95 ≤ 5s`, `approval_tat_p95 ≤ 15m`, `alert_to_ack_p95 ≤ 5m`
* `subscription_coverage=100%`(핵심 팀), `tlog_inclusion_gap=0`, `calendar_accuracy≥99%`

### H. API/CLI

* `POST /v1/eventhub/publish { ... }`
* `GET  /v1/eventhub/subscribe?team=sre`
* `POST /v1/eventhub/approval/decide { id, decision, reason }`
* `GET  /v1/eventhub/calendar?range=7d`
* CLI: `plura ev pub|tail|approve|calendar`

### I. 운영 체크리스트

* [ ] 모든 소스 시스템의 **EventHub 퍼블리셔** 활성
* [ ] 팀 구독 규칙/휴일 캘린더 최신화, 백업 라우팅 검증
* [ ] 고위험 승인 2인·타임락·SoD 준수, TLog 포함증명 링크 확인
* [ ] 변경 캘린더/타임라인이 콘솔/상태페이지와 동기화
* [ ] MTTA/승인TAT/캘린더 정확도 지표 모니터

---

4. **예시 설명 (Quota Override 승인 — 9분 내 처리, 감사 연계)**

1) 엔터프라이즈 테넌트가 캠페인 직전 `search_qps +50%` 요청 → `ops.approval.v1` 생성.
2) SoD/Freeze 검사 통과, 승인자 2인에게 라우팅(슬랙/모바일).
3) 9분 내 승인, Flag/Quota 변경 자동 적용 → EventHub에 승인·변경 이벤트 기록, **TLog 링크**로 감사 가능.
   → 결과: **EventHub + 구독·승인·캘린더** 통합으로 팀 간 가시성과 협업 속도가 향상되고, **고위험 변경은 감사 가능성**까지 보장.
