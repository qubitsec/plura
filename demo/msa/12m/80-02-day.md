# 필상 시스템 — Day 80 포스트모템(RCA) & 지속개선(CQI) 표준: 타임라인·근본원인·가드레일 반영

1. **날짜**

* 2024-12-02

2. **목표**

* **사건/성능/비용/보안** 이슈에 대한 **RCA**(포스트모템)를 **48시간 내** 완결하고,
  **가드레일/룰/플래그/런북**에 **자동 반영**되는 **지속개선(CQI)** 루프 정착
* **반복 이슈 재발률 ≤ 10%**, **개선 조치 이행률 100%** 달성

---

3. **내용**

### A. 범위 & 분류

* **범주**: 가용성(SLO), 성능, 비용/FinOps, 보안/사고(IR), 데이터 품질/DQ, 규제/컴플라이언스
* **심각도 연계**: T0/T1(의무 RCA), T2(선택), T3(교육용 요약) — Day 19, Day 39와 정합

### B. 표준 템플릿(요약)

```yaml
rca:
  id: RCA-20241202-XXX
  incident: { id: INC-01J..., severity: T1, region: kr, tenants: [TEN_*] }
  timeline:
    - { ts: "2024-12-02T01:12Z", event: "SLO 게이트 위반(search p95>800ms)" }
    - { ts: "2024-12-02T01:16Z", event: "자동 완화 TTL 90s 적용" }
    - { ts: "2024-12-02T01:23Z", event: "안정화 p95=720ms" }
  impact: { users: 3 tenants, duration: "11m", sla_hit: false, cost_delta_pct: +6.2 }
  root_cause:
    primary: "캐시 키 파라미터 누락으로 캐시 폭주"
    contributing: ["릴리스 체크리스트 누락", "템플릿 파라미터 검증 미흡"]
  evidence:
    dashboards: [ "grafana://d/search", "grafana://d/anomaly" ]
    traces:     [ "trace:01J..." ]
    queries:    [ "saved:q.fp_suspect", "saved:q.search_sla" ]
    epkg:       "s3://evidence/kr/INC-01J.../EPKG-Anomaly.zip"
  actions:
    fix_now:
      - { type: "flag", key: "search.cache.force_ttl", value: 90, revert_in: "2h" }
      - { type: "template_patch", id: "search_saved_query", change: "param allowlist 추가" }
    prevent:
      - { type: "gate", name: "release.checklist", rule: "캐시 키 검증 실패 시 배포 차단" }
      - { type: "test", name: "synthetic.cache-key", schedule: "1m" }
  owner: team-search
  due:
    fix_now: "2024-12-02T06:00Z"
    prevent: "2024-12-05T09:00Z"
  status: open|in_progress|done
```

### C. 절차(48h SLA)

1. **사건 종료 ≤ 30m** 후 **드래프트 생성**(타임라인 자동 채움: 상태페이지/릴리스/플래그/OTel 이벤트)
2. **근본원인 분석**: 5 Whys + Fault Tree + 변화 상관(릴리스/플래그/쿼터/실험/Anomaly)
3. **조치 계획**: `fix_now`(즉시/되돌리기 키 포함) + `prevent`(테스트/가드/교육/문서) 분리
4. **검토/승인**: 서비스 오너 + SRE/CSIRT(필요 시) **2인 승인**
5. **이행 추적**: CQI 보드(칸반)로 `due` 감시, 미이행 시 자동 에스컬레이션
6. **완결 & 전파**: KB/런북 업데이트, 릴리스 노트/변경 캘린더 반영, 교육/리뷰 세션 등록

### D. 자동 채움 & 근거화

* **타임라인**: 상태페이지·릴리스/플래그 이벤트·합성( Day 78 )·Quota/Anomaly( Day 72/73 )에서 자동 수집
* **증거 패키지**: 대시보드 스냅샷·Trace·로그·쿼리·서명 URL을 **EPKG-RCA**로 묶어 WORM 저장( Day 64 )
* **변화 상관**: ±30m 윈도우에서 변화 이벤트 KPI 영향도를 산출(전/후 p95, 비용, 노이즈)

### E. 예방조치 카탈로그(예)

* **게이트**: 릴리스 전 캐시 키 검증, 스키마·SIGMA/OCSF 정합 검사( Day 76 ), 성능/비용 예산( Day 18/29 )
* **플래그**: 검색 TTL/Expensive Query 차단, 알림 디듀프 강도, Edge PoW/Captcha( Day 44 )
* **테스트**: 합성 시나리오 추가( Day 78 ), 리플레이/회귀( Day 27/34/71 )
* **문서/교육**: 런북/KB 갱신( Day 30 ), 온콜/개발 교육(월간)

### F. 지표·SLO

* **RCA 리드타임**: 초안 ≤ 6h, 최종 ≤ 48h
* **재발률**: 동일 원인 카테고리 30일 내 **≤ 10%**
* **조치 이행률**: due 기준 **100%**, 지연 시 자동 에스컬레이션
* **지식 전파**: KB 조회/재사용률(사건 대응 시 KB 링크 사용 비율 ≥ 70%)

.  

### G. 대시보드/UX

* **RCA 인덱스**: 날짜/범주/리전/서비스/영향/완료율 필터
* **타임라인 뷰**: 이벤트·지표·Trace·알림을 시간축으로 중첩
* **액션 카드**: `fix_now`/`prevent` 진행률, 차단 게이트 통과 현황, 되돌리기 키 상태

### H. API/자동화(발췌)

* `POST /v1/rca/create { incident_id }` — 드래프트 자동 생성
* `POST /v1/rca/update { id, actions[], timeline[] }` — 수정/근거 첨부
* `POST /v1/rca/close { id }` — 완료(증거 검증·문서 반영 체크)
* `GET  /v1/cqi/board?team=search` — 개선 항목 칸반
* `POST /v1/gates/apply { gate, rule }` — 예방 게이트 배포(승인 2인)

### I. 거버넌스/정책

* **비난 금지(Blameless)**: 사람 대신 **프로세스/시스템** 개선 초점
* **주권/프라이버시**: RCA 공유물은 **시그니처/집계**만 포함(PII 제거), 교차 리전 공유는 요약본
* **감사**: 모든 편집·승인·완결은 **해시체인**으로 고정, EPKG-RCA 링크

### J. 운영 체크리스트

* [ ] 사건 종료 30m 내 **RCA 드래프트** 자동 생성 확인
* [ ] `fix_now`는 되돌리기 키·관찰 창 포함, `prevent`는 테스트/게이트 구체화
* [ ] KB/런북 갱신·교육 세션 등록(링크 첨부)
* [ ] 48h 내 **완결**·CQI 보드 티켓 상태 **녹색**
* [ ] 월간 RCA 리뷰: 재발 카테고리/지표 추세 분석 → 백로그 우선순위 조정

---

4. **예시 설명 (검색 p95 상승 T1 — 41분 안정화, 22h 내 RCA 완료)**

1) 01:12 SLO 게이트 발화 → 자동 완화(TTL 90s/템플릿 전용), 11분 내 p95 720ms 회복.
2) 30분 내 **RCA 드래프트** 생성, 타임라인/Trace/대시 자동 첨부.
3) 원인: 캐시 키 파라미터 누락 + 체크리스트 미준수. **fix_now**: 템플릿 패치·가드 플래그.
4) **prevent**: 릴리스 게이트 “캐시 키 검증” 신설 + 합성 케이스 추가.
5) 22시간 내 RCA 완료·승인, KB/런북 업데이트·교육 공지 발송. 30일 추적: 동일 원인 재발 **0건**.
   → 결과: **표준화된 RCA→CQI 루프**로 문제를 **빠르게 문서화·교정**하고, **예방 게이트**와 **테스트**로 재발을 구조적으로 차단.
