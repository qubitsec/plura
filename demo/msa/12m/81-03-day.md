# 필상 시스템 — Day 81 접근권한 거버넌스 & 정기 인증(Access Recertification) · SoD(업무분리) · JIT/JEA 연계

1. **날짜**

* 2024-12-03

2. **목표**

* 콘솔·API·운영/Bastion·데이터(Export/오브젝트) 전 경로의 **권한/역할/정책**을 **주기적으로 검토·인증**하여
  **최소권한·업무분리(SoD)**를 보장하고, **JIT/JEA( Day 37 )**·**OPA( Day 31 )**와 연계해 **영구 고권한 0건** 달성

---

3. **내용**

### A. 역할/권한 모델(요약 재확정)

* **역할(RBAC)**: `OWNER / ADMIN / ANALYST / READONLY / BILLING` (+ `AUDITOR`)
* **스코프(ABAC)**: `tenant_id, region, purpose, dataset(pii_level)`
* **민감 액션**: 룰/플래그 변경, Export/Erasure, 키/시크릿, Break-Glass, Bastion 접속 — **재인증 필수(We­­bAuthn, Day 66)**
* **정책 원칙**: **영구 Admin 금지**, 운영 변경은 **JIT + JEA**로만 수행

### B. SoD(업무분리) 매트릭스(발췌)

| 영역   | 권한 A            | 권한 B(동시 보유 금지)      | 이유/통제        |
| ---- | --------------- | ------------------- | ------------ |
| 운영변경 | `rules:write`   | `billing:modify`    | 비용/리스크 상충    |
| 데이터  | `export:run`    | `erasure:run`       | 증거 보전·추적성    |
| 보안   | `secrets:issue` | `connector:install` | 공급망·키 노출 리스크 |
| 접근   | `bastion:admin` | `audit:purge`       | 행위 은폐 리스크    |

> **예외**: 단기 PoC/장애 시 **JIT 예외 토큰(≤30m, 2인 승인)** 으로 한시 허용(감사 고정).

### C. 정기 인증(Recertification) 프로세스

1. **스냅샷 생성(매월/분기)**: `user→roles/scopes` & 최근 90일 **사용 흔적**(권한 사용 증거) 자동 수집
2. **오너 검토**: 팀/테넌트 오너가 **보유 사유·사용 이력**을 보고 `Approve/Reduce/Revoke` 결정
3. **SoD/정책 검사**: OPA가 **금지 조합**·**무사용 권한**·**만료 JIT** 탐지 → 기본 `Revoke` 권고
4. **조치 실행**: 승인 결과에 따라 권한 변경·JIT 템플릿 전환·교육 요청 생성
5. **증거화**: 모든 결정·근거를 **해시체인**으로 고정(감사 인덱스), 리포트 발행

### D. 무사용·과권한 자동 감지 규칙

* **무사용 권한**: 90일간 **행동 이벤트 없음**(`console.action.v1`, `ops.change.v1`, `export.*`) → `Revoke` 제안
* **과권한**: 역할 대비 **최대 스코프 초과**(다중 테넌트/리전) → `Reduce` 제안
* **JIT 미준수**: 운영 변경을 **JIT 없이** 수행 시도 기록 → 다음 인증에서 **강제 JIT 전환**

### E. 데이터 권한/다운로드 가드(Export/객체)

* `pii_level=P0/P1` 데이터는 **2인 승인 + 서명 URL 10분 + 워터마크**( Day 24·64 )
* **RLS/주권 강제**: `tenant_id/region` 필수, 교차 전송 **deny**
* **감사**: 다운로드·전달(웹훅) **목적(purpose)** 기록, **EPKG-Export** 링크 첨부( Day 74 )

### F. 지표·SLO

* **영구 Admin 계정 0건**, **고권한(JIT 제외) 0건**
* 분기 인증 완료율 **100%**, 제한 기간 초과 **0건**
* **무사용 권한 제거율 ≥ 95%**, SoD 위반 잔존 **0건**
* **감사 누락 0건**(결정·변경·다운로드 이벤트 모두 해시체인 연결)

### G. 대시보드/UX

* **Access Review 보드**: 사용자/역할/스코프/최근 사용 이벤트/권고(Approve/Reduce/Revoke)
* **SoD 경고 배지**: 금지 조합/예외 만료 임박 표시
* **원클릭 조치**: `Revoke` 또는 `JIT 전환` 버튼 → 변경 전 **재인증(We­­bAuthn)**

### H. 정책(OPA) 예시

```rego
package access.recertain

default allow = true

# 영구 Admin 금지
deny[msg] {
  input.role == "ADMIN"
  not input.session.jit   # JIT 세션 아님
  msg := "permanent ADMIN not allowed"
}

# SoD 금지 조합
deny[msg] {
  some a, b
  input.roles[a] == "rules:write"
  input.roles[b] == "billing:modify"
  msg := "SoD: rules:write + billing:modify forbidden"
}

# 무사용 권한 자동 Revoke 제안
suggest[action] {
  input.last_used_days > 90
  action := {"type":"revoke", "reason":"unused > 90d"}
}
```

### I. API/자동화(발췌)

* `GET  /v1/access/review/snapshot?period=Q4-2024` — 사용자·역할·사용 이력 스냅샷
* `POST /v1/access/review/decide { user, role, decision, reason }` — 승인/감소/회수
* `POST /v1/access/role/assign { user, role, scope }` — 역할 변경(We­­bAuthn 재인증)
* `POST /v1/access/jit/require { role, scope }` — 고권한 역할 **JIT 의무화**
* `GET  /v1/access/sod/violations?range=90d` — SoD 위반 요약/세부

### J. 운영 체크리스트

* [ ] 분기 시작 7일 전 스냅샷 생성·오너 통지, 14일 내 완료
* [ ] **무사용 권한 자동 제안** 반영, 예외는 `owner/ttl/사유` 필수
* [ ] SoD 위반 0건—예외는 **JIT+2인 승인**으로 한시 허용
* [ ] Export/Erasure/키 관리 권한은 **2인 승인 + 재인증** 강제
* [ ] 모든 조치·결정은 **감사 해시체인** 고정, 리포트 보관

---

4. **예시 설명 (분기 인증 — 무사용·SoD 위반 해소, 영구 Admin 0건 유지)**

1) Q4 스냅샷 생성: `users=312`, 제안 `Revoke 48`, `Reduce 19`, SoD 위반 3건 탐지.
2) 오너 검토 후 **48건 회수**, **19건 스코프 축소**, SoD 3건은 **JIT 예외 30분**으로 전환 후 분리.
3) Bastion 고권한 2건을 **JIT 의무화**로 변경, 영구 Admin **0건** 유지.
4) Export 고위험 권한 1건은 `purpose` 누락 기록 → 재교육·템플릿 수정.
   → 결과: **정기 인증 + SoD + JIT/JEA** 결합으로 **최소권한·추적성**을 유지하고, 고권한 상주 리스크를 제거—규제/감사 대응력을 강화.
