# 필상 시스템 — Day 86 PIA/DPIA 자동화 · 처리활동기록(RoPA) · 벤더/위탁 관리 연계

1. **날짜**

* 2024-12-10

2. **목표**

* **PIA/DPIA**(개인정보 영향평가)·**RoPA**(Records of Processing Activities)·**벤더/위탁(DPA/SCC)** 를 **자동화 파이프라인**으로 통합
* **데이터 흐름(수집→저장→사용→전송→파기)**를 **목적구속·주권·최소화( Day 85/57/71 )** 규칙과 연계하여
  **평가 리드타임 70%↓**, **미평가 처리경로 0건**, **감사 대응 TAT ≤ 24h**

---

3. **내용**

### A. 범위/용어

* **PIA/DPIA**: 신규 기능/데이터 흐름의 **위험·완화** 평가(법적 근거/목적/PII/보안조치).
* **RoPA**: 처리 목적·범주·주체·수신자·보존·국외 이전 여부 등 **정적 기록**.
* **벤더/위탁**: TI/메일/SMS/SIEM/클라우드 등 **제3자 처리자**(DPA·SCC·서브프로세서 목록).

### B. 아키텍처(자동화 파이프라인)

```
Change/RFC → Data Flow Scanner(코드/스키마/플래그) → PIA/DPIA Engine(위험 산정)
          → RoPA Catalog 업데이트 → OPA(목적/주권/PII) 정책 교차검증
          → Gate(배포 전) / CQI 보드(개선 항목) / 감사용 EPKG-PIA 저장(WORM)
```

* **입력 소스**: OpenAPI/AsyncAPI, 이벤트 스키마(OCSF, Day 76), 목적 정책( Day 85 ), 레이크하우스 카탈로그( Day 71 ), 커넥터 메타( Day 69 ).

### C. 위험 산정 모델(점수화)

`Risk = L(가능성: 1~5) × I(영향: 1~5) − C(보정통제: 0~4)`

* **가능성**: 신규 수집, 외부 전송, 벤더 변경, 합성데이터 미사용, 대량 처리.
* **영향**: PII 등급(P0/P1), 데이터 주체 규모, 민감 카테고리, 법적 페널티.
* **보정통제**: 토크나이제이션( Day 82 ), BYOK/HYOK( Day 83 ), WORM( Day 64 ), 목적구속( Day 85 ) 등.

### D. 게이트(배포 전 필수 통과)

* **자동 체크**

  1. **목적/법적 근거** 매핑(`contract|legitimate_interest|consent|legal`)
  2. **주권**(region=token.region), **교차 리전 전송 금지**
  3. **PII 최소화**(원문→시그니처/가명·합성)
  4. **보존/파기**(수명주기 룰 적용, Day 64/42)
  5. **벤더 DPA/SCC** 유효성·저장 지역
* **결과**: `pass | pass_with_actions | block` (+ 개선 액션 목록/타임락/승인자)

### E. RoPA 스키마(요약)

```yaml
record:
  id: ROPA-2024-12-0101
  controller: QubitSecurity
  processor: [ "MailVendor(KR)", "TIProvider(JP)" ]
  purpose: security
  lawful_basis: legitimate_interest
  data_subjects: ["customers","employees?"]
  data_categories: ["network identifiers(ip_bucket)","event logs(param_sig)"]
  transfers: { cross_region: false, recipients: ["KR region S3"] }
  retention: { policy: "logs 90d(index)/3y(archive)", legal_hold: "optional" }
  safeguards: ["tokenization","BYOK","WORM","RLS","mTLS","OPA-purpose"]
  last_review: 2024-12-10
```

### F. 워크플로우(PIA/DPIA)

1. **스캐닝**: PR/RFC에서 **새 필드/전송/벤더** 감지 → 위험 초안 자동 산정.
2. **질문지 자동 채움**: 법적 근거/목적/보존/주권/보안조치 제안값 생성.
3. **검토/보완**: 오너가 근거·대안 입력 → OPA 시뮬레이터로 정책 충돌 감지.
4. **게이트 판단**: `pass_with_actions`면 **플래그/가드/문서** 자동 생성.
5. **EPKG-PIA** 생성: 평가서·증거·정책·결정 링크를 WORM 저장(감사 대비).

### G. 벤더/위탁 관리 연계

* **벤더 레지스터**: 도메인/지역/보존/암호화/사건통지 SLA/서브프로세서.
* **모니터링**: KEV/EPSS( Day 48 )·침해 공지·평판 → 위험 점수 상향 & 자동 재평가.
* **데이터 경로 테스트**: 월 1회 **목적·주권 위반 시뮬레이터**(교차 리전/PII 원문 전송 차단 확인).

### H. 대시보드/지표·SLO

* **SLO**: 신규/중대 변경 **PIA 초안 ≤ 6h**, 최종 승인 **≤ 48h**
* 지표: `pia_backlog`, `pass_with_actions%`, `block_count`, `ropa_coverage=100%`, `vendor_risk↑ events`, `audit_tat`
* 경보: `ropa_missing>0` 또는 `purpose_mismatch_denies>0` 증가 시 **T1**

### I. API/자동화(발췌)

* `POST /v1/pia/scan { rfc_id }` — 변경 스캔·초안 생성
* `POST /v1/pia/approve { id, actions[] }` — 승인(2인·타임락 가능)
* `GET  /v1/ropa/records?region=kr` — 처리활동 목록/필터
* `POST /v1/vendor/update { id, dpa, scc, region, sla }` — 벤더 메타 갱신
* `GET  /v1/pia/audit?range=30d` — 감사용 요약/EPKG 링크

### J. 운영 체크리스트

* [ ] RFC/배포 파이프라인에 **PIA 스캐너** 의무화
* [ ] RoPA 카탈로그 최신화(처리자/보존/전송/보안조치)
* [ ] 목적·주권·최소화 위반은 **즉시 Block** + 가이드·템플릿 제시
* [ ] 벤더 위험 신호(KEV/EPSS/침해) 발생 시 **자동 재평가**
* [ ] 감사용 **EPKG-PIA** 월간 점검(무결성/접근권한)

---

4. **예시 설명 (신규 커넥터 ‘DataHub’ 도입 — PIA 7h 승인, Block→보완 후 통과)**

1) 스캐너가 **외부 전송·Parquet Export** 경로 감지 → 위험 18점(중), `block` 제안(주권·목적 미정).
2) 오너가 목적 `customer_report`, **lake_view + Parquet**(마스킹)로 변경, **BYOK** 강제·보존 365d 설정.
3) 재평가 결과 `pass_with_actions`: OPA 목적·주권 통과, DPA/SCC·SLA 업로드.
4) 총 7시간 내 승인, RoPA 기록/벤더 레지스터 갱신, EPKG-PIA 저장.
   → 결과: **PIA/DPIA 자동화 + RoPA/벤더 연계**로 변경 속도를 유지하면서 **규정·주권·최소화**를 체계적으로 보장.
