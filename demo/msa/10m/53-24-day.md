# 필상 시스템 — Day 53 랜섬웨어 대응 전략(조기탐지·격리·백업 불변성·복구·협상불개입)

1. **날짜**

* 2024-10-24

2. **목표**

* **조기 징후 탐지 → 신속 격리(L2) → 불변(Immutable) 백업 검증 복구**까지의 **T0 대응 플로우** 표준화
* **이중갈취(데이터 유출+암호화)** 시 **증거 중심**으로 대응, **협상·지불 금지 정책**과 **고객/당국 커뮤니케이션** 정립

---

3. **내용**

### A. 조기 탐지 신호(High-Signal)

* **엔드포인트**: 대량 `FileCreate/Write` 급증, 확장자 변환/암호화 헤더 패턴, `vssadmin delete shadows`, `wbadmin DELETE`, `bcdedit` 수정, `rundll32 advpack`/`regsvr32` LOLBAS
* **네트워크**: SMB 대량 쓰기/권한 거부 증가, 토렌트형 C2(TLS JA3/JA4 패턴), TOR/Onion 서비스 접속
* **권한 상승**: `LSASS` 핸들 접근, `SeDebugPrivilege` 상승, 의심스러운 AD 티켓 활동(Kerberoasting 지표)
* **백업 표적화**: S3/MinIO **삭제/만료 정책 변경 시도**, KMS 키 비활성/회전 시도

### B. 즉시 완화(Containment) 레벨

* **L2 격리(15분 내)**: 감염 의심 호스트 **네트워크 완전 격리**(mTLS·Bastion만 허용), 관리자만 접근
* **권한 강제 조정**: 침해 의심 계정 **비밀번호/토큰 즉시 회전**, JIT 세션 **만료**
* **스토리지 보호**: Object Storage **WORM/버전닝·MFA Delete** 강제 확인, `legal_hold` 필요 시 즉시 설정
* **키 보호**: KMS **키 파기 금지 플래그**(time-lock) 활성, 로테이션 계획 분리

### C. 불변 백업 & 복구 표준

* **백업 계층**: 앱 스냅샷(분 단위) + 파일/오브젝트 버전닝 + 원격(동일 리전) 불변 저장
* **무결성 검증**: 스냅샷/오브젝트 **sha256**·루트 해시 검증 + **랜덤 샘플 복호화 테스트**
* **복구 순서**: Meta-DB(PITR) → 검색(Solr 스냅샷) → 오브젝트 매핑 재생 → 인입 파이프라인 재가동
* **데이터 주권**: **교차 리전 전송 금지**, 복구는 영향 리전 내에서만 수행

### D. SOAR 플레이북(표준 플로우)

1. **트리거**: 고신호 룰/모델 히트 or DBV360 `verdict=block(≥0.8)`
2. **격리/수집**: EDR **L2 격리** → **LR 프로파일** 수집(프로세스/FS 변동/ScriptBlock/MFT) → **EPKG-Lite** 생성
3. **백업 점검**: 최신 스냅샷/버전 유효성 체크, `MFA Delete`·`WORM` 상태 확인
4. **복구 의사결정**: 감염 반경 스코어(호스트·공유폴더·테넌트) 계산 → **부분 복구** 우선
5. **사후 조치**: IOC 차단(도메인/해시), 취약점/구성 취약점 패치, 비밀/키 **강제 로테이션**
6. **커뮤니케이션**: 상태페이지 초안(사실/지표/완화) → 고객/당국 통지(정책/법 요구 충족)
7. **RCA & 예방**: 초기 침투 벡터/권한 상승/백업 공격 경로 문서화, 룰·플래그·훈련 갱신

### E. 정책/가드레일

* **협상·지불 금지**: 몸값 지불 불가(법적/재발 위험), **복구·증거·법적 절차**로 일관 대응
* **삭제 방지**: 백업/감사/증거(EPKG)에는 **불변/WORM**·서명·해시체인 의무
* **변경 창 제한**: 사건 중 비가역 구성 변경 **금지**, 롤백 가능한 플래그/가드만 활용
* **DLP 강화**: 데이터 유출 정황 시 **서명 URL 금지**, 요약 메타만 공유

### F. SLO·지표

* **탐지→격리**: P95 **≤ 15분**
* **격리→최소 복구(핵심 서비스)**: **≤ 2시간**
* **완전 복구(데이터)**: **≤ 24시간**(피크 3TB 기준, 스냅샷 유효 시)
* **무결성 실패율**: 스냅샷 검증 실패 **0%**
* **재감염률**: 30일 내 **< 2%**

### G. 인터페이스/API(발췌)

* `POST /v1/edr/isolate {host, mode:"full", reason:"ransomware-signals", incident_id}`
* `POST /v1/lr/collect {host, profile:"ransom-core", out:"s3://.../EPKG"}`
* `POST /v1/backup/validate {scope, snapshot_id}` / `POST /v1/backup/restore {scope, point_in_time}`
* `POST /v1/kms/lock {key_id, ttl}` — 키 파기/변경 타임락
* `POST /v1/notify/authority {incident_id, scope, evidence_uri}` — 당국 통지(지역 규정 템플릿)

### H. 운영 체크리스트

* [ ] EDR L2 격리 단축키/권한 사전 검증, LR 프로파일 30분 내 수집 가능
* [ ] WORM/MFA Delete 설정 **정기 점검**, 스냅샷 **복원 리허설 월 1회**
* [ ] 백업/복구 **성능 가이드**(IOPS/대역폭/동시성) 문서화
* [ ] 당국 통지·고객 커뮤니케이션 템플릿(ko/ja/en) 최신화
* [ ] 사건 종료 후 **RCA+예방 조치** 72h 내 완료, 룰/플래그 갱신

---

4. **예시 설명 (T0—파일 서버 부분암호화, 6시간 내 서비스 정상화)**

1) `vssadmin delete shadows` + SMB 대량 오류로 **T0 선언**, 감염 워크스테이션/파일 서버 **L2 격리(10분)**.
2) LR 프로파일 수집(25분), EPKG-Lite 고정. KMS **time-lock**으로 키 파기 방지.
3) 스냅샷 무결성 통과 → 영향 공유폴더만 **부분 복구(1.6h)**, 핵심 서비스 2h 내 정상화.
4) C2/TOR IOC 차단, 취약 RDP 게이트 폐쇄·MFA 강제, 비밀 전면 로테이션.
5) 18h 내 RCA: 초기 침투(취약 VPN) + 권한 상승(LAPS 미적용) 규명, 예방 조치 배포/훈련 갱신.
   → 결과: **조기 탐지·격리·불변 스냅샷 복구** 체계로 금전 지불 없이 **가용성 회복과 증거 보전**을 동시 달성.
