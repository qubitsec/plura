# 필상 시스템 — Day 48 취약점 관리(Vuln Mgmt) · VEX · EPSS/KEV · 패치 오케스트레이션

1. **날짜**

* 2024-10-17

2. **목표**

* **SBOM→취약점 매핑→VEX 판단→위험 점수화(EPSS/KEV/자산 중요도)**까지 일관 흐름 확립
* **패치/완화 오케스트레이션**과 **예외(만료 포함) 관리** 표준화 → **Critical 48h, High 7d** 준수

---

3. **내용**

### A. 데이터 소스 & 동기화

* **SBOM(CycloneDX)** + 이미지/패키지 메타(해시·버전)
* **취약점 피드**: NVD, CISA **KEV**, EPSS, 벤더 보안 공지
* **동기화 주기**: KEV/EPSS 4h, NVD 12h, 벤더 즉시 웹훅

### B. 자산·구성 요소 매핑

* `asset(id, svc, env, region, owner, tier)` ↔ `component(purl, version, image_digest)`
* **노출면**: 인터넷/내부, mTLS 유무, 권한 경로(RBAC/ABAC)
* **보호장치**: WAF 룰/네트워크 정책/격리 여부(보정통제 점수에 반영)

### C. 위험 점수(Risk Score) 규칙

`risk = w1*CVSS + w2*EPSS + w3*KEV + w4*ExploitSight + w5*AssetCriticality − w6*CompControls`
기본값: `w1=0.25, w2=0.25, w3=0.2, w4=0.15, w5=0.1, w6=0.15`

* **임계**: `risk ≥ 0.80 → Critical`, `0.60–0.79 → High`, `0.35–0.59 → Medium`, 그 외 Low

### D. VEX(Exploitability) 처리

* 공급자/우리가 생성한 **VEX 문서**로 *Not Affected/Fixed/Under Investigation* 표시
* **Not Affected**는 자동 **제외(Deferred)**, 30일 후 재평가
* **Under Investigation**은 **완화 조치**(WAF/Feature Flag/Rate Limit)와 함께 Triage 대기

### E. SLA & 예외

* **패치/완화 기한**: Critical 48h / High 7d / Medium 30d / Low 90d
* **예외(Defer)**: 근거·보정통제·**만료일 필수**, 만료 7일 전 자동 알림 → 초과 시 **변경 동결** 또는 레이트리밋 강화

### F. 패치 오케스트레이션(표준 플로우)

1. **감지**: 피드 수신 → SBOM 매칭 → 위험 점수 산정
2. **평가**: VEX 적용·폭발반경(서비스·리전·테넌트) 산출
3. **승인**: RFC 생성(리스크 L2/L3), CAB/2인 승인
4. **스테이징**: KR-stg **canary 5→25→100%**, 합성 시나리오 통과
5. **프로덕션**: KR→JP 순차, 실패 시 **자동 롤백**(이전 stable)
6. **검증/종결**: 취약 컴포넌트 소거 확인, EPKG·릴노트 링크 고정

### G. 자동화 훅 & API

* `POST /v1/vuln/ingest` — NVD/KEV/EPSS/VEX 수신
* `GET /v1/vuln/impact?cve=CVE-YYYY-XXXX` — 영향 자산/서비스 목록
* `POST /v1/vuln/exception` — 예외 생성(근거·보정·만료)
* `POST /v1/vuln/patch/rollout { cve, env, region, strategy: "canary|bluegreen" }`
* `GET /v1/vuln/status?svc=incident-svc` — 잔여 리스크/기한/노출창

### H. 관측 지표(KPI)

* **MTTDv/MTTRv**(취약점 발견/해결 시간), **SLA 위반 수**, **예외 부채(잔여위험)**
* **패치 커버리지**(자산/컴포넌트 비율), **롤백율**, **보정통제 적중률**
* 대시: `risk>0.8 미해결`, 서비스·리전별 노출창, KEV 대기건

### I. 가드레일

* 프로덕션 배포 전 **성능·기능 회귀** 및 **SLO 게이트**(p95 지연/오류율) 필수
* **교차 리전 데이터 전송 금지**(주권), 패치/완화는 리전별 독립 진행
* **다운그레이드 금지** 정책(서명·프로비넌스 검증 실패 시 거부)

### J. 운영 체크리스트

* [ ] SBOM 100% 커버리지·일일 갱신
* [ ] KEV/EPSS 핫라인 4h 이내 처리
* [ ] 예외 항목 **만료일·보정통제** 확인(자동 리마인더)
* [ ] 패치 실패 시 **롤백 & RCA 48h** 내 완료
* [ ] 월간 **Vuln 리포트**(서비스/리전/테넌트) 발행

---

4. **예시 설명 (CVE-2024-XXXX — Critical 36h 내 종결)**

1) KEV 등재 + EPSS 0.85 → `risk=0.88(Critical)` 산출, 영향: `console`, `ingestor` 이미지 3태그.
2) VEX: `console` 일부 경로 **Not Affected** → 해당 태그는 **Deferred(30d)** 처리.
3) RFC(L2) 승인 후 **KR-stg canary** 배포, 합성 시나리오 정상 → **KR-prod 5→25→100%**, 이어 **JP** 동일 절차.
4) 롤백 0건, 성능 SLO 유지. 패치 후 **잔여 위험 0**, 예외건은 만료 알림 예약.
   → 결과: **SBOM/VEX/EPSS/KEV** 연동과 **표준 오케스트레이션**으로 **Critical 36h** 내 종결, 변경은 전부 **증거화·감사 연동**되어 재현 가능.
