# 📘 MSA 개발을 위한 사전 설명 문서

## 29일차 – 쿠버네티스 배포 전략

**날짜: 7월 29일**

---

## 주제

# **29. 배포 전략: Rolling · Blue-Green · Canary**

> “배포는 코드 문제가 아니라 **리스크 관리**다”

---

## 1️⃣ 왜 배포 전략이 중요한가

쿠버네티스는 **무중단 배포를 가능하게** 하지만,
**어떤 방식으로 바꿀지**는 우리가 정해야 합니다.

* 새 버전이 문제를 일으키면?
* 일부 사용자만 먼저 써보게 하려면?
* 빠르게 되돌려야 한다면?

👉 이 질문에 답하는 것이 **배포 전략**입니다.

---

## 2️⃣ Rolling Update (기본 전략)

### 개념

* 기존 Pod를 **조금씩** 새 Pod로 교체
* 쿠버네티스 Deployment의 기본 동작

### 흐름

1. 새 버전 Pod 생성
2. Readiness 통과
3. 기존 Pod 하나 종료
4. 반복

### 장점

* 설정이 간단
* 추가 인프라 필요 없음
* 대부분의 서비스에 적합

### 단점

* 구버전/신버전 **혼재 기간** 발생
* DB 스키마 변경이 까다로움

📌 **기본값이지만 만능은 아님**

---

## 3️⃣ Blue-Green Deployment

### 개념

* **두 개의 완전한 환경**을 준비

  * Blue = 현재 운영
  * Green = 새 버전
* 트래픽을 **한 번에 전환**

```
Client
 → Service
   → (Blue → Green 전환)
```

### 장점

* 전환이 즉시 가능
* 롤백이 매우 빠름
* 테스트 환경을 실제 트래픽과 동일하게 구성 가능

### 단점

* 리소스 2배 필요
* 전환 순간의 리스크 관리 필요

📌 **안정성·롤백이 최우선일 때 적합**

---

## 4️⃣ Canary Deployment

### 개념

* 새 버전을 **일부 사용자에게만** 점진 노출
* 문제 없으면 비율을 점점 확대

### 흐름

1. 1~5% 트래픽 → 새 버전
2. 지표/에러 관찰
3. 문제 없으면 10% → 50% → 100%

### 장점

* 리스크 최소화
* 실제 사용자 행동 기반 검증
* 장애 조기 감지

### 단점

* 트래픽 분기 설정 필요
* 관측(메트릭/로그) 없으면 불가
* 운영 복잡도 증가

📌 **대규모 서비스·중요 변경에 최적**

---

## 5️⃣ 전략별 비교 요약

| 전략         | 리스크   | 롤백 속도 | 복잡도 | 적합한 경우         |
| ---------- | ----- | ----- | --- | -------------- |
| Rolling    | 중     | 중     | 낮음  | 대부분의 기본 배포     |
| Blue-Green | 낮음    | 매우 빠름 | 중   | 빠른 롤백이 중요한 서비스 |
| Canary     | 매우 낮음 | 빠름    | 높음  | 대규모/고위험 변경     |

---

## 6️⃣ 배포 전략 선택 기준 (실무 체크리스트)

* ❓ 장애 허용 범위는?
* ❓ 롤백은 얼마나 빨라야 하나?
* ❓ 트래픽 분기/관측이 가능한가?
* ❓ 리소스 여유는?
* ❓ DB 변경이 동반되는가?

👉 **전략은 기술이 아니라 상황 선택**

---

## 7️⃣ 배포 전 반드시 준비할 것

### 필수 조건 5가지

1. **Readiness/Liveness** 설정
2. **명확한 이미지 버전**
3. **빠른 롤백 경로**
4. **메트릭/알림**
5. **DB 변경 전략(Backward Compatible)**

---

## 8️⃣ 흔한 실패 패턴

* ❌ DB 스키마를 먼저 깨버림
* ❌ 관측 없이 Canary 진행
* ❌ 롤백 경로 없는 배포
* ❌ 배포 전략을 “한 가지”로 고정

---

## 9️⃣ 결론: 배포는 ‘마지막 방어선’이다

* 배포 전략은 사고를 **막는 도구**
* 쿠버네티스는 수단, 판단은 사람
* **가장 안전한 배포는 ‘되돌릴 수 있는 배포’**

> **좋은 배포 전략은
> 성공을 빠르게 만드는 것이 아니라
> 실패를 작게 만든다**

---

## ✅ 오늘의 핵심 요약

* Rolling은 기본, Canary는 최소 리스크, Blue-Green은 빠른 롤백.
* 배포 전략은 서비스 특성에 맞춰 선택한다.
* 관측과 롤백 없이는 어떤 전략도 위험하다.
* DB 변경은 항상 배포 전략과 함께 설계한다.
* 배포는 운영의 마지막이자 가장 중요한 단계다.

---
