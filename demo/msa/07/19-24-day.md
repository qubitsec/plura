## 24일차 – 쿠버네티스 핵심 개념

**날짜: 7월 19일**

---

## 주제

# **24. Deployment & ReplicaSet**

### 선언적 배포와 롤링 업데이트

> “쿠버네티스는 ‘명령’이 아니라 ‘원하는 상태’를 관리한다”

---

## 1️⃣ 왜 Pod만으로는 운영이 안 되는가

Pod의 특성부터 다시 짚어봅시다.

* 언제든 죽을 수 있음
* IP가 바뀜
* 직접 만들면 자동 복구/확장 없음

그래서 운영에서는 **Pod를 직접 다루지 않습니다.**
Pod를 **관리해 주는 상위 객체**가 필요합니다.

---

## 2️⃣ Deployment란 무엇인가 (가장 중요)

**Deployment**는 다음을 선언합니다.

* Pod 템플릿은 무엇인가
* **몇 개(Replicas)** 를 유지할 것인가
* 업데이트는 **어떻게** 할 것인가

한 문장으로 요약하면:

> **Deployment는 “이 상태가 항상 유지되길 원한다”는 선언이다**

---

## 3️⃣ ReplicaSet의 역할

**ReplicaSet**은 Deployment의 하위 구성요소입니다.

* 지정된 개수의 Pod를 **항상 유지**
* Pod가 죽으면 **즉시 새 Pod 생성**

실무 원칙

> **ReplicaSet을 직접 만들지 않는다**
> → 항상 **Deployment를 통해** 관리

---

## 4️⃣ Deployment · ReplicaSet · Pod 관계

```
Deployment
   ↓
ReplicaSet
   ↓
Pod (n개)
```

* Deployment: 정책·전략
* ReplicaSet: 수량 유지
* Pod: 실제 실행

역할 분담이 명확합니다.

---

## 5️⃣ 선언적 배포(Declarative Deployment)

쿠버네티스의 핵심 사고방식입니다.

### 명령형 사고

* “Pod 3개 만들어”
* “이 Pod 지워”

### ✅ 선언형 사고

* “항상 Pod 3개가 있어야 해”
* “이 이미지 버전을 사용해”

쿠버네티스는:  
  .  

* 현재 상태를 관찰하고
* 원하는 상태와 다르면
* **자동으로 맞춥니다**

---

## 6️⃣ 롤링 업데이트(Rolling Update)란?

Deployment는 기본적으로 **무중단 배포**를 제공합니다.

### 동작 방식

1. 새 버전 Pod를 하나 띄움
2. 정상 확인(Readiness OK)
3. 기존 Pod 하나 제거
4. 이 과정을 반복

사용자는 **중단을 거의 느끼지 못함**

---

## 7️⃣ 롤링 업데이트의 핵심 설정 개념

### replicas

* 유지해야 할 Pod 개수

### maxUnavailable

* 동시에 내려가도 되는 최대 Pod 수

### maxSurge

* 업데이트 중 **추가로** 허용할 Pod 수

이 값들이

* 가용성
* 배포 속도
* 자원 사용량

을 좌우합니다.

---

## 8️⃣ 배포 실패 시 어떻게 되는가  
  .  

### Pod가 계속 실패하면

* 새 Pod가 Ready 되지 않음
* 기존 Pod는 유지
* 배포가 **중단된 상태로 멈춤**

“다 날리고 새로”가 아니라
**안전하게 멈춤**

---

## 9️⃣ 흔한 실수 패턴

### Pod를 직접 수정

* 재시작 시 원복됨

### latest 이미지 사용

* 어떤 버전이 도는지 추적 불가

### Readiness Probe 없음

* 트래픽이 준비 안 된 Pod로 유입

---

## 1️⃣0️⃣ 운영 관점의 핵심 원칙

### ✅ 5가지 원칙

1. **항상 Deployment로 배포**
2. Pod는 소모품으로 취급
3. 이미지 버전은 명확히
4. Readiness/Liveness 설정
5. 롤백 가능한 배포 전략 유지

---

## 1️⃣1️⃣ 결론: Deployment는 ‘운영의 기본 단위’다

* Pod는 실행 단위
* ReplicaSet은 유지 장치
* Deployment는 **운영 전략**  
   

> **쿠버네티스 운영은
> Deployment를 이해하는 순간부터 시작된다**

---

## ✅ 오늘의 핵심 요약

* Pod는 직접 운영하지 않는다.
* Deployment가 Pod의 수명·배포를 관리한다.
* ReplicaSet은 Pod 개수를 유지한다.
* 선언적 배포가 쿠버네티스의 핵심 철학이다.
* 롤링 업데이트로 무중단 배포가 가능하다.

---
