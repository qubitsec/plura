## 20일차 – 컨테이너 실습 전 단계

**날짜: 7월 15일**

---

## 주제

# **20. Docker Compose로 로컬 MSA 구성 맛보기**

> “쿠버네티스로 가기 전에,
> 여러 서비스를 **한 번에 띄워보는 감각**부터 익힌다”

---

## 1️⃣ 왜 Docker Compose가 필요한가

지금까지 우리는 다음을 배웠습니다.

* 서비스는 여러 개다
* 설정은 분리한다
* 이미지는 불변이다
* 서비스 간 통신이 존재한다

그런데 로컬 개발 환경에서 이런 상황이 됩니다.

* 서비스 A 실행
* 서비스 B 실행
* DB 실행
* 메시지 브로커 실행
* 포트/환경변수 일일이 설정

**이걸 매번 수동으로 하면 개발이 불가능**합니다.

그래서 등장하는 도구가 **Docker Compose**입니다.

---

## 2️⃣ Docker Compose란 무엇인가

**Docker Compose**는
여러 컨테이너를 **하나의 애플리케이션처럼** 정의하고
**한 번에 실행/중지**할 수 있게 해주는 도구입니다.  
  .  

* `docker-compose.yml` 하나로
* 서비스 구성, 네트워크, 설정을 선언
* `docker compose up` 한 번으로 전체 실행

---

## 3️⃣ Compose의 핵심 개념 3가지

### ✅ 1) 서비스(Service)

* 실행할 컨테이너 정의
* 이미지, 포트, 환경변수 포함

### ✅ 2) 네트워크(Network)

* 서비스 간 통신을 자동 구성
* 서비스 이름 = DNS 이름

### ✅ 3) 볼륨(Volume)

* 데이터 유지
* 컨테이너 재시작 시 데이터 보호

---

## 4️⃣ 가장 단순한 MSA 로컬 구성 예시

개념적으로 이런 구조를 만듭니다.

```
[ API Service ]
       |
[ DB Service ]
```

Compose 파일 하나로 두 컨테이너를 함께 띄웁니다.

---

## 5️⃣ docker-compose.yml의 기본 구조

아주 단순화한 예시 구조입니다.

```
version: "3.9"

services:
  api:
    image: my-api:1.0
    ports:
      - "8080:8080"
    environment:
      DB_HOST: db

  db:
    image: postgres:15
    volumes:
      - db-data:/var/lib/postgresql/data

volumes:
  db-data:
```

중요한 포인트

* `db`라는 **서비스 이름이 곧 호스트명**
* IP를 직접 쓰지 않음
* 로컬에서도 “서비스 이름 기반 통신”

---

## 6️⃣ Docker Compose로 얻는 감각(중요)

Compose의 가장 큰 가치는 **기술**이 아니라 **감각**입니다.

### 서비스는 항상 함께 뜬다

* 단일 서버 사고에서 벗어남

### 네트워크는 기본적으로 분리된다

* “localhost 지옥” 탈출

### 설정은 외부에서 주입된다

* 이미지 재빌드 없음

이 감각이 그대로 **쿠버네티스**로 이어집니다.

---

## 7️⃣ Docker Compose의 한계 (중요)  

Compose는 **학습/개발용 도구**입니다.  
  .  

### 운영에는 부적합

* 자동 복구 제한
* 오토스케일 없음
* 롤링 업데이트 없음
* 노드 장애 대응 없음

그래서 **운영은 쿠버네티스**,
**Compose는 로컬/개발/CI** 용도로 씁니다.

---

## 8️⃣ Compose를 쓰는 올바른 목적

### 올바른 사용

* 로컬 MSA 개발
* 신규 인력 온보딩
* 간단한 통합 테스트
* CI 파이프라인

### 잘못된 사용

* 운영 환경
* 고가용성 요구 환경
* 장애 자동 복구 기대

---

## 9️⃣ 쿠버네티스로 가기 전, 반드시 익혀야 할 것

Compose 단계에서 다음 질문에 답할 수 있어야 합니다.

* 서비스는 몇 개인가?
* 누가 누구와 통신하는가?
* 설정은 어디서 주입되는가?
* 데이터는 어디에 저장되는가?
* 컨테이너가 죽으면 어떻게 되는가?

이 질문에 답할 수 있으면
쿠버네티스로 넘어갈 준비가 된 것입니다.

---  
  .  

## 1️⃣0️⃣ 결론: Compose는 ‘연습장’이다

* Compose는 MSA의 **축소판**  
  .  
* 쿠버네티스의 **개념 예행연습**
* 실패해도 안전한 실험 공간

> **Compose에서 구조를 이해하지 못하면
> 쿠버네티스에서는 길을 잃는다**

---

## ✅ 오늘의 핵심 요약

* Docker Compose는 여러 컨테이너를 한 번에 관리한다.
* 서비스 이름 기반 통신은 MSA의 기본 감각이다.
* 설정은 외부 주입, 데이터는 볼륨으로 분리한다.
* Compose는 개발용, 운영은 쿠버네티스다.
* Compose는 쿠버네티스로 가기 전 필수 연습 단계다.

---
