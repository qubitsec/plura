## 26일차 – 쿠버네티스 설정 관리

**날짜: 7월 24일**

---

## 주제

# **26. ConfigMap / Secret**

### 설정과 민감정보 분리

> “이미지는 같게, 설정은 다르게”

---

## 1️⃣ 왜 설정과 민감정보를 분리해야 하는가

쿠버네티스 운영에서 가장 자주 발생하는 사고 유형은 다음과 같습니다.

* 이미지에 설정을 포함
* 환경(dev/stage/prod)마다 이미지가 다름
* 비밀번호·토큰이 Git 또는 이미지에 포함
* 누가 어떤 설정으로 운영 중인지 추적 불가

이 문제의 근본 원인은 단 하나입니다.

> **설정과 코드(이미지)를 분리하지 않았기 때문**

---

## 2️⃣ ConfigMap과 Secret의 역할 구분

### 한 문장 정의

* **ConfigMap**
  → 민감하지 않은 **일반 설정 값 저장소**

* **Secret**
  → 비밀번호, 토큰, 키 등 **민감정보 저장소**

둘 다:

* Pod에 **환경변수** 또는 **파일**로 주입 가능
* 애플리케이션 재빌드 없이 설정 변경 가능

---

## 3️⃣ 무엇을 ConfigMap에 넣고, 무엇을 Secret에 넣는가

### ✅ ConfigMap에 적합한 것

* 로그 레벨
* 기능 플래그
* 외부 API 주소
* 타임아웃 값
* 환경 식별 값(env=prod)

---

### ✅ Secret에 적합한 것

* DB 계정/비밀번호
* API Key
* JWT 서명 키
* 인증서, 토큰

**판단 기준**

> “노출되면 사고인가?”
> → 그렇다면 **무조건 Secret**

---

## 4️⃣ 설정 주입 방식 2가지

### 1) 환경변수(Environment Variable) 방식

* 12-Factor App 권장 방식
* 가장 단순하고 표준적인 접근

특징:

* 코드 변경 불필요
* 언어/프레임워크 무관
* 운영에서 가장 많이 사용

---

### 2) 파일 마운트 방식

* 인증서
* 설정 파일(YAML/JSON)
* 대용량 설정

특징:

* 특정 경로에 파일로 제공
* 라이브 리로드가 필요한 경우 유리

단, **이미지 안에 포함**
→ 반드시 외부에서 주입

---

## 5️⃣ 설정 변경 시 동작에 대한 현실적인 이해

### 반드시 알아야 할 사실

* **환경변수 방식**
  → ConfigMap/Secret 변경 후 **Pod 재시작 필요**

* **파일 마운트 방식**
  → 일부 컨트롤러에서 자동 반영 가능
  → 하지만 운영에서는 재시작을 권장

운영 원칙

> **설정 변경 = 롤링 재배포**
> (가장 예측 가능하고 안전)

---

## 6️⃣ Secret에 대한 흔한 오해

### “Secret은 자동으로 암호화되어 안전하다”

* 기본은 **base64 인코딩**
* 실제 암호화 여부는 etcd 설정에 따라 다름

---

### ✅ 그래서 반드시 필요한 것

* RBAC 기반 접근 제어
* 네임스페이스 분리
* 외부 Secret Manager 연동(Vault 등)
* 로그/에러 메시지에 값 출력 금지

---

## 7️⃣ 자주 발생하는 실패 패턴

### Secret을 Git에 커밋

→ 영구 유출, 회수 불가

### ConfigMap과 Secret 구분 없이 사용

→ 보안 사고 가능성 증가

### Dockerfile에 설정 포함

→ 환경별 재빌드 지옥

### 설정 키 네이밍 제각각

→ 운영 혼란, 자동화 불가

---

## 8️⃣ 환경별 설정 운영 전략(권장)

### 현실적인 표준 전략

* **이미지: 100% 동일**
* **ConfigMap / Secret: 환경별 분리**

예:

* `dev-config`
* `stage-config`
* `prod-config`

네임스페이스 단위로 분리하면
→ 접근 제어와 운영 안정성이 크게 향상

---

## 9️⃣ 결론: 설정 분리는 ‘운영 안전장치’다

* 코드 변경 없이 환경 전환
* 이미지 재사용
* 보안 사고 최소화
* 롤백/배포 단순화

> **ConfigMap과 Secret은
> 단순한 쿠버네티스 리소스가 아니라
> 운영 사고를 막기 위한 구조적 장치다**

---  
  .  

## ✅ 오늘의 핵심 요약

* 설정은 이미지 밖에 둔다.
* 일반 설정은 ConfigMap, 민감정보는 Secret.
* 환경변수/파일로 Pod에 주입한다.
* Secret은 자동으로 안전해지지 않는다.
* 설정 변경은 재배포로 관리하는 것이 가장 안전하다.

---
