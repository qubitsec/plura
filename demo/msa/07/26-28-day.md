# MSA 개발을 위한 사전 설명 문서

## 29일차 – 쿠버네티스 운영 핵심

**날짜: 7월 25일**

---

## 주제

# **28. 헬스체크 & 오토스케일링**

### Readiness · Liveness · HPA

> “쿠버네티스는 살아있는 것만 쓰고, 필요하면 스스로 늘린다”

---

## 1️⃣ 왜 헬스체크가 운영의 생명선인가

쿠버네티스의 기본 전제는 이렇습니다.

* Pod는 언제든지 죽을 수 있다
* 죽으면 다시 만든다
* **문제는 ‘언제’ 죽였는지다**

헬스체크가 없으면 쿠버네티스는 이렇게 행동합니다.

* 살아 있는지 모른다
* 준비 안 된 Pod에도 트래픽을 보낸다
* 장애를 “느리게” 키운다

그래서 **헬스체크는 선택이 아니라 전제**입니다.

---

## 2️⃣ Readiness Probe란 무엇인가

### 한 문장 정의

> **“이 Pod는 지금 트래픽을 받아도 되는가?”**

### Readiness의 역할

* 실패하면 **트래픽에서 제외**
* Pod는 살아 있지만 **로드밸런싱 대상에서 빠짐**
* 재시작 ❌

📌 사용 사례

* 애플리케이션 기동 중
* DB 연결 아직 안 됨
* 캐시 워밍업 중

**준비 안 된 Pod 보호 장치**

---

## 3️⃣ Liveness Probe란 무엇인가

### 한 문장 정의

> **“이 Pod는 정상적으로 살아 있는가?”**

### Liveness의 역할

* 실패하면 **Pod 재시작**
* “응답 없는 좀비 프로세스” 제거

사용 사례

* 데드락
* 무한 루프
* 내부 스레드 멈춤

**자기 회복(Self-Healing)의 핵심**

---

## 4️⃣ Readiness vs Liveness 차이 정리

| 구분    | Readiness   | Liveness |
| ----- | ----------- | -------- |
| 질문    | 트래픽 받아도 되나? | 살아 있나?   |
| 실패 시  | 트래픽 차단      | Pod 재시작  |
| 목적    | 안정적 라우팅     | 자동 복구    |
| 운영 영향 | 무중단         | 복구 중심    |

실무 원칙

> **둘은 반드시 분리해서 설계**

---

## 5️⃣ 헬스체크 설계 시 흔한 실수

### 단순 “/health = 200”

* 내부 상태 반영 안 됨

### Readiness 없이 Liveness만 사용

* 준비 안 된 Pod가 재시작 루프

### DB/외부 API를 Liveness에 포함

* 외부 장애로 무한 재시작

**Liveness는 최소, Readiness는 현실적으로**

---

## 6️⃣ 오토스케일링(HPA)이란?

**HPA(Horizontal Pod Autoscaler)** 는
Pod 개수를 **자동으로 조절**하는 기능입니다.

> **부하에 따라 Pod 수를 늘리고 줄인다**

---

## 7️⃣ HPA의 기본 동작 원리

1. 메트릭 수집 (CPU, 메모리, 커스텀 메트릭)
2. 목표치와 비교
3. Pod 수 계산
4. Deployment의 replicas 조정

사람이 개입하지 않음

---

## 8️⃣ 어떤 지표로 스케일링할 것인가

### ✅ 기본 지표

* CPU 사용률
* 메모리 사용률

### ✅ 실무에서 중요한 지표

* 요청 수(QPS)
* 응답 시간
* 큐 길이

**CPU만으로는 부족한 경우가 많다**

---

## 9️⃣ HPA를 쓰기 전에 반드시 필요한 것

### 필수 조건

* 안정적인 헬스체크
* 무상태(Stateless) 서비스
* 빠른 Pod 기동
* 메트릭 수집 체계

이게 없으면
**자동 확장은 오히려 장애 유발**

---

## 1️⃣0️⃣ 헬스체크 + HPA의 시너지

* Readiness 실패 → 트래픽 차단
* Liveness 실패 → 자동 재시작
* 부하 증가 → HPA 확장
* 부하 감소 → 자동 축소

**사람 없이도 버티는 구조**

---

## 1️⃣1️⃣ 결론: 자동화는 ‘조건’이 맞아야 작동한다

* 헬스체크가 없으면 자동화는 눈먼 칼
* HPA는 만능이 아님
* 잘못된 설정은 장애를 키운다

> **쿠버네티스 자동화의 핵심은
> ‘언제 쓰고, 언제 버릴지’를 정확히 알려주는 것**이다.

---

## ✅ 오늘의 핵심 요약

* Readiness는 트래픽 제어, Liveness는 재시작.
* 둘은 목적이 다르므로 분리 설계한다.
* 헬스체크 없는 HPA는 위험하다.
* 오토스케일링은 메트릭 설계가 핵심이다.
* 자동화는 잘 설계된 서비스에서만 빛난다.

---
