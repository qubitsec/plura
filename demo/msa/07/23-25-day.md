# MSA 개발을 위한 사전 설명 문서

## 25일차 – 쿠버네티스 네트워크

**날짜: 7월 23일**

---

## 주제

# **25. Service & Ingress**

### 네트워크 노출과 라우팅

> “Pod는 변한다. 주소는 고정돼야 한다”

---

## 1️⃣ 왜 Service가 필요한가

Pod의 현실부터 짚겠습니다.

* Pod는 언제든지 **죽고 다시 만들어짐**
* Pod IP는 **항상 바뀔 수 있음**
* 직접 IP로 통신하면 **즉시 깨짐**

그래서 쿠버네티스는 **Pod 앞에 고정된 주소**를 둡니다.
그 역할이 **Service**입니다.

---

## 2️⃣ Service란 무엇인가 (한 문장)

> **Service는 여러 Pod 앞에 놓인
> ‘고정된 접근 지점(Stable Endpoint)’이다**

* Pod가 바뀌어도
* Service 주소는 그대로
* 내부 로드밸런싱 자동 처리

---

## 3️⃣ Service의 핵심 역할

### ✅ 1) 고정된 접근 주소 제공

* Pod IP 변화와 무관
* 서비스 이름으로 접근

```
http://order-service
```

---

### ✅ 2) 내부 로드밸런싱

* 여러 Pod로 트래픽 분산
* 특정 Pod 장애 시 자동 제외

---

### ✅ 3) 서비스 디스커버리

* DNS 기반
* 서비스 이름 = 접근 주소

---

## 4️⃣ Service 타입 4가지 (중요)

### 1) ClusterIP (기본값)

* **클러스터 내부 전용**
* 외부 접근 불가
* 서비스 간 통신용

MSA 내부 통신의 기본

---

### 2) NodePort

* 각 노드의 특정 포트를 외부에 개방
* `<NodeIP>:<Port>` 형태 접근

테스트/임시 노출용
운영에서는 거의 사용 안 함

---

### 3) LoadBalancer

* 클라우드 로드밸런서 연동
* 외부 고정 IP 제공

간단하지만
서비스 수 많아지면 비용/관리 부담

---

### 4) ExternalName

* 외부 DNS 이름을 내부 서비스처럼 사용
* 실제 트래픽은 외부로 전달

외부 API를 내부 서비스처럼 다룰 때 유용

---

## 5️⃣ Ingress가 필요한 이유

Service만으로 외부 노출을 하면 이런 문제가 생깁니다.

* 서비스마다 IP/포트 필요
* 인증/보안 정책 분산
* 도메인/경로 라우팅 불가

그래서 등장한 것이 **Ingress**입니다.

---

## 6️⃣ Ingress란 무엇인가

> **Ingress는 HTTP/HTTPS 트래픽을
> 하나의 입구에서 받아
> 여러 Service로 라우팅하는 규칙 집합**

```
https://api.example.com/orders → order-service
https://api.example.com/users  → user-service
```

Ingress 자체는 **규칙**이고,
실제 트래픽 처리는 **Ingress Controller**가 담당합니다.

---

## 7️⃣ Service vs Ingress 역할 구분

| 구분   | Service      | Ingress    |
| ---- | ------------ | ---------- |
| 대상   | Pod          | Service    |
| 프로토콜 | TCP/UDP/HTTP | HTTP/HTTPS |
| 역할   | 고정 주소 + LB   | 외부 트래픽 라우팅 |
| 범위   | 내부 중심        | 외부 진입점     |

**Service는 내부**,
**Ingress는 외부 입구**

---

## 8️⃣ Ingress에서 주로 처리하는 것들

### ✅ 공통 라우팅

* 도메인 기반
* 경로 기반

### ✅ TLS 종료

* HTTPS 인증서 관리
* 내부는 HTTP 가능

### ✅ 기본 보안

* IP 제한
* 기본 인증
* Rate Limit (컨트롤러 기능)

**API Gateway 이전 단계**로 자주 사용

---

## 9️⃣ 흔한 실수 패턴

### Pod IP로 직접 접근

→ 즉시 깨짐

### Service 없이 Ingress 사용

→ 대상 없음

### Ingress에 비즈니스 로직 추가

→ 또 다른 모놀리식

---

## 1️⃣0️⃣ 현실적인 권장 구조

```
[ Client ]
    ↓
[ Ingress ]
    ↓
[ Service ]
    ↓
[ Pod ]
```

* 외부 트래픽: Ingress
* 내부 트래픽: Service
* Pod는 항상 뒤에 숨김

---

## 1️⃣1️⃣ 결론: 주소 안정성이 운영 안정성이다

* Pod는 언제든 변한다
* Service는 변하지 않는다
* Ingress는 외부 세계와의 계약이다

> **쿠버네티스 네트워크의 핵심은
> ‘변하는 것과 변하지 않는 것’을 분리하는 데 있다**

---

## ✅ 오늘의 핵심 요약

* Service는 Pod 앞의 고정된 접근 지점이다.
* ClusterIP는 내부 통신의 기본이다.
* Ingress는 외부 HTTP/HTTPS 트래픽의 단일 입구다.
* Service는 내부, Ingress는 외부를 담당한다.
* Pod IP에 직접 의존하면 반드시 실패한다.

---
