## 15일차 – 개념 이해

**날짜: 7월 1일**

---

## 주제

# **15. 보안 기초: 인증(Authentication) · 인가(Authorization) · 토큰(JWT)**

> “MSA에서 보안은 기능이 아니라 **구조**다”

---

## 1️⃣ 왜 MSA에서 보안이 더 어려워지는가

모놀리식에서는 보안이 비교적 단순했습니다.

* 로그인 한 번
* 서버 내부는 신뢰
* 세션 하나로 처리

하지만 MSA에서는 상황이 완전히 달라집니다.

* 서비스가 여러 개
* 네트워크 호출이 기본
* 내부 서비스도 공격 대상
* 경계가 명확하지 않음

**‘내부라서 안전하다’는 가정이 더 이상 성립하지 않습니다.**

---

## 2️⃣ 인증(Authentication)과 인가(Authorization)의 차이

MSA에서 이 둘을 혼동하면 설계가 무너집니다.

### 인증(Authentication)

* “너는 누구인가?”
* 신원 확인
* 로그인, 토큰 발급

예:

* 아이디/비밀번호
* OAuth 로그인
* 인증서

---

### 인가(Authorization)

* “너는 무엇을 할 수 있는가?”
* 권한 확인
* 리소스 접근 제어

예:

* 관리자만 접근 가능
* 본인 데이터만 조회 가능

핵심

> **인증 ≠ 인가**
> 인증 후에도 인가는 매 요청마다 필요합니다.

---

## 3️⃣ 세션 기반 인증이 MSA에 맞지 않는 이유

### 세션 방식의 문제

* 서버 메모리/스토리지에 상태 저장
* 서버가 늘어나면 세션 공유 필요
* 서비스 간 세션 전달 어려움

**확장성과 독립성이 깨집니다.**

---

## 4️⃣ MSA의 기본 선택: 토큰 기반 인증 (JWT)

### JWT(JSON Web Token)란?

* 인증 결과를 담은 **서명된 토큰**
* 서버가 상태를 저장하지 않음
* 요청마다 토큰을 전달

```
[ Client ] → Authorization: Bearer <JWT>
```

---

### JWT의 기본 구조

* Header: 알고리즘 정보
* Payload: 사용자 정보/권한
* Signature: 위·변조 방지

서버는 **서명만 검증**하면 됨

---

## 5️⃣ MSA에서 JWT 흐름 (표준 패턴)

1. 사용자가 로그인 요청
2. 인증 서버(Auth Service)가 인증
3. JWT 발급
4. 클라이언트는 모든 요청에 JWT 포함
5. API Gateway 또는 서비스가 토큰 검증

```
Client
 → Auth Service (로그인)
 ← JWT
 → API Gateway (JWT 검증)
 → Internal Services
```

---

## 6️⃣ API Gateway에서 보안을 처리하는 이유

### Gateway에서 처리하면

* 인증 로직 중앙화
* 내부 서비스 단순화
* 보안 정책 일관성 유지

권장 패턴

* **외부 요청 인증/인가 → Gateway**
* **내부 서비스는 최소 권한만 신뢰**

---

## 7️⃣ 서비스 간 통신(Service-to-Service)은 어떻게 보호하나

사용자 요청과 **내부 서비스 통신은 다릅니다.**

### ✅ 내부 통신 보안 방식

* 서비스 계정(Service Account)
* 내부 전용 토큰
* mTLS(서버 간 상호 인증)

“사용자 토큰”을 그대로 내부로 흘려보내지 않는 것이 원칙

---

## 8️⃣ JWT 사용 시 반드시 알아야 할 함정

### 1) 토큰은 폐기하기 어렵다

* 이미 발급된 JWT는 서버에서 즉시 무효화 어려움
* 만료 시간(exp) 설계 중요

### 2) 토큰에 민감 정보 금지

* Payload는 암호화 아님
* 누구나 디코딩 가능

### 3) 토큰 탈취 = 권한 탈취

* HTTPS 필수
* 저장 위치 주의(LocalStorage 등)

---

## 9️⃣ MSA 보안의 현실적인 원칙

### ✅ 핵심 원칙 5가지

1. **모든 요청은 인증 대상**
2. **내부 서비스도 신뢰하지 않는다**
3. **권한은 최소 Reflect (Least Privilege)**
4. **보안 로직은 중앙화**
5. **토큰 수명은 짧게**

---

## 1️⃣0️⃣ 결론: MSA 보안은 ‘경계 설계’다

MSA에서 보안은
“기능 하나 추가”가 아닙니다.

* 어디서 인증할 것인가
* 어디까지 신뢰할 것인가
* 누가 무엇을 할 수 있는가

> **MSA 보안의 핵심은
> ‘누구를 믿고, 어디까지 믿을지’를
> 구조로 강제하는 것**입니다.

---

## ✅ 오늘의 핵심 요약

* 인증과 인가는 반드시 분리해서 생각한다.
* 세션 방식은 MSA에 부적합하다.
* JWT는 상태 없는 인증의 기본 선택이다.
* API Gateway에서 인증을 중앙화하라.
* 내부 서비스 통신도 반드시 보호하라.

---
