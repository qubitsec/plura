# 📘 MSA 개발을 위한 사전 설명 문서

## 7일차 – 개념 이해

**날짜: 6월 19일**

---

## 주제

# **7. 데이터 분리 원칙: 왜 DB를 나누는가**

> “MSA의 성공과 실패를 가르는 가장 중요한 기준”

---

## 1️⃣ MSA에서 가장 많이 터지는 지점은 ‘데이터’다

MSA 전환 실패 사례의 상당수는
👉 **서비스 분리는 했는데, 데이터는 그대로인 경우**입니다.

* 서비스는 나눴는데 DB는 공유
* API는 있는데 직접 DB 조인
* 장애는 분산됐는데 데이터 정합성은 더 복잡해짐

결론부터 말하면,

> **DB를 나누지 않으면, MSA는 성립하지 않습니다.**

---

## 2️⃣ 핵심 원칙: Database per Service

MSA의 가장 중요한 데이터 원칙은 다음 한 문장으로 요약됩니다.

> **각 서비스는 자신의 데이터를 소유한다.**

이를 흔히
**Database per Service 패턴**이라고 부릅니다.

### 의미하는 바

* 서비스마다 **자기 DB(또는 스키마)** 를 가짐
* 다른 서비스는 **직접 접근 불가**
* 데이터 접근은 **API 또는 이벤트**로만 가능

---

## 3️⃣ 왜 DB를 공유하면 안 되는가

### ❌ 1) 강결합이 가장 빠르게 생긴다

* DB 스키마 변경 = 모든 서비스 영향
* 한 서비스의 쿼리 변경이 다른 서비스 성능에 영향

👉 코드보다 **DB가 결합 지점**이 됩니다.

---

### ❌ 2) 장애가 그대로 전파된다

* 하나의 잘못된 쿼리
* 하나의 락(Lock)
* 하나의 커넥션 고갈

→ 전체 서비스 장애로 확산

---

### ❌ 3) 배포 독립성이 깨진다

* DB 변경 때문에 배포 순서가 생김
* “이 서비스 먼저 배포하고, 저 서비스 나중에…”

👉 결국 **모놀리식 배포 문제 재현**

---

## 4️⃣ 데이터 소유권(Data Ownership) 개념

DB 분리는 기술 문제가 아니라 **책임 문제**입니다.

### 데이터 소유권이란?

* 누가 이 데이터를 **생성**하는가
* 누가 이 데이터를 **수정**할 수 있는가
* 누가 이 데이터의 **진실(Source of Truth)** 인가

예시:

* 주문 금액 → 주문 서비스
* 결제 상태 → 결제 서비스
* 배송 상태 → 배송 서비스

👉 다른 서비스는 “참고”만 할 뿐, **소유하지 않는다**.

---

## 5️⃣ 그럼 조회는 어떻게 하나? (현실적인 질문)

### ❓ “서비스 간 조인은 못 하면, 화면은 어떻게 만드나요?”

MSA에서는 다음 방식이 일반적입니다.

### ✅ 1) API 조합 (Composition)

* 프론트엔드 또는 BFF(API Gateway)가
* 여러 서비스 API를 호출해 조합

📌 단순하지만 호출 수 증가 가능

---

### ✅ 2) 데이터 복제(Read Model)

* 이벤트를 통해 필요한 데이터만 복제
* 조회 전용 모델을 별도로 구성

📌 CQRS 패턴의 기초 형태

---

### ✅ 3) 이벤트 기반 동기화

* 주문 생성 → 이벤트 발행
* 결제/배송 서비스가 필요한 데이터만 저장

📌 실시간성이 아니라 **최종적 일관성(Eventual Consistency)** 전제

---

## 6️⃣ 트랜잭션은 어떻게 처리하나?

### ❌ 분산 트랜잭션(2PC)은 피하라

* 복잡도↑
* 장애 시 복구 난이도↑
* 운영 현실과 맞지 않음

### ✅ SAGA 패턴 개념

* 각 서비스는 **자기 트랜잭션만 책임**
* 실패 시 보상 트랜잭션 수행

👉 “완벽한 즉시 일관성” 대신
👉 **업무 흐름 기반의 일관성**을 선택

---

## 7️⃣ 현실적인 절충안 (처음부터 완벽할 필요는 없다)

### 단계적 접근 권장

1. 처음엔 **논리적 분리**

   * DB는 같아도 스키마/접근 계층 분리
2. 접근 규칙 강제

   * 다른 서비스 테이블 직접 접근 금지
3. 트래픽/장애/배포 압박이 생기면

   * 물리적 DB 분리

---

## 8️⃣ 흔한 실패 패턴 정리

### ❌ 서비스는 나눴는데 DB는 하나

→ 가장 흔한 MSA 실패

### ❌ 조회 편의 때문에 DB 직접 접근 허용

→ 결국 모든 서비스가 엮임

### ❌ 정합성 공포로 분리를 미룸

→ 규모 커질수록 더 못 나눔

---

## 9️⃣ 결론: DB 분리는 선택이 아니라 전제다

* DB를 나누면 **복잡해진다** → 사실
* DB를 안 나누면 **확장·배포·장애가 모두 막힌다** → 더 큰 사실

> **MSA의 비용은 복잡성,
> MSA의 보상은 독립성이다.**

---

## ✅ 오늘의 핵심 요약

* MSA에서 데이터는 **서비스의 경계**다.
* DB 공유는 강결합·장애 전파·배포 종속을 만든다.
* 조회는 API/이벤트/Read Model로 해결한다.
* 완벽한 일관성보다 **운영 가능한 구조**가 우선이다.

---
