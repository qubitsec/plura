# 📘 MSA 개발을 위한 사전 설명 문서

## 11일차 – 개념 이해

**날짜: 6월 25일**

---

## 주제

# **11. 장애 격리와 회복 전략**

### 타임아웃 · 재시도 · 서킷 브레이커

> “MSA는 장애를 막는 구조가 아니라, **버티는 구조**다”

---

## 1️⃣ MSA에서 장애는 ‘예외’가 아니라 ‘전제’다

모놀리식에서는 장애를 이렇게 생각했습니다.

> “버그가 없으면 장애도 없다”

하지만 MSA에서는 다릅니다.

* 네트워크 장애
* 순간적인 지연
* 일부 서비스 다운
* 과부하, 타임아웃

👉 **아무리 잘 만들어도 장애는 반드시 발생**합니다.

그래서 MSA의 목표는
❌ *장애를 없애는 것*이 아니라
✅ *장애가 퍼지지 않게 막고, 빠르게 회복하는 것*입니다.

---

## 2️⃣ 가장 먼저 필요한 것: 타임아웃(Timeout)

### ❓ 타임아웃이 없으면 무슨 일이 생길까

```
Service A → Service B (응답 대기…)
```

* B가 느려지면
* A의 스레드가 묶이고
* 연결이 쌓이고
* 결국 A도 다운

👉 **대기 = 장애 전파**

---

### ✅ 타임아웃의 역할

* “얼마나 기다릴지”를 명시적으로 제한
* 느린 서비스가 전체를 묶지 못하게 차단

📌 원칙

> **타임아웃 없는 네트워크 호출은 버그다**

---

## 3️⃣ 재시도(Retry): 약이 될 수도, 독이 될 수도

### ✅ 재시도가 도움이 되는 경우

* 일시적 네트워크 오류
* 짧은 순간의 과부하

### ❌ 재시도가 위험한 경우

* 이미 과부하 상태인 서비스에
* 재시도가 몰리면
* 장애를 더 키움 (Retry Storm)

---

### 📌 재시도 설계 원칙

* 무조건 재시도 ❌
* **제한된 횟수**
* **지수 백오프(Exponential Backoff)**
* **타임아웃과 함께 사용**

---

## 4️⃣ 서킷 브레이커(Circuit Breaker)란?

서킷 브레이커는
**“계속 실패하는 호출을 잠시 끊어버리는 장치”**입니다.

전기 차단기와 동일한 개념입니다.

---

### 상태 개념

* **Closed**: 정상 호출
* **Open**: 호출 차단
* **Half-Open**: 일부만 테스트 호출

```
실패 누적 → Open
잠시 대기 → Half-Open
성공 → Closed / 실패 → Open
```

---

### 서킷 브레이커의 효과

* 불필요한 호출 중단
* 빠른 실패(Fail Fast)
* 시스템 전체 보호

👉 “기다리다 죽는 것” 대신
👉 “빨리 실패하고 살아남기”

---

## 5️⃣ 이 3가지는 항상 세트다

| 요소      | 역할        |
| ------- | --------- |
| 타임아웃    | 기다림을 제한   |
| 재시도     | 일시적 오류 복구 |
| 서킷 브레이커 | 연쇄 장애 차단  |

📌 하나만 쓰면 효과 반감
📌 **3개는 함께 설계해야 의미가 있음**

---

## 6️⃣ 어디에 적용해야 하나?

### ✅ 반드시 적용해야 할 지점

* 서비스 ↔ 서비스 **동기 호출**
* 외부 API 호출
* DB, 캐시, 메시지 브로커 접근

### ❌ 불필요한 지점

* 내부 계산 로직
* 비동기 이벤트 소비(다른 방식으로 보호)

---

## 7️⃣ 흔한 실패 패턴

### ❌ 타임아웃 없음

→ 장애 시 전체 스레드 고갈

### ❌ 재시도 무제한

→ 장애 증폭

### ❌ 서킷 브레이커 없이 동기 체인

→ 한 서비스 장애 = 전체 장애

---

## 8️⃣ 결론: “빨리 실패하는 시스템”이 살아남는다

MSA에서 좋은 시스템이란,

* 항상 성공하는 시스템 ❌
* **실패해도 버티는 시스템 ✅**

> **기다리지 말고,
> 반복하지 말고,
> 끊을 줄 알아야 한다**

---

## ✅ 오늘의 핵심 요약

* 장애는 반드시 발생한다.
* 타임아웃은 기본값이 아니라 필수값이다.
* 재시도는 제한적으로 써야 한다.
* 서킷 브레이커는 연쇄 장애를 막는 핵심 장치다.
* 이 3가지는 항상 함께 설계해야 한다.

---
