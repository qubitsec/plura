# 📘 MSA 개발을 위한 사전 설명 문서

## 12일차 – 개념 이해

**날짜: 6월 26일**

---

## 주제

# **12. 분산 시스템의 현실: Partial Failure & 네트워크는 믿을 수 없다**

> “MSA의 어려움은 ‘서비스가 많아서’가 아니라 ‘네트워크가 있기 때문’이다”

---

## 1️⃣ Partial Failure(부분 실패)란?

모놀리식에서는 보통 이렇게 생각합니다.

* 서버가 살아있다 → 서비스 정상
* 서버가 죽었다 → 서비스 장애

하지만 MSA는 다릅니다.

> 어떤 서비스는 정상인데, 어떤 서비스만 죽어 있을 수 있습니다.
> 어떤 호출은 성공하고, 어떤 호출은 실패할 수 있습니다.

이게 **Partial Failure(부분 실패)** 입니다.

---

## 2️⃣ 왜 부분 실패가 더 위험한가

부분 실패는 **애매하기 때문에** 더 위험합니다.

* “완전히 죽은 게 아닌데 느리다”
* “가끔 된다”
* “특정 경로만 실패한다”
* “특정 시간대만 터진다”

즉, 장애가 **명확하지 않아서** 탐지/대응이 늦어집니다.

---

## 3️⃣ 네트워크는 믿을 수 없다 (현실 5가지)

MSA에서 서비스 간 통신은 네트워크를 통과합니다.
네트워크에는 다음이 항상 존재합니다.

### ① 지연(Latency)

* “지금은 느리다”가 정상 상태로 존재함

### ② 패킷 손실(Loss)

* 일부 요청이 소실될 수 있음

### ③ 타임아웃(Timeout)

* 응답이 늦어지면 실패로 간주해야 함

### ④ 네트워크 분리(Partition)

* 서로 연결이 끊긴 구간이 생길 수 있음

### ⑤ 순서 뒤바뀜 / 중복

* 메시지는 늦게 오거나, 중복으로 올 수 있음

---

## 4️⃣ “실패”에는 2종류가 있다

분산 시스템에서 실패는 크게 두 가지로 나뉩니다.

### ✅ 1) Fail Fast (즉시 실패)

* 빨리 실패하고 다음 로직으로 넘어감
* 시스템이 살아남기 쉬움

### ❌ 2) Fail Slow (느리게 실패)

* 계속 기다리다가
* 스레드/커넥션이 고갈되어
* 결국 전체 장애로 번짐

👉 MSA에서 가장 위험한 것은 **Fail Slow** 입니다.

---

## 5️⃣ 연쇄 장애(Cascading Failure)가 만들어지는 과정

전형적인 패턴입니다.

1. Service B가 느려짐
2. Service A가 B를 기다림
3. A의 스레드/커넥션이 고갈
4. A도 느려짐
5. Gateway/Client까지 영향
6. “전체 장애”로 보이기 시작

👉 그래서 어제 배운 **타임아웃/재시도/서킷브레이커**가 필수입니다.

---

## 6️⃣ 부분 실패를 전제로 한 설계 원칙

### ✅ 1) 타임아웃은 “짧게”

* 무한 대기는 금지

### ✅ 2) 실패 시 대체 경로(Fallback)

* 캐시 데이터로 응답
* “일부 기능 제한” 모드로 동작

### ✅ 3) 격리(Bulkhead)

* 중요한 기능의 자원을 분리
* 한 기능이 자원을 다 먹어도 전체가 죽지 않게

### ✅ 4) 멱등성(Idempotency)

* 재전송/중복을 감안하여
* 같은 요청을 여러 번 받아도 결과가 안전해야 함

---

## 7️⃣ 운영 측면에서 반드시 필요한 것

부분 실패는 “눈으로 보기 어렵기” 때문에
**관측(Observability)** 없이는 운영이 불가능합니다.

필수 3종 세트:

* 로그(Logs)
* 메트릭(Metrics)
* 트레이싱(Tracing)

👉 “어디서 느려졌는지”를 추적해야 합니다.

---

## 8️⃣ 결론: MSA의 현실을 받아들이면 설계가 쉬워진다

MSA는 이상적인 세계가 아닙니다.

* 네트워크는 느리고
* 일부는 실패하고
* 가끔은 연결이 끊기며
* 중복도 발생합니다.

이 현실을 인정하면 결론은 명확해집니다.

> **MSA는 ‘성공을 가정’하는 구조가 아니라
> ‘실패를 전제’하는 구조다.**

---

## ✅ 오늘의 핵심 요약

* MSA에서는 부분 실패가 정상이다.
* 네트워크는 지연/손실/분리/중복을 가진다.
* 가장 위험한 실패는 Fail Slow(느리게 죽는 것)이다.
* 타임아웃/서킷브레이커/격리/멱등성은 생존 장치다.
* 관측(로그/메트릭/트레이싱) 없이는 운영이 불가능하다.

---
