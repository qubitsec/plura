# MSA 개발을 위한 사전 설명 문서

## 9일차 – 개념 이해

**날짜: 7월 21일**

---

## 주제

# **9. 이벤트 기반 아키텍처(Event-Driven Architecture)**

> “직접 부르지 말고, 발생한 일을 알린다”

---

## 1️⃣ 왜 이벤트 기반 아키텍처가 필요한가

어제 배운 내용의 핵심은 이것이었습니다.

> **동기 호출은 연쇄 장애를 만든다**

이 문제를 구조적으로 완화하는 방식이
**이벤트 기반 아키텍처(Event-Driven Architecture, EDA)** 입니다.

---

## 2️⃣ 이벤트 기반 아키텍처란 무엇인가

이벤트 기반 아키텍처에서는
서비스가 다른 서비스를 **직접 호출하지 않습니다.**

대신,

> **“무슨 일이 일어났는지(Event)”를 알릴 뿐**
> **그 이후는 관심 있는 서비스가 알아서 처리**합니다.

---

## 3️⃣ 기존 동기 방식 vs 이벤트 방식

### 동기 호출 중심 구조

```
주문 서비스
 → 결제 서비스
   → 배송 서비스
     → 알림 서비스
```

* 호출 체인 깊음
* 한 서비스 지연 → 전체 지연
* 장애 전파 위험 큼

---

### ✅ 이벤트 기반 구조

```
주문 서비스
 → [주문 생성 이벤트 발행]
      ↳ 결제 서비스 (구독)
      ↳ 배송 서비스 (구독)
      ↳ 알림 서비스 (구독)
```

* 주문 서비스는 **결과를 기다리지 않음**
* 각 서비스는 **자기 책임만 수행**

---

## 4️⃣ 이벤트(Event)란 무엇인가

이벤트는 다음을 의미합니다.

* **이미 발생한 사실**
* 과거형
* 되돌릴 수 없음

예:

* OrderCreated
* PaymentCompleted
* DeliveryStarted
* UserRegistered

중요한 점
이벤트는 **“명령(Command)”이 아니다**

* “결제해라”
* ✅ “결제가 발생했다”

---

## 5️⃣ 메시지 큐 / 브로커의 역할

이벤트 기반 아키텍처에는 보통
**메시지 브로커(Message Broker)** 가 존재합니다.

### 브로커의 역할

* 이벤트를 **안전하게 전달**
* 발행자(Publisher)와 소비자(Consumer) 분리
* 일시적 장애 시 메시지 보관

예시 개념:

```
[ Service A ] → [ Broker ] → [ Service B / C / D ]
```

서비스들은 **서로를 몰라도 됨**

---

## 6️⃣ 이벤트 기반의 장점

### ✅ 1) 강력한 장애 격리

* 소비자 장애 ≠ 발행자 장애
* 일부 실패를 전체 실패로 키우지 않음

### ✅ 2) 확장성

* 새 서비스 추가 시

  * 기존 서비스 수정 불필요
* 구독만 추가하면 됨

### ✅ 3) 트래픽 완충

* 갑작스러운 폭주를 큐가 흡수
* 백엔드 보호 효과

---

## 7️⃣ 하지만 이벤트 기반도 공짜는 아니다

### 1) 즉시 일관성은 포기

* 결과는 “나중에” 반영될 수 있음
* **최종적 일관성(Eventual Consistency)** 전제

### 2) 흐름 파악이 어려워짐

* 요청 → 응답 구조가 아님
* 추적(Tracing) 없으면 디버깅 어려움

### 3) 중복 처리 고려 필요

* 이벤트는 재전달될 수 있음
* **Idempotency(멱등성)** 설계 필수

---

## 8️⃣ 언제 이벤트 기반이 적합한가

### ✅ 적합한 경우

* 여러 서비스가 같은 사실에 반응해야 할 때
* 일부 지연을 허용할 수 있을 때
* 확장/추가 가능성을 열어두고 싶을 때

예:

* 주문 생성 후 결제/배송/알림
* 사용자 가입 후 포인트/메일/통계
* 보안 로그 수집, 감사 이벤트

---

### 부적합한 경우

* 즉시 결과가 반드시 필요한 경우
* 사용자 화면에서 바로 성공/실패를 보여줘야 할 때

예:

* 로그인 결과
* 결제 승인 요청 자체

---

## 9️⃣ MSA에서의 현실적인 조합

실제 시스템은 이렇게 섞습니다.

* **명령(Command)** → 동기 REST/gRPC
* **사실(Event)** → 비동기 이벤트

예:

```
[결제 요청]  → 동기
[결제 완료]  → 이벤트
```

**“요청은 동기, 결과는 이벤트”**

---

## 1️⃣0️⃣ 결론: 이벤트는 MSA의 ‘윤활유’다

* 이벤트는 서비스를 느슨하게 만든다
* 느슨함은 장애 격리와 확장을 만든다
* 대신 관측·중복·일관성 설계가 필수다

> **MSA에서 이벤트는 선택이 아니라
> 규모가 커질수록 자연스럽게 필요한 구조**다.

---

## ✅ 오늘의 핵심 요약

* 이벤트는 “이미 일어난 사실”이다.
* 이벤트 기반은 서비스 간 직접 호출을 줄인다.
* 장애 격리와 확장성에 매우 강력하다.
* 즉시 일관성 대신 최종적 일관성을 선택한다.
* 관측·멱등성 설계 없이는 운영이 어렵다.

---
