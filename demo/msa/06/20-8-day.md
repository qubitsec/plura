## 8일차 – 개념 이해

**날짜: 6월 20일**

---

## 주제

# **8. 통신 방식: REST vs gRPC, 동기 vs 비동기**

> “MSA는 네트워크 실패를 전제로 설계한다”

---

## 1️⃣ MSA에서 통신은 ‘부가 요소’가 아니라 ‘핵심 리스크’다

모놀리식에서는 함수 호출이었습니다.

```text
functionA() → functionB()
```

하지만 MSA에서는 모든 호출이 다음을 의미합니다.

```text
내 서비스 → 네트워크 → 다른 프로세스 → 네트워크 → 응답
```

즉,

> **모든 서비스 호출은 언제든지 실패할 수 있다**

이 전제가 MSA 설계의 출발점입니다.

---

## 2️⃣ 동기(Sync) 통신과 비동기(Async) 통신

### 동기 통신(Synchronous)

* 요청을 보내고 **응답을 기다림**
* 대표: REST, gRPC

예:

```
주문 서비스 → 결제 서비스 → 응답 대기
```

### 비동기 통신(Asynchronous)

* 요청(이벤트)을 보내고 **즉시 반환**
* 결과는 나중에 처리
* 대표: 메시지 큐, 이벤트 브로커

예:

```
주문 생성 → 이벤트 발행 → (결제/배송이 각자 처리)
```

---

## 3️⃣ REST란 무엇인가 (가장 흔한 선택)

### ✅ REST의 특징

* HTTP 기반
* JSON 포맷
* 사람에게 읽기 쉬움
* 디버깅이 쉬움 (curl, 브라우저)

### ✅ REST가 적합한 경우

* 외부 공개 API
* 단순한 요청/응답 구조
* 프론트엔드와의 통신

### REST의 한계

* 텍스트 기반 → 성능 한계
* 스키마가 느슨함
* 호출 체인이 길어질수록 장애 전파 위험

---

## 4️⃣ gRPC란 무엇인가 (서비스 간 통신 특화)

### ✅ gRPC의 특징

* HTTP/2 기반
* 바이너리 프로토콜 (Protobuf)
* 강한 스키마 계약
* 빠르고 효율적

### ✅ gRPC가 적합한 경우

* 서비스 ↔ 서비스 내부 통신
* 고성능/저지연 요구
* 명확한 API 계약 필요

### gRPC의 단점

* 사람이 직접 보기 어려움
* 브라우저 직접 호출 어려움
* 초기 학습 비용

---

## 5️⃣ REST vs gRPC 비교 요약

| 구분         | REST      | gRPC              |
| ---------- | --------- | ----------------- |
| 전송 방식      | HTTP/JSON | HTTP/2 + Protobuf |
| 가독성        | 매우 좋음     | 낮음                |
| 성능         | 보통        | 매우 좋음             |
| 계약(Schema) | 느슨함       | 강함                |
| 외부 API     | 적합        | 부적합               |
| 내부 서비스     | 가능        | 매우 적합             |

**현실적인 선택**

* 외부/프론트엔드: REST
* 내부 서비스 간: gRPC

---

## 6️⃣ 동기 통신의 위험: 연쇄 장애

동기 호출이 많아질수록 이런 구조가 됩니다.

```
A → B → C → D
```

* C가 느려지면?
* B가 타임아웃
* A까지 대기
* 결국 전체 장애

이것을 **Cascading Failure(연쇄 장애)** 라고 합니다.

---

## 7️⃣ 비동기 통신이 필요한 이유

### ✅ 비동기의 장점

* 서비스 간 시간적 결합 제거
* 장애 격리
* 트래픽 스파이크 흡수

### 예시

* 주문 생성 → 이벤트 발행
* 결제/배송/알림은 각자 처리
* 일부 실패해도 전체 흐름은 유지

**“바로 처리”보다 “결국 처리”가 중요할 때** 비동기가 유리합니다.

---

## 8️⃣ 언제 동기, 언제 비동기인가 (실전 기준)

### 동기 통신이 적합한 경우

* 즉시 응답이 반드시 필요
* 사용자 화면에 바로 결과 표시
* 실패 시 바로 오류를 보여줘야 함

예: 로그인, 결제 승인 요청

---

### 비동기 통신이 적합한 경우

* 처리 시간이 길 수 있음
* 일부 실패를 허용
* 이벤트 기반 확장 필요

예: 알림 발송, 로그 수집, 통계 처리

---

## 9️⃣ MSA 통신의 현실적인 원칙

### ✅ 3가지 핵심 원칙

1. **동기 호출은 최소화**
2. **깊은 호출 체인은 피하기**
3. **비동기를 기본으로, 동기는 예외로**

그리고 반드시 함께 와야 할 것:

* 타임아웃
* 재시도 정책
* 서킷 브레이커
* 관측(로그/메트릭/트레이싱)

---

## 10️⃣ 결론: 통신 설계가 MSA의 난이도를 결정한다

* REST냐 gRPC냐는 **도구 선택**
* 동기냐 비동기냐는 **아키텍처 선택**

> **MSA의 진짜 복잡성은
> “서비스 개수”가 아니라
> “서비스 사이의 통신 방식”에서 나온다**

---

## ✅ 오늘의 핵심 요약

* MSA에서는 모든 호출이 실패할 수 있다.
* REST는 범용, gRPC는 내부 최적화용이다.
* 동기 호출은 연쇄 장애를 만든다.
* 비동기는 장애 격리와 확장성의 핵심이다.
* 통신 설계를 못 하면 MSA는 운영 지옥이 된다.

---
