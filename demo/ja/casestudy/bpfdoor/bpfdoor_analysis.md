SKT事件に関連するBPFDoor攻撃事例を中心に、BPFDoorの一般的な動作原理やさまざまな攻撃事例を幅広く整理し、システム管理者およびセキュリティ運用チームのための高度な対応戦略も含めて作成します。

# SKT USIMハッキング事件とBPFDoorマルウェア分析

## 1. SKT事件で使用されたBPFDoorマルウェアの分析
### 1.1 攻撃手法と内部侵入経路  
**SKテレコムのホーム加入者サーバー**（HSS）に攻撃者が侵入し、`BPFDoor`バックドアを設置したと確認されています ([KISA, SKTハッキングマルウェア公開...セキュリティ点検を勧告](https://m.boannews.com/html/detail.html?idx=137004#:~:text=SKT%EB%8A%94%2022%EC%9D%BC%20%EC%9C%A0%EC%8B%AC%20%EA%B4%80%EB%A0%A8%20%EC%A0%95%EB%B3%B4%EA%B0%80,%EC%BD%94%EB%93%9C%EA%B0%80%20BRF%EB%8F%84%EC%96%B4%EC%9D%BC%20%EA%B0%80%EB%8A%A5%EC%84%B1%EC%9D%B4%20%EB%86%92%EB%8B%A4%EB%8A%94%20%EA%B2%83%EC%9D%B4%EB%8B%A4)) ([KISA「最近使用されたマルウェア注意報」…SKTハッキングマルウェア公開 | 聯合ニュース](https://www.yna.co.kr/view/AKR20250425168300017#:~:text=BPF%EB%8F%84%EC%96%B4%EB%8A%94%20%EB%B0%B1%EB%8F%84%EC%96%B4%20%EC%95%85%EC%84%B1%EC%BD%94%EB%93%9C%EB%A1%9C%202021%EB%85%84%20PWC%EC%82%AC%EC%9D%98,%EC%B5%9C%EC%B4%88%EB%A1%9C%20%EC%95%8C%EB%A0%A4%EC%A7%84%20%EC%82%AC%EC%9D%B4%EB%B2%84%20%EA%B3%B5%EA%B2%A9%20%EC%88%98%EB%B2%95%EC%9D%B4%EB%8B%A4)). HSSは加入者の電話番号、IMSIなどの**USIM情報**および通信サービス認証データを管理する中核サーバーであり、攻撃者はこのサーバーを掌握して大量の加入者情報を盗み出したと見られています。初期侵入手法としては**APT攻撃**でよく使われる手段（例：ゼロデイ脆弱性の悪用、管理者アカウントの窃取など）が考えられ、具体的には明らかにされていませんが**中国系ハッキンググループ**による高度な**持続的標的型攻撃（APT）**戦術が疑われています ([KISA, SKTハッキングマルウェア公開...セキュリティ点検を勧告](https://m.boannews.com/html/detail.html?idx=137004#:~:text=BPF%EB%8F%84%EC%96%B4%EB%8A%94%20%EB%A6%AC%EB%88%85%EC%8A%A4%20%EA%B8%B0%EB%B0%98%20HSS%EC%97%90%20%EC%B9%A8%ED%88%AC%ED%95%B4,%EC%9D%B4%20%EC%95%85%EC%84%B1%EC%BD%94%EB%93%9C%EB%A5%BC%20%EC%98%A4%ED%94%88%EC%86%8C%EC%8A%A4%EB%A1%9C%20%EA%B3%B5%EA%B0%9C%ED%96%88%EA%B8%B0%20%EB%95%8C%EB%AC%B8%EC%9D%B4%EB%8B%A4)). 一旦HSSシステムの掌握に成功した攻撃者は、ルート権限を取得し、Linux用バックドアである**BPFDoor**を当該サーバーに設置して実行し、内部に持続的に滞在し追加の行動を行う拠点を築きました ([KISA, SKTハッキングマルウェア公開...セキュリティ点検を勧告](https://m.boannews.com/html/detail.html?idx=137004#:~:text=BPF%EB%8F%84%EC%96%B4%EB%8A%94%20%EB%A6%AC%EB%88%85%EC%8A%A4%20%EA%B8%B0%EB%B0%98%20HSS%EC%97%90%20%EC%B9%A8%ED%88%AC%ED%95%B4,%EC%9D%B4%20%EC%95%85%EC%84%B1%EC%BD%94%EB%93%9C%EB%A5%BC%20%EC%98%A4%ED%94%88%EC%86%8C%EC%8A%A4%EB%A1%9C%20%EA%B3%B5%EA%B0%9C%ED%96%88%EA%B8%B0%20%EB%95%8C%EB%AC%B8%EC%9D%B4%EB%8B%A4)). 特にBPFDoorは、2021年のPwCレポートで初めてその存在が明らかになった**ステルスバックドア**で、2017年以降数年間にわたり検知されないほど秘かに使用されてきたマルウェアです ([KISA, SKTハッキングマルウェア公開...セキュリティ点検を勧告](https://m.boannews.com/html/detail.html?idx=137004#:~:text=BPF%EB%8F%84%EC%96%B4%20%EC%95%85%EC%84%B1%EC%BD%94%EB%93%9C%EB%8A%94%20%EB%A6%AC%EB%88%85%EC%8A%A4%EB%82%98%20%EC%86%94%EB%9D%BC%EB%A6%AC%EC%8A%A4%20%EC%8B%9C%EC%8A%A4%ED%85%9C%EC%9D%84,PwC%20%EC%97%B0%EA%B5%AC%EC%A7%84%EC%97%90%20%EC%9D%98%ED%95%B4%20%EB%8B%A4%EC%8B%9C%20%EB%B0%9C%EA%B2%AC%EB%90%90%EB%8B%A4)). 攻撃者はこのような特性を狙ってBPFDoorをHSSに仕込み、**長期間にわたり発見されることなく内部ネットワークに常駐**し、さらなる偵察やデータ流出を試みた可能性が高いです。

### 1.2 バックドアのインストールおよび権限維持方式  
BPFDoorが実行されると、まず自身を**メモリ上に隠蔽**するための一連の動作を行います。外部から流入したBPFDoorバイナリを`/dev/shm`のようなメモリベースのファイルシステムパスにコピーし（`kdmtmpflush`という名前を使用）、元のファイルを削除してディスク上の痕跡を消します ([BPFDoor Linux Malware Detected by AhnLab EDR - ASEC](https://asec.ahnlab.com/en/83925/#:~:text=When%20BPFDoor%20is%20first%20executed%2C,no%20exception%20to%20the%20case)) ([BPFDoor, Software S1161 | MITRE ATT&CK®](https://attack.mitre.org/software/S1161/#:~:text=)). その後、バックドアプロセスは親プロセスを終了し、**`--init`フラグでフォーク（fork）された子プロセスをinit(1)プロセスの子として配置**し、プロセスツリー上で孤立したプロセス（オーファンプロセス）として残ります ([BPFDoor, Software S1161 | MITRE ATT&CK®](https://attack.mitre.org/software/S1161/#:~:text=Enterprise%20%20T1036%20%20,Masquerading%20%3A%20%2055)). これにより、バックドアプロセスはユーザーのセッションやターミナルに接続されず、**バックグラウンドデーモン**のように静かに実行されることができます。さらに、BPFDoorは`prctl()`を利用して**プロセス名や引数を巧妙に偽装**します。例えば、実行中のプロセスの`argv[0]`などを変更し、`/sbin/udevd -d`、`dbus-daemon --system`、`systemd-journald`のようにシステムの正常なデーモンプロセスのように見せかけます ([BPFDoor, Software S1161 | MITRE ATT&CK®](https://attack.mitre.org/software/S1161/#:~:text=BPFDoor%20%20overwrites%20the%20%60argv,journald%60.%5B1])). このような**プロセス偽装（Masquerading）**技術により、管理者が`ps`コマンドなどで確認した際に怪しく見えないようにし、さらに同名の合法的なプロセスがすでに稼働中であれば**重複による手がかりの混乱効果**も期待できます。  

BPFDoorは**永続性（Persistence）**を確保するために、通常はサービスや起動スクリプトに自身を登録しません。代わりに**サーバーメモリに常駐**し、**サーバーが稼働し続ける限り維持**される形です ([A peek behind the BPFDoor — Elastic Security Labs](https://www.elastic.co/security-labs/a-peek-behind-the-bpfdoor#:~:text=Attack%20Lifecycle)). HSSのような中核サーバーは稼働率が高く再起動が稀である点を悪用しており、システムが再起動しない限りBPFDoorプロセスはメモリから消えず、継続的に攻撃者にバックドアを提供しました ([A peek behind the BPFDoor — Elastic Security Labs](https://www.elastic.co/security-labs/a-peek-behind-the-bpfdoor#:~:text=Attack%20Lifecycle)). もし再起動などでバックドアプロセスが消滅した場合、攻撃者は同様の初期侵入経路や他のPersistence手法（例：cronジョブ、Launch Daemon登録など）で再インストールを試みる可能性があります。しかし、**ディスクに自身を残さずメモリにのみ存在する**ように設計されたBPFDoorの特性上、今回のSKT事例でもディスクフォレンジックでは悪性実行ファイルを発見するのが難しく、メモリ分析によってのみその存在が明らかになった可能性が高いです。

### 1.3 通信（C2）技術の技術的原理  
BPFDoorの最も注目すべき特徴は、**ネットワーク通信方式の隠密性**です。一般的なバックドアのようにC2サーバーへ定期的に接続したりポートを開いたままにするのではなく、BPFDoorは**LinuxカーネルのBerkeley Packet Filter（BPF）**機能を悪用して**受動的にネットワークパケットを監視**します ([BPFDoor Linux Malware Detected by AhnLab EDR - ASEC](https://asec.ahnlab.com/en/83925/#:~:text=BPFDoor%20abuses%20BPF%20to%20operate,stealthily%20on%20the%20infected%20system))。バックドアプロセスは実行後、**遠隔コマンドを待ちながらBPFフィルター**をカーネルに登録します。このフィルターは事前に定義された**「マジックバイト」パターン**を持つパケットを識別する役割を担います。たとえば、BPFDoorが登録したフィルターは**TCPパケットでは0x5293の値**を、UDPパケットやICMP Echo（Ping）パケットでは**0x7255の値**をチェックするようになっています ([BPFDoor Linux Malware Detected by AhnLab EDR - ASEC](https://asec.ahnlab.com/en/83925/#:~:text=BPFDoor%20also%20utilizes%20BPF%20and,and%20ICMP%20protocol%E2%80%99s%20Echo%20Request))。攻撃者はこのようなマジックシグネチャを含む特殊なパケットを対象サーバーに送信して、バックドアを起動させます。フィルターに一致しないトラフィックは無視されますが、**指定されたマジックバイトを含むパケット**が到着するとBPFDoorはそれを認識し、攻撃者のコマンドセッションを初期化します ([BPFDoor, Software S1161 | MITRE ATT&CK®](https://attack.mitre.org/software/S1161/#:~:text=BPFDoor%20%20uses%20BPF%20bytecode,2))。このプロセスにおいて、BPFDoorは依然として**任意のポートをリッスンしないため、ファイアウォールやポートスキャンでは存在を検出しにくい**です ([BPFDoor Linux Malware Detected by AhnLab EDR - ASEC](https://asec.ahnlab.com/en/83925/#:~:text=BPFDoor%20abuses%20BPF%20to%20operate,stealthily%20on%20the%20infected%20system))。  

マジックパケットを通じてコマンドが伝達されると、BPFDoorは**含まれた「パスフレーズ」とコマンドコード**を解析し、3つの動作モードのいずれかを実行します ([BPFDoor Linux Malware Detected by AhnLab EDR - ASEC](https://asec.ahnlab.com/en/83925/#:~:text=Once%20this%20process%20is%20complete%2C,infection%20status%20from%20this%20information)) ([BPFDoor Linux Malware Detected by AhnLab EDR - ASEC](https://asec.ahnlab.com/en/83925/#:~:text=Command%20Password%20Feature%200%20pass,shell%202%20N%2FA%20%E2%80%9C1%E2%80%9D%20response))。最初のモード（コマンドコード0）は、パケットに特定のパスフレーズ（例："justforfun"）が含まれている場合であり、このときBPFDoorはパケット内に指定された攻撃者IPとポートに**即座にリバースシェル接続**を行い、攻撃者に対象システムのシェルアクセスを提供します ([BPFDoor Linux Malware Detected by AhnLab EDR - ASEC](https://asec.ahnlab.com/en/83925/#:~:text=Once%20this%20process%20is%20complete%2C,infection%20status%20from%20this%20information))。2番目のモード（コード1）は、パケットパスフレーズが"socket"の場合であり、BPFDoorが**ローカルに新しいポートを開いて（バインドシェル）**攻撃者の接続を待つモードです ([BPFDoor Linux Malware Detected by AhnLab EDR - ASEC](https://asec.ahnlab.com/en/83925/#:~:text=Once%20this%20process%20is%20complete%2C,infection%20status%20from%20this%20information))。このときもバックドアはただポートを開くのではなく、**`iptables`ファイアウォールルールを動的に追加**して、攻撃者のIPからの接続のみを許可し、該当トラフィックをバックドアポートにリダイレクトします ([BPFDoor Linux Malware Detected by AhnLab EDR - ASEC](https://asec.ahnlab.com/en/83925/#:~:text=In%20the%20bind%20shell%20process%2C,that%20was%20added%20is%20removed))。これにより、**不特定多数へのポート露出を隠蔽**し、攻撃者の接続が完了するとすぐに一時的に追加したファイアウォールルールを削除して痕跡を消します ([BPFDoor Linux Malware Detected by AhnLab EDR - ASEC](https://asec.ahnlab.com/en/83925/#:~:text=In%20the%20bind%20shell%20process%2C,that%20was%20added%20is%20removed))。最後に、3番目の動作（コード2）は認証パスフレーズが一致しない場合であり、このときBPFDoorは攻撃者に対して単に**"1"バイト**を返します ([BPFDoor Linux Malware Detected by AhnLab EDR - ASEC](https://asec.ahnlab.com/en/83925/#:~:text=password%20in%20the%20source%20code,infection%20status%20from%20this%20information)) ([BPFDoor Linux Malware Detected by AhnLab EDR - ASEC](https://asec.ahnlab.com/en/83925/#:~:text=Command%20Password%20Feature%200%20pass,shell%202%20N%2FA%20%E2%80%9C1%E2%80%9D%20response))。この応答は、攻撃者にとって該当システムにBPFDoorが**インストールされて実行中であることを確認**する信号として利用されます。つまり、攻撃者は無差別にパケットを送信したりスキャンして「1」の応答を受け取れば、対象システムに既にバックドアが埋め込まれていることを把握し、その後正しいパスフレーズを使って本格的なシェルセッションを開始できます。BPFDoorプロトコル自体は**RC4暗号化や独自ライブラリによる暗号化**を用いてコマンドデータを平文で送信しないように設計されており、解析と検出をさらに困難にします ([BPFDoor, Software S1161 | MITRE ATT&CK®](https://attack.mitre.org/software/S1161/#:~:text=Enterprise%20%20T1027%20%20,57))。このような**カスタム通信プロトコル**により、BPFDoorは**典型的でない非標準ポート／プロトコル（ICMPなど）**を通じてC2通信を行い、トラフィック内容も暗号化されているため、侵入防止システム（IPS）やセキュリティモニタリングに容易に検出されません。

### 1.4 隠蔽および防御回避技術  
BPFDoorは**多層的な隠蔽技術**を用いて、セキュリティソリューションや管理者の目を逃れます。前述した**ポート非開放通信**や**プロセス偽装**に加えて、実行時に**環境設定やログを操作**して手がかりを消します。例えば、シェル実行履歴が残らないようにプロセスの環境変数`HISTFILE`などを`/dev/null`に設定して**コマンド履歴を無効化**します ([BPFDoor, Software S1161 | MITRE ATT&CK®](https://attack.mitre.org/software/S1161/#:~:text=BPFDoor%20sets%20the%20,PID%3E%2Fenviron%60.%5B1))。また、実行直後に`utimes()`関数を呼び出してマルウェアファイルのタイムスタンプを操作（いわゆる**タイムスタンピング**）し、ファイルの作成／変更時刻を古い正常なファイルのように見せかけます ([BPFDoor, Software S1161 | MITRE ATT&CK®](https://attack.mitre.org/software/S1161/#:~:text=))。BPFDoorプロセスは`SIGHUP`など特定のシグナルを無視するよう設定され、意図しない終了やデバッグを困難にし ([BPFDoor, Software S1161 | MITRE ATT&CK®](https://attack.mitre.org/software/S1161/#:~:text=BPFDoor%20set%27s%20it%27s%20process%20to,2))、`/proc/<PID>/environ`などのプロセス情報領域も消去して、自身の環境変数や実行引数の痕跡を隠します ([BPFDoor, Software S1161 | MITRE ATT&CK®](https://attack.mitre.org/software/S1161/#:~:text=Enterprise%20%20T1070%20%20,51))。  

**ファイル削除と自己隠蔽**も重要な回避技術です。BPFDoorは自身を/dev/shmなどに複製した後、元のマルウェアファイルを即座に削除してディスク上のインジケーター（ハッシュ、ファイルパス）を消します ([BPFDoor, Software S1161 | MITRE ATT&CK®](https://attack.mitre.org/software/S1161/#:~:text=))。実行中も`/dev/shm/kdmtmpflush (deleted)`のように**削除されたファイルとしてのみプロセスが存在**するため、管理者がファイルシステムを調査してもマルウェアファイルを見つけにくくなります。このように、**ディスク非存在（fileless）**の特性と**カーネルレベルのパケットフック**を悪用した手法により、BPFDoorは数年間複数のシステムに潜伏しても検出されないほどの強力な**防御回避（Defense Evasion）**能力を示します ([KISA、SKTハッキングマルウェアを公開...セキュリティ点検を勧告](https://m.boannews.com/html/detail.html?idx=137004#:~:text=BPF%EB%8F%84%EC%96%B4%20%EC%95%85%EC%84%B1%EC%BD%94%EB%93%9C%EB%8A%94%20%EB%A6%AC%EB%88%85%EC%8A%A4%EB%82%98%20%EC%86%94%EB%9D%BC%EB%A6%AC%EC%8A%A4%20%EC%8B%9C%EC%8A%A4%ED%85%9C%EC%9D%84,PwC%20%EC%97%B0%EA%B5%AC%EC%A7%84%EC%97%90%20%EC%9D%98%ED%95%B4%20%EB%8B%A4%EC%8B%9C%20%EB%B0%9C%EA%B2%AC%EB%90%90%EB%8B%A4))。SKT事件でもバックドアが長期間気付かれずにHSS内に常駐し、USIMデータを流出できたのはこのような隠蔽技術のおかげであり、**「ルートキットに匹敵するステルス性」**を備えたバックドアと評価されています ([BPFDoors Hidden Controller Used Against Asia, Middle East Targets | Trend Micro (US)](https://www.trendmicro.com/en_us/research/25/d/bpfdoor-hidden-controller.html#:~:text=Introduction))。

## 2. BPFDoorの動作原理とグローバル攻撃事例
### 2.1 BPFDoorの一般的な動作原理  
BPFDoorは主に**Linux（リナックス）およびSolaris（ソラリス）**サーバーを標的とする**バックドア型マルウェア**です ([KISA, SKT 해킹 악성코드 공개...보안 점검 권고](https://m.boannews.com/html/detail.html?idx=137004#:~:text=BPF%EB%8F%84%EC%96%B4%20%EC%95%85%EC%84%B1%EC%BD%94%EB%93%9C%EB%8A%94%20%EB%A6%AC%EB%88%85%EC%8A%A4%EB%82%98%20%EC%86%94%EB%9D%BC%EB%A6%AC%EC%8A%A4%20%EC%8B%9C%EC%8A%A4%ED%85%9C%EC%9D%84,PwC%20%EC%97%B0%EA%B5%AC%EC%A7%84%EC%97%90%20%EC%9D%98%ED%95%B4%20%EB%8B%A4%EC%8B%9C%20%EB%B0%9C%EA%B2%AC%EB%90%90%EB%8B%A4))。その名の通りBPF（Berkeley Packet Filter）技術を悪用して動作するため、**一般的なプロセスやネットワーク接続の観点からはほとんど見えないのが特徴**です。前述のように、BPFDoorは感染したシステムで**メモリに常駐**し、**マジックパケット**を受信したときにだけ活動する**パッシブ型バックドア**として機能します ([BPFDoor Linux Malware Detected by AhnLab EDR - ASEC](https://asec.ahnlab.com/en/83925/#:~:text=BPFDoor%20abuses%20BPF%20to%20operate,stealthily%20on%20the%20infected%20system))。このような設計の目的は、**既に侵入に成功したシステムへの再侵入経路**を確保することにあります ([A peek behind the BPFDoor — Elastic Security Labs](https://www.elastic.co/security-labs/a-peek-behind-the-bpfdoor#:~:text=In%20this%20research%20piece%2C%20we,or%20actively%20compromised%20target%20environment))。つまり、攻撃者が初期侵入に成功した後、万が一に備えて設置しておく**“非常口”**の役割を果たすのがBPFDoorです。一度設置すれば、普段はシステムリソースを最小限に使って静かに待機し、後に必要となった場合（例：他のマルウェアが削除された、または新たな命令が必要なときなど）に**攻撃者が再び侵入可能な秘密のチャネル**を提供します ([A peek behind the BPFDoor — Elastic Security Labs](https://www.elastic.co/security-labs/a-peek-behind-the-bpfdoor#:~:text=Attack%20Lifecycle))。BPFDoorは**事前共有されたパスワード**と**カスタムプロトコル**を使用するため、攻撃者以外にはこのバックドアを起動することは困難です。このような**非対称的な動作原理**により、防御側はバックドアの存在に気付きにくく、気付いたとしても簡単には除去できないという困難に直面します。

BPFDoorの**内部構造**を見てみると、実行段階では**自己複製と隠蔽**、**BPFフィルタのインストール**、**コマンド処理スレッドの待機**という順序で構成されています ([BPFDoor Linux Malware Detected by AhnLab EDR - ASEC](https://asec.ahnlab.com/en/83925/#:~:text=When%20BPFDoor%20is%20first%20executed%2C,no%20exception%20to%20the%20case))。BPFフィルタは、先述の特定パケットを識別するように構成された**バイトコードフィルタ**で、主にSSH（22）、HTTP（80）、HTTPS（443）ポートの受信パケットを傍受し、その内容にマジックキーがあるかを検査します ([BPFDoor, Software S1161 | MITRE ATT&CK®](https://attack.mitre.org/software/S1161/#:~:text=BPFDoor%20%20uses%20BPF%20bytecode,2))。この設計により、攻撃者はあたかも正常なWebトラフィックやSSH接続パケットに偽装した特殊パケットを送ることで、**ファイアウォールや侵入検知システムを回避**できます。BPFDoorがマジックパケットを検知すると、そのパケットから**攻撃者が指定したIP／ポート、コマンドコード、パスフレーズ**などを抽出し、**子プロセスをフォークして命令を実行**する構造で動作します ([BPFDoor, Software S1161 | MITRE ATT&CK®](https://attack.mitre.org/software/S1161/#:~:text=BPFDoor%20%20uses%20BPF%20bytecode,2))。一方、親プロセスはそのままBPFフィルタを保持したままバックグラウンドに残り、後に来るパケットを監視し続けます。このような方式により、BPFDoorは**1つのプロセスで常時待機しつつ、必要な瞬間に複数のセッションを同時処理することも可能**です。

全体的に、BPFDoorの動作は**最小限のフットプリントで最大限の隠密性**を確保することに重点が置かれています。ディスクに触れず、ネットワークにほとんど痕跡を残さず、システムAPI呼び出しによる動作も限定的なため、行動ベースの検出にも引っかかりにくいです。ただし、このバックドア自体には**ファイルのダウンロード／アップロード、キー入力の記録、自身の拡散などの追加機能はなく**、あくまで**リモートシェルの通路**としての役割に忠実です ([BPFDoor Linux Malware Detected by AhnLab EDR - ASEC](https://asec.ahnlab.com/en/83925/#:~:text=Command%20Password%20Feature%200%20pass,shell%202%20N%2FA%20%E2%80%9C1%E2%80%9D%20response))。結局、BPFDoorの破壊力はこのバックドアを使う**攻撃者の能力**に依存しており、熟練したAPT攻撃者であれば、このバックドアを使って内部ネットワークを長期にわたり秘密裏に制圧し、必要なすべての作業（例：追加マルウェアのインストール、データベースの照会、データの窃取など）を遂行することが可能になります。SKTの事例でも、BPFDoor自体が特にUSIM情報を盗む機能を持っていたわけではなく、バックドアを通じて**攻撃者がHSSデータベースへのクエリやファイル流出の命令を直接下して**USIM情報を盗んだと見られています ([KISA, SKT 해킹 악성코드 공개...보안 점검 권고](https://m.boannews.com/html/detail.html?idx=137004#:~:text=BPF%EB%8F%84%EC%96%B4%EB%8A%94%20%EB%A6%AC%EB%88%85%EC%8A%A4%20%EA%B8%B0%EB%B0%98%20HSS%EC%97%90%20%EC%B9%A8%ED%88%AC%ED%95%B4,%EC%9D%B4%20%EC%95%85%EC%84%B1%EC%BD%94%EB%93%9C%EB%A5%BC%20%EC%98%A4%ED%94%88%EC%86%8C%EC%8A%A4%EB%A1%9C%20%EA%B3%B5%EA%B0%9C%ED%96%88%EA%B8%B0%20%EB%95%8C%EB%AC%B8%EC%9D%B4%EB%8B%A4))。BPFDoorはそのような**高度なサイバースパイ活動**のために設計されたマルウェアプラットフォームといえます。

### 2.2 中国APTグループとの関連およびグローバル攻撃事例  
BPFDoorは当初から**中国系のサイバー諜報グループ**によって活用されていたとみられています。2021年のPwCの脅威レポートによると、中国のハッカーグループである**「Red Menshen（レッドメンシェン）」**が数年間にわたり中東およびアジア地域を対象にBPFDoorを使用していたことが確認されています（[SKTハッキングに中国ハッカー得意のバックドアマルウェア…「主体特定は困難」｜聯合ニュース](https://www.yna.co.kr/view/AKR20250424055300017#:~:text=match%20at%20L82%20%EB%B3%B4%EA%B3%A0%EC%84%9C%EC%97%90%20%EB%94%B0%EB%A5%B4%EB%A9%B4,%EA%B3%B5%EA%B2%A9%EC%97%90%20%EC%88%98%EB%85%84%EA%B0%84%20BPF%EB%8F%84%EC%96%B4%EB%A5%BC%20%EC%82%AC%EC%9A%A9%ED%95%B4%20%EC%99%94%EB%8B%A4))。Red Menshenはこのバックドアに「justforfun」というパスフレーズを使用する独自の亜種を用いており、CrowdStrikeなどではこのバックドアを**「JustForFunバックドア」**と呼んでいます。その後、2022年頃からBPFDoorに関する情報が公開され、**他の中国APT組織もこのツールを共有**したり、類似の手法を採用し始めたと考えられています。実際、Mandiantの報告によると、中国の代表的なハッカーグループの一つである**APT41（別名Winnti）**が2022年に南アジアの政府機関をハッキングし、BPFDoorを使用した事例が確認されています（[Stealth Mode: Chinese Cyber Espionage Actors Continue to Evolve Tactics to Avoid Detection｜Mandiant｜Google Cloud Blog](https://cloud.google.com/blog/topics/threat-intelligence/chinese-espionage-tactics#:~:text=,to%20APT15%2C%20APT25%2C%20and%20Ke3chang)）。このように、BPFDoorは特定のグループに限らず、**複数の脅威アクターが活用するツール型バックドア**へと進化しています。

**主なグローバル攻撃事例**を見てみると、**通信分野**で顕著な被害が報告されています。2021年のPwCレポート以降、各国のセキュリティ企業がBPFDoorの活動を追跡しており、**トレンドマイクロ**は2022〜2023年の間に**韓国、香港、ミャンマー、マレーシア、エジプト**などの**通信会社、金融機関、小売企業**を狙ったBPFDoor攻撃が多数観測されたと明らかにしました（[KISA、SKTハッキングマルウェアを公開...セキュリティ点検を勧告](https://m.boannews.com/html/detail.html?idx=137004#:~:text=%ED%8A%B8%EB%A0%8C%EB%93%9C%EB%A7%88%EC%9D%B4%ED%81%AC%EB%A1%9C%EB%8A%94%20%EC%B5%9C%EA%B7%BC%20%EB%B0%9C%EA%B0%84%ED%95%9C%20%EB%B3%B4%EA%B3%A0%EC%84%9C%EC%97%90%EC%84%9C%20%ED%95%9C%EA%B5%AD%EA%B3%BC,%EC%95%85%EC%84%B1%EC%BD%94%EB%93%9C%20%ED%8A%B8%EB%9E%98%ED%94%BD%EC%97%90%20%EB%8C%80%ED%95%9C%20%EC%96%B8%EA%B8%89%EC%9D%B4%20%EC%9E%88%EB%8B%A4)）。特に韓国の通信会社に対する試みは**2022年7月および12月**にも既に存在しており、今回のSKT事例のように**大規模な加入者情報の窃取**を狙った形跡があると分析されました（[SKTハッキングに中国ハッカー得意のバックドアマルウェア…「主体特定は困難」｜聯合ニュース](https://www.yna.co.kr/view/AKR20250424055300017#:~:text=%EB%B3%B4%EC%95%88%20%EC%A0%84%EB%AC%B8%ED%9A%8C%EC%82%AC%20%ED%8A%B8%EB%A0%8C%EB%93%9C%EB%A7%88%EC%9D%B4%ED%81%AC%EB%A1%9C%20%EB%B3%B4%EA%B3%A0%EC%84%9C%EC%97%90%20%EB%94%B0%EB%A5%B4%EB%A9%B4,%EB%AF%B8%EC%96%80%EB%A7%88%2C%20%EB%A7%90%EB%A0%88%EC%9D%B4%EC%8B%9C%EC%95%84%2C%20%EC%9D%B4%EC%A7%91%ED%8A%B8%EC%97%90%EC%84%9C%20%EA%B3%B5%EA%B2%A9%EC%9D%B4%20%EA%B4%80%EC%B0%B0%EB%90%90%EB%8B%A4)）。SKT事件発生直前の2025年4月初旬にも、Trend MicroはBPFDoorの**新たなC2コントローラ**に関する分析を発表し、これを**中国APTグループ「Earth Bluecrow」（レッドメンシェンに対するトレンドマイクロ独自の命名）**の仕業と推定しました（[BPFDoors Hidden Controller Used Against Asia, Middle East Targets｜Trend Micro (US)](https://www.trendmicro.com/en_us/research/25/d/bpfdoor-hidden-controller.html#:~:text=%2A%20BPFDoor%C2%A0is%20a%20state,attacks%20zero%20in%20on%20the)）。このレポートに記載されている通り、当該攻撃者たちはBPFDoorを用いてバックドアを開いた後、**被害ネットワーク内部へ横方向移動（lateral movement）**し、より深くシステムを掌握し、データへのアクセスを試みるなど、**組織的なサイバースパイ活動**を行っていたことが明らかになっています（[Trend Micro (US)](https://www.trendmicro.com/en_us/research/25/d/bpfdoor-hidden-controller.html#:~:text=movement%2C%20enabling%20attackers%20to%20enter,customers%20to%20protect%20them%20against)）。

BPFDoorはまた、**オープンソースとしてソースコードが流出**したとされ、近年では中国以外の主体がこのマルウェアを活用する可能性も指摘されています（[KISA、SKTハッキングマルウェアを公開...セキュリティ点検を勧告](https://m.boannews.com/html/detail.html?idx=137004#:~:text=BPF%EB%8F%84%EC%96%B4%EB%8A%94%20%EB%A6%AC%EB%88%85%EC%8A%A4%20%EA%B8%B0%EB%B0%98%20HSS%EC%97%90%20%EC%B9%A8%ED%88%AC%ED%95%B4,%EC%9D%B4%20%EC%95%85%EC%84%B1%EC%BD%94%EB%93%9C%EB%A5%BC%20%EC%98%A4%ED%94%88%EC%86%8C%EC%8A%A4%EB%A1%9C%20%EA%B3%B5%EA%B0%9C%ED%96%88%EA%B8%B0%20%EB%95%8C%EB%AC%B8%EC%9D%B4%EB%8B%A4)）。実際、2023年以降、GitHubなどでBPFDoorと類似する機能のコードが公開され、研究目的で分析が行われ、それを元にした**派生マルウェア**が登場する可能性もあります。しかし、依然として**主要な使用事例は中国の国家支援型攻撃**と評価されており、**サイバー諜報・スパイ活動**が目的であることが大半です（[Trend Micro (US)](https://www.trendmicro.com/en_us/research/25/d/bpfdoor-hidden-controller.html#:~:text=%2A%20BPFDoor%C2%A0is%20a%20state,attacks%20zero%20in%20on%20the)）。攻撃対象も主に**情報価値の高い政府機関、通信、先端技術、金融分野**が中心です（[Trend Micro (US)](https://www.trendmicro.com/en_us/research/25/d/bpfdoor-hidden-controller.html#:~:text=movement%2C%20enabling%20attackers%20to%20enter,customers%20to%20protect%20them%20against)）。たとえば2021年には中東地域の通信会社がこのバックドアの被害に遭い、2022年にはアジア各国の政府および企業ネットワークで発見されました。2024〜2025年にかけて韓国の通信会社が相次いで標的となったのも、こうしたグローバルキャンペーンの延長線上にあると見られます。SKTのUSIM情報大量流出事件は、BPFDoorが現実に引き起こした被害の中でも最も注目を集めた事例であり、**全国民の携帯加入者情報**が標的となったという点で、その波及力は極めて大きなものでした（[KISA、SKTハッキングマルウェアを公開...セキュリティ点検を勧告](https://m.boannews.com/html/detail.html?idx=137004#:~:text=SKT%EB%8A%94%2022%EC%9D%BC%20%EC%9C%A0%EC%8B%AC%20%EA%B4%80%EB%A0%A8%20%EC%A0%95%EB%B3%B4%EA%B0%80,%EC%BD%94%EB%93%9C%EA%B0%80%20BRF%EB%8F%84%EC%96%B4%EC%9D%BC%20%EA%B0%80%EB%8A%A5%EC%84%B1%EC%9D%B4%20%EB%86%92%EB%8B%A4%EB%8A%94%20%EA%B2%83%EC%9D%B4%EB%8B%A4)）。このようにBPFDoorは世界中で**密かに潜伏し、機密データを収集するサイバー攻撃**の共通分母として登場しており、**韓国を含む各国の重要インフラを脅かす存在**へと浮上しています。

## 3. BPFDoorに関連するMITRE ATT&CK戦術および技術のマッピング  
BPFDoorが実行または関連する主要な行為をMITRE ATT&CKマトリクスに基づいて分析すると、以下のようになります（※ **戦術**：攻撃段階、**技術**：具体的な手法）：

- **初期アクセス（Initial Access）** – *脆弱性の悪用（Exploit Public-Facing Application, T1190）*：BPFDoor自体は初期侵入手段ではありませんが、攻撃者は脆弱なWebサーバーやVPN機器などの外部サービスのゼロデイ脆弱性を悪用して、HSSサーバーなどの内部ネットワークに最初の足場を築いた可能性が高いです。また、*正規認証情報の悪用（Valid Accounts, T1078）* 技術も推測されており、これにより管理者アカウントを奪取し、正規のログインを経てバックドアを設置した可能性もあります（実際にAPT41などがセキュリティ機器のアカウントを奪取した後、BPFDoorを植え付けた事例があります（[Stealth Mode: Chinese Cyber Espionage Actors Continue to Evolve Tactics to Avoid Detection | Mandiant | Google Cloud Blog](https://cloud.google.com/blog/topics/threat-intelligence/chinese-espionage-tactics#:~:text=,to%20APT15%2C%20APT25%2C%20and%20Ke3chang)））。初期アクセス自体はBPFDoorの機能範囲外ですが、本マルウェアを配布するための現実的な戦術として、これらのMITRE技術が考慮されます。

- **実行（Execution）** – *コマンドラインインターフェース（Command-Line Interface, T1059.004）*：攻撃者はLinuxシェル上で `cp`、`chmod`、`rm` などのコマンドを用いてBPFDoorをインストール／実行しました（[BPFDoor Linux Malware Detected by AhnLab EDR - ASEC](https://asec.ahnlab.com/en/83925/#:~:text=When%20BPFDoor%20is%20first%20executed%2C,no%20exception%20to%20the%20case)）。また、BPFDoorプロセスは実行後に自ら `fork` と `exec` を行い、バックグラウンドで継続的に動作します。*システムプロセスの作成または修正（Create or Modify System Process, T1543）* はBPFDoor自体には内蔵されていませんが、攻撃者が手動でroot権限のcronに追加したり、`rc.local` などに実行スクリプトを配置して永続化を試みた可能性があります。BPFDoorプロセスは実行されると自動的にinitの子プロセスとなりますが、これは*プロセスツリーの偽装（Masquerading: Break Process Tree, **T1036.009**）*に該当し、親プロセスを終了させて自身を孤立したプロセスとして残すことで、管理コンソールから切り離す技術です（[BPFDoor, Software S1161 | MITRE ATT&CK®](https://attack.mitre.org/software/S1161/#:~:text=Enterprise%20%20T1036%20%20,Masquerading%20%3A%20%2055)）。

- **永続性（Persistence）** – BPFDoorは設計上*メモリ常駐型バックドア*であり、一般的な**永続化技術**（例：起動時の自動実行）は使用しません（[A peek behind the BPFDoor — Elastic Security Labs](https://www.elastic.co/security-labs/a-peek-behind-the-bpfdoor#:~:text=Attack%20Lifecycle)）。したがって、MITREで定義された伝統的な永続性技術（例：*システム起動またはログイン時の実行, T1547* など）は直接該当しません。ただし、攻撃者は必要に応じて *システムサービスのハイジャック（T1543）* や *スケジュールされたタスク／ジョブの追加（Scheduled Task/Job, T1053）* などを活用し、BPFDoorが再起動後にも再実行されるよう環境を構築することが可能です。今回のSKT事例ではサーバーが長期間再起動されずに稼働していたため、メモリ常駐のみで十分だったと思われますが、一般的に攻撃者はバックドアプロセスが停止したりシステムが再起動された場合には、他の手段で再侵入を図ったり追加の永続化手段を併用する可能性があります。つまり、BPFDoor自体はPersistence戦術に深く関与していないものの、**攻撃の持続性**を担保するプラットフォームとして活用されます。

- **権限昇格（Privilege Escalation）** – BPFDoorのインストールには*root権限の取得*が前提条件となります。これは、BPFソケットフィルタをインストールするにはカーネルレベルの権限（CAP_SYS_ADMINまたはroot）が必要であるためです。したがって攻撃者は初期侵入後に**root権限の獲得**のために、*カーネルの脆弱性の悪用（Exploitation for Privilege Escalation, T1068）* や *認証情報のダンプおよび再使用（Credential Dump & Use）* などを実行したと考えられます。一度root権限を取得した後にバックドアを設置しているため、BPFDoorの実行自体はすでに最高権限で行われ、別途UACの回避などは必要ありません。また、BPFDoorは自身で*Setuid* や *トークンの偽装（Token Impersonation）* といった機能は使用していません。

- **防御回避（Defense Evasion）** – BPFDoorの主要な戦術であり、複数の**技術**が動員されています:  
  - *ファイル削除（Indicator Removal on Host: File Deletion, **T1070.004**）* – バックドア実行直後に元のマルウェアファイルを削除し、ディスクフォレンジックに痕跡を残さないようにします ([BPFDoor, Software S1161 | MITRE ATT&CK®](https://attack.mitre.org/software/S1161/#:~:text=))。  
  - *タイムスタンプ偽造（Indicator Removal: Timestomp, **T1070.006**）* – `utimes()` を使用してファイルの作成／変更時間を改ざんし、不審な新しいファイルのように見えないようにします ([BPFDoor, Software S1161 | MITRE ATT&CK®](https://attack.mitre.org/software/S1161/#:~:text=))。  
  - *ログと履歴の削除／無効化（Impair Defenses: Disable or Modify Logging, **T1562.003**）* – 環境変数 `HISTFILE` などを `/dev/null` に指定し、シェルコマンドの履歴を残さず、プロセス環境を消去してユーザー活動のログ追跡を困難にします ([BPFDoor, Software S1161 | MITRE ATT&CK®](https://attack.mitre.org/software/S1161/#:~:text=Enterprise%20%20T1562%20%20,Impair%20Defenses%20%3A%20%2049))。  
  - *プロセス偽装（Masquerading: Rename or Overwrite Process Arguments, **T1036.011**）* – マルウェアプロセス名をLinuxシステムデーモンのように変更し、実行引数を偽って `/proc` 上に表示される情報を欺きます ([BPFDoor, Software S1161 | MITRE ATT&CK®](https://attack.mitre.org/software/S1161/#:~:text=BPFDoor%20%20overwrites%20the%20%60argv,journald%60.%5B1))。例えば実際はバックドアであっても、プロセス一覧には `dbus-daemon --system` などと表示されるようにします。  
  - *プロセスツリー隠蔽（Masquerading: Parent PID Spoofing, T1036.004 および T1036.009）* – `--init` 引数を通じてプロセスを fork/exec し、initプロセスが親であるかのように偽装します ([BPFDoor, Software S1161 | MITRE ATT&CK®](https://attack.mitre.org/software/S1161/#:~:text=Enterprise%20%20T1036%20%20,Masquerading%20%3A%20%2055))。これにより `pstree` などで見ても、当該プロセスがどのプロセスから始まったか追跡しにくくなります。  
  - *システムファイアウォール回避（Impair Defenses: Disable or Modify System Firewall, **T1562.004**）* – 必要に応じて `iptables` ルールを操作し、攻撃者IPに対してのみ接続を許可し、セッション接続後には再度閉じることでファイアウォールを一時的に無力化します ([BPFDoor, Software S1161 | MITRE ATT&CK®](https://attack.mitre.org/software/S1161/#:~:text=,Disable%20or%20Modify%20System%20Firewall))。これはバックドア通信が外部セキュリティ装置に検出されないようにし、フォレンジック時にもファイアウォール設定が残らないようにする巧妙な技術です。  

  この他にも、BPFDoorは *パケットスニッフィング（Network Sniffing, T1040）* を通じて自身を隠します。通常はネットワークインターフェースをプロミスキャスモードに切り替えてパケットを傍受するため、インターフェース動作を監視していない限り、このような隠密な監視に気づくことはできません。全体的にBPFDoorは**Defense Evasion**戦術のもと、複数の技術を組み合わせてウイルス対策、EDR、IDSなどの検出を回避します ([BPFDoors Hidden Controller Used Against Asia, Middle East Targets | Trend Micro (US)](https://www.trendmicro.com/en_us/research/25/d/bpfdoor-hidden-controller.html#:~:text=Introduction))。

- **探索（Discovery）** – BPFDoor自体は内部ネットワークスキャンやシステム情報の閲覧などの**探索行為**を実行しません。しかし、バックドア経由でシェルを得た攻撃者が後続段階で *システムサービス閲覧（System Service Discovery, T1007）*、*ネットワーク接続確認（System Network Connections Discovery, T1049）* などを行い、周辺環境を把握することがあります。これらの行為はBPFDoor固有の機能ではありませんが、バックドアを利用した攻撃者の手動行動としてMITREマッピングで関連づけられます。

- **水平移動（Lateral Movement）** – BPFDoorは感染したシステムに限定して動作しますが、攻撃者はこのバックドアを拠点として他のシステムに移動する可能性があります。例えば、*リモートサービスの実行（Remote Services: SSH, T1021.004）* などを通じて横方向に他のサーバーへアクセスしたり、BPFDoorを追加で展開することができます。実際、Trend Microの分析ではBPFDoorコントローラを使用して**他のシステムにリバースシェルを繰り返し開き**内部ネットワークに深く侵入した事例が紹介されており ([BPFDoors Hidden Controller Used Against Asia, Middle East Targets | Trend Micro (US)](https://www.trendmicro.com/en_us/research/25/d/bpfdoor-hidden-controller.html#:~:text=Micro%20tracks%20as%20Earth%20Bluecrow,Intrusion%20Prevention%20and%20Deep%20Discovery))、これはMITRE技術上 *リモートシェルを通じた水平移動* に該当します。BPFDoor自体はワームのように自動拡散することはありませんが、APT攻撃者は手動でバックドアを複数のマシンに設置し、内部ネットワークを移動していきます。

- **コマンド&コントロール（Command and Control）** – BPFDoorの通信方式は**MITRE ATT&CKに新しく追加された技術カテゴリであるトラフィックシグナリング（Traffic Signaling）**に正確に合致します。具体的には *ソケットフィルター（Socket Filters）を用いた信号、**T1205.002*** 技術に分類され、これは任意のソケットにフィルターをかけ、特定パターンのトラフィックを信号として使用するC2手法です ([BPFDoor, Software S1161 | MITRE ATT&CK®](https://attack.mitre.org/software/S1161/#:~:text=BPFDoor%20%20uses%20BPF%20bytecode,2))。BPFDoorはICMP、TCP、UDPなど**非標準プロトコルおよびポート（Non-Standard Port, T1571）**でC2通信を行い、*アプリケーション層プロトコルの偽装（Application Layer Protocol, T1071）* も見られます。例えばHTTPパケットに隠された命令を使用したり、Ping（ICMP）パケットをC2信号として用いるのは**通常のトラフィックを装う**技術です。また、通信内容は**RC4ベース**で暗号化されたりカスタムエンコーディングされており、*C2通信の暗号化（Encrypted Channel, T1573）*の側面もあります ([BPFDoor, Software S1161 | MITRE ATT&CK®](https://attack.mitre.org/software/S1161/#:~:text=Enterprise%20%20T1027%20%20,57))。まとめると、BPFDoorは**Command & Control戦術**段階で**隠密な通信チャネルの構築**のために様々な技術を活用し、特に**ソケットレベルのパケットフィルタリング**を用いたC2信号待機と**リバース／バインドシェル接続**が主な特徴です ([BPFDoor Linux Malware Detected by AhnLab EDR - ASEC](https://asec.ahnlab.com/en/83925/#:~:text=Once%20this%20process%20is%20complete%2C,infection%20status%20from%20this%20information)) ([BPFDoor Linux Malware Detected by AhnLab EDR - ASEC](https://asec.ahnlab.com/en/83925/#:~:text=Command%20Password%20Feature%200%20pass,shell%202%20N%2FA%20%E2%80%9C1%E2%80%9D%20response))。

- **収集／持ち出し（Collection/Exfiltration）** – BPFDoor自体は収集および持ち出し機能を内蔵していませんが、バックドアセッションを通じて攻撃者が任意のコマンドを実行することで必要なデータの収集／盗取が可能です。例えばSKTの事例では、攻撃者がBPFDoorで開いたシェルからHSSデータベースをクエリし、加入者情報をファイルにダンプした後、*データの圧縮（Archive Collected Data, T1560）* および *外部送信（Exfiltration Over C2 Channel, T1041）* を行ったと考えられます。BPFDoorのC2チャネル（リバースシェル自体）を通じて直接データを持ち出したり、別途FTP/HTTPで持ち出した可能性もあります。MITRE上では *リモートアクセスツール（Remote Access Tool, S0002など）* に分類されるBPFDoorを用いて、攻撃者はすべての後続行動（TA0009～TA0011）を実行可能であり、結果として**全体の攻撃フローを支援するインフラ**と見ることができます。ただし厳密には、BPFDoorソフトウェア自体が自動的に行うものではないため、ここでは攻撃者がBPFDoorを利用して可能な技術を簡単に述べています。

以上のように、BPFDoorは主に**防御回避**、**コマンド&コントロール**領域の技術を複合的に実装したバックドアであり、MITRE ATT&CKマッピングを通じてその精巧さを確認できます。特に**Traffic Signaling（T1205）**および**Masquerading（T1036）**関連技術はBPFDoorを代表する行動であり、こうしたマッピング情報をもとにセキュリティ担当者は対策を講じることができます。

## 4. BPFDoor対応のためのセキュリティ戦略（検知、分析、遮断、事後対応）  
SKTの事件を教訓に、**システム管理者およびセキュリティ運用チーム（SOC）**は、BPFDoorのような巧妙なバックドアに備えて高度な対応策を準備すべきです。以下に**検知**から**事後対応**までの段階別の高度な戦略を提示します。

### 4.1 ネットワーク層のモニタリング戦略  
**① 異常トラフィックパターンの検出：**  
BPFDoorは通常とは異なるパターンのパケットでC2通信を行うため、**IDS/IPSおよびNDR（Network Detection & Response）**ソリューションを活用し、既知の**マジックパケットシグネチャ**を検出するようにルールを設定する必要があります。たとえば、トレンドマイクロは自社のIPS機器（TippingPointなど）にBPFDoorの特異なトラフィックルールをアップデートして検出できるようにしました（[BPFDoors Hidden Controller Used Against Asia, Middle East Targets | Trend Micro (US)](https://www.trendmicro.com/en_us/research/25/d/bpfdoor-hidden-controller.html#:~:text=telecommunications%2C%20finance%2C%20and%20retail%20sectors%2C,protect%20them%20against%20this%20threat)）。セキュリティ機器で**ICMP Echoパケットの非定型ペイロード**や、通常サービスしていないポート（例：42391〜43391の高ポート）へのTCP接続試行をモニタリングすれば、BPFDoorの活動兆候を検出できます。また、**許可されたプロトコル内の隠された通信**を見つけるために、平常時のトラフィックベースラインを確立し、**通常と異なるパターン**（例：DNSやHTTPを装った不審なバイナリデータ転送など）を異常としてフラグ付けすべきです。

**② 攻撃者のC2サーバーおよびIPモニタリング：**  
KISAが今回の事件を通じて公開した**IOC情報（IP、ハッシュ）**を社内のログと連携してモニタリングすることも重要です（[KISA「最近使われたマルウェアの注意報」…SKTハッキングマルウェアを公開 | Yonhap News](https://www.yna.co.kr/view/AKR20250425168300017#:~:text=%EA%B7%B8%EB%9F%AC%EB%A9%B4%EC%84%9C%20%EA%B3%B5%EA%B2%A9%20IP%EC%99%80%20%EC%95%85%EC%84%B1%20%EC%BD%94%EB%93%9C,%ED%95%B4%EC%8B%9C%EA%B0%92%20%EB%B0%8F%20%ED%8C%8C%EC%9D%BC%20%EC%A0%95%EB%B3%B4%EB%A5%BC%20%EA%B3%B5%EC%9C%A0%ED%96%88%EB%8B%A4)）。BPFDoor自体は受動的ですが、一旦起動すると攻撃者のC2と通信を行うため、ファイアウォールログやプロキシログに**不審IPへのアウトバウンド接続**が記録されていないか確認すべきです。特に**社内の重要サーバー（HSSなど）**から通常アクセスしない外部IPへのTCPセッションがあった場合、積極的に調査する必要があります。ネットワークフローモニタリング（NetFlow）やトラフィックミラーリングを活用して**隠れたリバースシェル接続**を検出することも可能であり、EDRがない場合でも**ネットワークベースで異常なセッション（例：サーバー→インターネットのSSHなど）**を検出して遮断する戦略が必要です。

**③ セグメンテーションとアクセス制御：**  
BPFDoorの拡散とC2通信を遮断するためには、**ネットワークセグメンテーション**を強化する必要があります。重要なサーバーはインターネットと直接通信できないように、物理的または論理的に分離を徹底し、必要な場合のみ厳格なプロキシやゲートウェイを通じて通信を行うよう構成します。もしHSSネットワークが外部と完全に隔離されていたなら、BPFDoorのリバース接続も失敗していたでしょう。また、**内部ネットワーク出口でのICMPトラフィックフィルタリング**を検討します。一般的に、サーバーが外部にPingを送ることは稀であり、内部サーバーからのICMP Echo Replyが見られた場合、それは異常兆候と見なせます。ファイアウォールでICMPを必要最小限に制限し、`iptables`ルールの変更時に管理コンソールへログを残すよう設定するのも一つの方法です。

**④ おとりパケットによる事前探索：**  
高度な脅威ハンティング技術として、セキュリティチームは独自に**BPFDoorトリガーパケット**を作成し、社内の主要サーバーを探索してみることができます。たとえば、疑わしいサーバーに対してBPFDoorのマジックバイト（0x5293など）を含むパケットを送信し、応答として「1」などが返ってくるか確認するのです（[BPFDoor Linux Malware Detected by AhnLab EDR - ASEC](https://asec.ahnlab.com/en/83925/#:~:text=password%20in%20the%20source%20code,infection%20status%20from%20this%20information)）。これはリスクを伴うため慎重に行う必要がありますが、既に知られているパスフレーズ（いくつかのサンプルでは "justforfun" など）を用いて逆にバックドア接続を試みることもできます。このような**能動的な検出手法**は、インシデント調査時に密かに設置されたBPFDoorを発見するのに役立ちます。ただし、運用中のネットワークに任意のパケットを送ることになるため、必ずクローズドなテスト環境で事前検証を行ったうえで慎重に適用すべきです。

### 4.2 エンドポイントフォレンジックおよびメモリ検査  
**① プロセスインジケーターの確認：**  
サーバー側で**異常なプロセスの兆候**を検出することが第一の防御です。管理者は定期的に**実行中のプロセス一覧と開始パス**を確認し、`\(deleted\)`と表示されている実行ファイルを持つプロセスがないかをチェックする必要があります。Linuxでは `/proc/<PID>/exe` のシンボリックリンクを通じてプロセスの実行ファイルパスを確認できますが、BPFDoorに感染している場合、このパスが削除されたファイルを指している可能性があります（[BPFDoor, Software S1161 | MITRE ATT&CK®](https://attack.mitre.org/software/S1161/#:~:text=)）。たとえば、`ls -l /proc/*/exe | grep "(deleted)"` のようなコマンドで、メモリ上にのみ存在する疑わしいプロセスを特定できます。また、`ps -ef` の出力において通常のシステムデーモンが**2つ以上**存在する場合や、ブート時のみ存在するべきプロセスが異常なタイミングで生成されている場合（例：`systemd-journald` プロセスが2つ存在するなど）には注意が必要です。BPFDoorは10個の定型的な偽装名リストの中から1つを使用するため（[BPFDoor, Software S1161 | MITRE ATT&CK®](https://attack.mitre.org/software/S1161/#:~:text=BPFDoor%20%20overwrites%20the%20%60argv,journald%60.%5B1)）、該当プロセス名が二重に現れたり、該当システム環境にそぐわない場合は疑うべき兆候と見なされます。

**② /dev/shm およびメモリ上のマルウェア検出：**  
BPFDoorは主に `/dev/shm` や `/tmp` ディレクトリに自らを隠すため、これらのディレクトリに**実行権限のあるファイル**が存在するか、不審なファイル名がないかを確認する必要があります。たとえば `kdmtmpflush` のような見慣れない名前のバイナリが見つかれば、隔離して分析を行います。ファイルが既に削除されている場合は、**メモリダンプの分析**に切り替える必要があります。ライブシステム上で*メモリフォレンジック*を実施するには、`gcore` を使って疑わしいプロセスのコアダンプを取得したり、`/proc/<PID>/mem` を `dd` でダンプする方法があります。こうして取得したメモリイメージに**YARAルール**を適用し、BPFDoorの既知の文字列（例："justforfun"、iptablesコマンド文字列、BPFバイトコードシーケンスなど）（[BPFDoor Linux Malware Detected by AhnLab EDR - ASEC](https://asec.ahnlab.com/en/83925/#:~:text=Once%20this%20process%20is%20complete%2C,infection%20status%20from%20this%20information)）が存在するかを検索できます。また、AhnLab EDRなどが提供する**BPFDoor専用の検出ルール**を活用すれば、メモリ上の兆候や行動ベースで感染の有無を識別可能です（[BPFDoor Linux Malware Detected by AhnLab EDR - ASEC](https://asec.ahnlab.com/en/83925/#:~:text=During%20its%20execution%2C%20BPFDoor%20is,of%20the%20behavior%20in%20advance)）。

**③ BPF使用の有無のモニタリング：**  
システムコールレベルでBPFDoorを検出するために、**BPFフィルタの登録イベント**や**Raw Socketの生成イベント**を追跡することも可能です。LinuxのAuditdを活用すれば、`socket()` や `setsockopt()` の呼び出しをモニターできます。BPFDoorは**AF_PACKETソケット**を生成し、`SO_ATTACH_FILTER` オプションを指定するため、これらの呼び出しをAuditdが記録するよう設定できます。正常な環境では、一般的なサーバープロセスがこのようなソケットを開くことはほとんどないため、Auditログに該当イベントが記録されれば速やかに調査が必要です。また、`bpftool` のようなユーティリティでシステムにロードされたBPFプログラムを一覧表示することもできますが、BPFDoorはclassic BPFフィルタをソケットに添付する形式のため、`bpftool` に表示されない可能性もあります（eBPFではないため）。代わりに `tcpdump` を使ってインターフェースが既に誰かに占有されているかを確認したり、`ifconfig` でインターフェースが**PROMISCモード**になっていれば、誰かがパケットスニッフィングを行っていると疑えます。このような低レベルの兆候を監視するのは難しいですが、**Host IDS** や **eBPFベースのモニタリングツール**を使えばカーネルレベルで異常な動作を検出することが可能です。

**④ メモリフォレンジックおよびデジタルフォレンジック：**  
既に侵害が疑われる、または確認された場合は、**メモリイメージとディスクイメージを保存**して事後のフォレンジック分析を行います。BPFDoorはメモリ常駐型のため、**従来のディスクフォレンジックだけでは証拠が不足**します。そのため、可能であればライブ状態でメモリをイメージングし（Volatilityなど使用）、該当プロセスのメモリを抽出してリバースエンジニアリングを行うことで、攻撃者のパスワードなどの具体的な情報を得ることができます。フォレンジックの過程では、バックドア経由で実行された攻撃者のコマンド履歴を再現することも重要であり、HISTFILEが存在しない場合でも、**.bash_history** 以外に**個別のログ**が存在しないか、メモリ上のシェル環境を分析したり、ネットワークのPCAPを逆解析して攻撃者がどのようなSQLクエリやシェルコマンドを使用したのかを特定する必要があります。これにより、実際に**漏洩したデータの範囲**や**攻撃者の行動**を再構成することができます。

### 4.3 カーネルレベルのフッキングおよびルートキット検出技法  
BPFDoorはカーネルモジュール形式のルートキットではありませんが、その活動は**カーネルレベル（パケットフィルタ）**で行われるため、まるでルートキットのように動作します（[BPFDoors Hidden Controller Used Against Asia, Middle East Targets | Trend Micro (US)](https://www.trendmicro.com/en_us/research/25/d/bpfdoor-hidden-controller.html#:~:text=Introduction)）。したがって、**カーネルフック検出技術**も併用すると良いでしょう。例えば、**LiME（Linux Memory Extractor）**などを使ってカーネルメモリをダンプし、異常なフックや改ざんされた関数ポインタがないかを確認します。または、OSSEC、chkrootkit、rkhunterなどの**ルートキットスキャナ**を定期的に実行し、**PROMISCモードのインターフェース**や**異常なカーネルモジュール**を点検します。BPFDoor自体はモジュールを挿入しませんが、攻撃者が追加で**LD_PRELOAD方式のインジェクション**や**カーネルモジュール型バックドア**を使用している可能性もあるため、全体的なルートキットの兆候を調査する必要があります。

**リアルタイムカーネルモニタリング**には、eBPFベースのセキュリティモジュールを活用できます。たとえば、Facebookの **osquery**、Ciliumの **hubble**、または Sysmon for Linux などを使用して、プロセス生成、ネットワーク接続、ファイル操作をカーネルレベルで収集・分析すれば、BPFDoorの隠蔽行動も間接的に明らかになる可能性があります。**カーネルのauditログ**をきちんと有効化し（例：`audit.rules` に `-a exit,always -F arch=b64 -S socket -S setsockopt` などを追加）、BPFDoorのような行動を事前に検知できる運用手順を構築することが推奨されます。

もう一つ考慮すべき点は、BPFDoorに類似した**他のバックドア**や**亜種の脅威**にも備えることです。カーネルレベルのフック検出は、BPFDoorに限らず、他のルートキットやDKOM（Direct Kernel Object Manipulation）攻撃も検出可能であるため、このような低レベルのモニタリング体制を整えておくことで、全体的なセキュリティレベルが向上します。

### 4.4 ブロックおよび事後対応策  
**① 対応および遮断：** BPFDoorの感染が確認された場合、まず**該当システムを隔離（セグメンテーション）**します。ネットワークを切り離し、アカウントのログインセッションを遮断して攻撃者の追加活動を防ぎます。その後、**メモリ上のバックドアプロセスの終了**および関連するアーティファクトの削除を実施します。単にプロセスを終了させるだけでなく、バックドアがインストールされたパス（`/dev/shm`など）や一時的なファイアウォールルールもすべて確認してクリーンアップします。可能であればシステムを**再起動**してメモリ上のマルウェアを除去し、再起動後に同一プロセスが再び現れないか確認します。同時に、**同じネットワーク内の他のサーバ**にも類似の侵入痕跡がないかをチェックする必要があります。APT攻撃者は複数のシステムにバックドアを仕掛ける傾向があるため、一台で発見された場合、全社的スキャンを通じて追加感染を探し出すべきです。

**② パッチおよび脆弱性封鎖：** 侵害事故の原因となった脆弱性が明らかになった場合、直ちにパッチを適用または対応設定を行います。例えばファイアウォール機器やWebサーバのゼロデイが悪用された場合、その機器をアップデートし、同様の構成のシステムには仮想パッチ（IPSルール適用など）でも適用します。**アカウント管理**も必須で、攻撃に使用されたアカウント（内部者アカウントや盗まれたVPNアカウントなど）があれば即座に無効化し、パスワードを変更します。すべての管理者アカウントに対してパスワードポリシーを強化し、2FA導入を検討することで、アカウント再利用攻撃を遮断します。

**③ ログおよびモニタリング改善：** BPFDoorのような脅威を早期に発見するためには、**ログ体制**の再整備が必要です。サーバのセキュリティログ（認証試行、システム変更など）を中央SIEMに集約し、特に*iptablesルール変更*、*PROMISCモード設定*、*プロセスクラッシュおよびcore dump生成*などのイベントも収集し、相関分析を行います。BPFDoorが設定したiptablesルールはセッション終了後に削除されますが、システム**メッセージログ（syslog）**などに**iptables INSERT**の記録が残っている可能性があるため、これを探し出します。またSSHなどの**リモート接続ログ**に、通常存在しない海外IPが一時的に記録されていた場合も手がかりになります。SKT事例ではハッカーのC2が中国など海外と推定されるため、通信会社の内部システムに普段接続されない海外IPの記録があるかどうかを調べる方式です。

**④ セキュリティソリューションの導入：** 今回の事件を契機に、**Linux用のEDR/XDR**導入の必要性が浮上しました（[KISA, SKTハッキングマルウェア公開...セキュリティ点検を勧告](https://m.boannews.com/html/detail.html?idx=137004#:~:text=%EB%AC%B8%EA%B4%91%EC%84%9D%20%ED%95%9C%EA%B5%AD%EC%A0%95%EB%B3%B4%EA%B3%B5%ED%95%99%EA%B8%B0%EC%88%A0%EC%82%AC%ED%9A%8C%20%EB%AF%B8%EB%9E%98%EC%9C%B5%ED%95%A9%EA%B8%B0%EC%88%A0%EC%9B%90%EC%9E%A5%EC%9D%80%20%E2%80%9CKISA%20%EA%B3%B5%EC%A7%80%EC%97%90%EC%84%9C,%EC%A7%84%ED%96%89%ED%95%A0%20%EA%B2%83%EC%9D%84%20%EA%B6%8C%EA%B3%A0%ED%95%98%EA%B3%A0%20%EC%9E%88%EB%8B%A4%E2%80%9D%EA%B3%B0%20%EB%A7%90%ED%96%88%EB%8B%A4)）。サーバ端末に**振る舞い検知（Behavior Detection）**機能を提供するEDRをインストールすれば、BPFDoorの異常行為（例：`/dev/shm`実行、プロセス名変更など）をリアルタイムで遮断または警告可能です。またメモリフォレンジック機能を持つEDRであれば、マルウェアがメモリ上にしか存在しなくても検知可能です（[BPFDoor Linux Malware Detected by AhnLab EDR - ASEC](https://asec.ahnlab.com/en/83925/#:~:text=During%20its%20execution%2C%20BPFDoor%20is,of%20the%20behavior%20in%20advance)）。組織として予算を確保してこのような**サーバセキュリティソリューション**を構築することも長期的な対応戦略です。トレンドマイクロやアンラボなどのセキュリティ企業がBPFDoor検出ルールを提供しているため、既存のソリューション（SIEM、IPSなど）に該当するシグネチャを追加適用する作業も進めるべきです。

**⑤ 事後フォレンジックおよび再発防止：** 事故収束後には**深層的な原因分析と再発防止対策**の策定が行われるべきです。デジタルフォレンジックの結果をもとに、攻撃のタイムライン、流出データの範囲、攻撃者のTTPを文書化し、経営陣および関連部署に伝達します。必要であれば顧客通知などの法的対応も行い、USIM交換などのユーザー保護措置を実施します（SKTは全顧客対象にUSIM無料交換を実施しました）。技術的には**侵害事故対応プレイブック**を更新し、類似のBPFベースバックドアの兆候発見時にどのように対応するかの手順を準備します。またセキュリティチームの能力向上のために、BPFDoorサンプルを利用した**模擬訓練**を実施し、EDR/監視システムがこれを検出して対応するかをテストします。最後に、**情報共有**を通じて得た教訓を業界と共有することも重要です。今回の事件でもKISAが関連情報を告知し業界に自主点検を勧告したように（[KISA, SKTハッキングマルウェア公開...セキュリティ点検を勧告](https://m.boannews.com/html/detail.html?idx=137004#:~:text=BPF%EB%8F%84%EC%96%B4%EB%8A%94%20%EB%A6%AC%EB%88%85%EC%8A%A4%20%EA%B8%B0%EB%B0%98%20HSS%EC%97%90%20%EC%B9%A8%ED%88%AC%ED%95%B4,%EC%9D%B4%20%EC%95%85%EC%84%B1%EC%BD%94%EB%93%9C%EB%A5%BC%20%EC%98%A4%ED%94%88%EC%86%8C%EC%8A%A4%EB%A1%9C%20%EA%B3%B5%EA%B0%9C%ED%96%88%EA%B8%B0%20%EB%95%8C%EB%AC%B8%EC%9D%B4%EB%8B%A4)、発見されたIoCや攻撃技術を共有することで、全体的な防御水準を向上させることができます。

## 5. 結論および提言  
SKTのUSIMハッキング事件は、**目立たないLinuxバックドアであるBPFDoor**が国内重要インフラを狙った事例として、大きな衝撃を与えました。BPFDoorの**攻撃原理**は、カーネルレベルでのパケットフィルタリングとプロセス偽装によって**「見えないドア」**を作るものであり、**グローバルAPT攻撃者たち**が数年間にわたり活用してきた高度技術です。今回の事例を通じて、組織は従来のWindows中心のセキュリティ対策から脱し、**Linuxサーバのセキュリティ**および**ネットワークモニタリング**の重要性を再認識すべきです。技術的にはMITRE ATT&CKマッピングを参考にした多層防御戦略を立て、**先制的検知と迅速な対応体制**を整える必要があります。特に**メモリ常駐マルウェア**へのフォレンジック能力と、**カーネル行動の可視性**の確保が新たなセキュリティ課題として浮上しています。今後もBPFDoorに類似した**ステルス型マルウェア**に備え、セキュリティチームは継続的に最新情報を学習し、システムの脆弱性管理と異常行動の監視を強化していくべきです。**「見えないバックドア」**であっても、最終的には痕跡を残すものですから、人と技術が融合した緻密なセキュリティ運用によって、こうした脅威を検知・遮断し、大切な顧客情報を守るために万全を期す必要があります。

